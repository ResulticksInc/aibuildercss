var e,t,a,s,l,i,r,n,o,d=Object.defineProperty,c=(e,t,a)=>(((e,t,a)=>{t in e?d(e,t,{enumerable:!0,configurable:!0,writable:!0,value:a}):e[t]=a})(e,"symbol"!=typeof t?t+"":t,a),a);import{j as u}from"./pdf-editor-be9d2bd2.js";import{r as m,R as p,i as h,w as v,k as g,S as x,j as y}from"./react-vendor-379f659a.js";import{D as b,A as j,G as f,p as C,e as L,f as S,S as N,g as I,i as w}from"./kendo-5d73125a.js";import"./constants-82903eb8.js";import{z as k,M as D,ak as A,al as M,am as T,an as R,ao as V,ad as E,ap as _,Y as F,aq as B,ar as O,as as q,at as $,au as G,av as P,B as U,E as z,aw as H,ax as K,ay as W,az as Y,aA as J,aB as Z,aC as X,aj as Q,aD as ee,aE as te,aF as ae,aG as se,aH as le,aI as ie,aJ as re,U as ne,aK as oe,aL as de,aM as ce,F as ue,aN as me,aO as pe,aP as he,aQ as ve,aR as ge,a0 as xe,aS as ye,aT as be,aU as je,aV as fe,aW as Ce,aX as Le,aY as Se,aZ as Ne,a_ as Ie,a8 as we,a$ as ke,b0 as De,b1 as Ae,b2 as Me,b3 as Te,b4 as Re,ai as Ve,b5 as Ee,b6 as _e,b7 as Fe,b8 as Be,b9 as Oe,ba as qe,bb as $e,bc as Ge,bd as Pe}from"./index-75225e0a.js";import{S as Ue}from"./SkeletonTable-f73684ed.js";import{R as ze,g as He,C as Ke,a as We,b as Ye}from"./RSPDateRangePicker-68a13ef6.js";import{L as Je}from"./LayoutPageWrapper-c659fc07.js";import{M as Ze,b as Xe,R as Qe,a as et,A as tt,c as at,C as st}from"./ui-a5a97ebf.js";import{R as lt}from"./RSIcon-40715e67.js";import{h as it,q as rt,p as nt}from"./utils-16c7e021.js";import{R as ot}from"./RSDropdowns-9012b9eb.js";import{a as dt,b as ct,c as ut,R as mt,d as pt}from"./RSKendoDropdown-89bac735.js";import{R as ht,a as vt}from"./RSCheckbox-6c51a528.js";import"./style-a86a43a5.js";import{K as gt}from"./IconDropdown-19f04dbc.js";import{T as xt}from"./Tooltip-c6e1c4bf.js";import{R as yt}from"./RSFormGroup-2e23951f.js";import{F as bt}from"./FormLabel-7c8c6237.js";import{R as jt}from"./RSDatePicker-bf1e95a8.js";import{RSErrorPopup as ft,RSConfirmAlert as Ct,RSAlertWithTextBox as Lt}from"./RSConfirmAlert-c9e1da8b.js";import{K as St}from"./index-44141e50.js";import{c as Nt,d as It,e as wt,f as kt,g as Dt,h as At}from"./inputLimit-ce03b0f6.js";import{S as Mt}from"./constantObject-ca27cf51.js";import{C as Tt}from"./CompanyListDropdown-aceaadaa.js";import{F as Rt}from"./FormLabelIcon-f96ecad7.js";import{F as Vt}from"./FormFieldIcon-388bc468.js";import{F as Et}from"./FormListWrapper-0cd539ec.js";import{R as _t}from"./RSSwitch-b5eda9e2.js";import"./Features.styled-9337e765.js";import{M as Ft,T as Bt,u as Ot,a as qt,P as $t}from"./maps-b8c6f010.js";import{I as Gt}from"./BootstrapDropdown-f79019e1.js";import{m as Pt,o as Ut,a as zt,b as Ht}from"./mobx-e1586d6a.js";import"./drag-drop-4af74c4a.js";import"./get-4aa85b1a.js";const Kt=({isOpen:e,onChangeIsOpen:t,selectItem:a})=>{m.useContext(k);const[s,l]=m.useState(e),[i,r]=m.useState([]),[n,o]=m.useState([]),[d,c]=m.useState([]),[p,h]=m.useState([]),[v,g]=m.useState(!1);m.useEffect((()=>{x()}),[]);const x=m.useCallback((()=>{D({path:A,params:{dynamiclistId:a.dynamicListID},isCache:!1,ok:e=>{var t,a;if(e.status&&(null==(a=null==(t=null==e?void 0:e.data)?void 0:t.campaignsList)?void 0:a.length)>0){r(e.data.campaignsList||[]),o(e.data.mobilePushChannelsList||[]),c(e.data.webPushChannelsList||[]);const t=e.data.campaignsList[0];t&&h(y(t.campaignId,t.channelID)),g(!1)}else g(!0)},fail:()=>g(!0)})}),[a.dynamicListID]),y=m.useCallback(((e,t)=>{const a=n.filter((t=>t.campaignId===e)),s=d.filter((t=>t.campaignId===e));return 0===a.length&&0===s.length?[{campaignId:e,channelName:8===t?"Web Notification":"Push notification",totalBlastCount:0,delivered:0,notregisterted:0,mismatchsenderId:0,invalidRegistration:0}]:[...a,...s]}),[n,d]),b=m.useCallback((()=>{l(!1),setTimeout((()=>{t()}),500)}),[t]),j=m.useCallback(((e,t)=>{const a=y(e,t);h(a)}),[y]),f=m.useMemo((()=>{var e;return(null==(e=p[0])?void 0:e.campaignId)||0}),[p]);return u.jsxs(Ze,{className:"dynamic-list-fill",show:s,onHide:b,size:"xlg",centered:!0,children:[u.jsxs(Ze.Header,{className:"justify-content-between",children:[u.jsx("h2",{className:"truncate330",children:a.dynamicListName}),u.jsxs("div",{className:"blue float-end ml15",children:[u.jsxs("small",{children:["Created by:",u.jsx("span",{children:" "+a.createdByName}),", on:",u.jsxs("span",{children:[" ",M(a.createdDate,!1)]})]}),u.jsx(lt,{mainClass:"close",size:"md",handleClose:b})]})]}),u.jsx(Ze.Body,{className:"p0 pb20",children:i.length>0?u.jsx(Xe,{indicators:!1,controls:!1,interval:null,className:"segment-slide-popup",children:u.jsx(Xe.Item,{children:u.jsxs(Qe,{className:"theme-space-mt",children:[u.jsxs(et,{md:6,xs:12,children:[u.jsxs("h6",{className:"font-medium color-primary-blue",children:["Communication executed (",i.length,")"]}),u.jsx("ul",{className:"campaign-pop-list font-xs mt5",children:i.map(((e,t)=>u.jsx("li",{onClick:()=>j(e.campaignId,e.channelID),style:{backgroundColor:e.campaignId===f?"#f9f9f9":"white"},children:u.jsxs("div",{className:"py4",children:[e.campaignName," - Sent on: ",M(e.startDate,!1)]})},t)))})]}),p.length>0&&u.jsx(et,{md:6,children:u.jsx("div",{className:"css-scrollbar max-height-aud-channel",children:p.map(((e,t)=>{var a;return u.jsxs("div",{children:[u.jsx("h6",{className:"font-medium color-primary-blue",children:"Audience by channel"}),u.jsx("ul",{className:"campaign-pop-list2 font-xs mt5",children:u.jsxs("li",{children:[u.jsx("span",{className:"float-start blue-del",children:T((null==(a=e.channelName)?void 0:a.toLowerCase())||"")}),u.jsx("span",{className:"float-end blue-del",children:e.totalBlastCount})]})}),u.jsx("h6",{className:"font-medium color-primary-blue",children:"Deliverability"}),u.jsxs("ul",{className:"campaign-pop-list2 border-bottom-0 font-xs mt5",children:[u.jsxs("li",{children:[u.jsx("span",{className:"float-start blue-del",children:"Delivered"}),u.jsx("span",{className:"float-end blue-del",children:e.delivered})]}),u.jsxs("li",{children:[u.jsx("span",{className:"float-start blue-del",children:"Not registered"}),u.jsx("span",{className:"float-end blue-del",children:e.notregisterted})]}),u.jsxs("li",{children:[u.jsx("span",{className:"float-start blue-del",children:"Mismatched sender Id"}),u.jsx("span",{className:"float-end blue-del",children:e.mismatchsenderId})]}),u.jsxs("li",{children:[u.jsx("span",{className:"float-start blue-del",children:"Unsubscribed"}),u.jsx("span",{className:"float-end blue-del",children:e.invalidRegistration})]})]})]},t)}))})})]})})}):u.jsx("div",{className:"marginT50",children:u.jsx(Ue,{count:5,isError:v,message:`No linked ${R(V)} available`})})})]})};p.Component;const Wt=e=>{var t;const[a,s]=m.useState(null),[l,i]=m.useState(null),[r,n]=m.useState(null),[o,d]=m.useState(null),[c,p]=m.useState(!1),[h,v]=m.useState(!1),[g,x]=m.useState({}),[y,b]=m.useState(""),[f,C]=m.useState("List name"),[L,S]=m.useState(""),[N,I]=m.useState(""),[w,k]=m.useState(""),[A,M]=m.useState(""),[T,R]=m.useState("");m.useEffect((()=>{V()}),[]);const V=()=>{const e={clientId:E()};D({path:_,params:e,ok:e=>{var t;if(e.status&&e.data.length){const a=F();null==(t=null==e?void 0:e.data)||t.map((e=>{e.userId===a.userId&&(e.firstName=e.firstName+" (You)")})),s(e.data)}},fail:e=>{}})},Y={tooltip:h?"collapse":"Expand",icon:`${H} flip-item ${h?"flip-vertical":"flip-disabled"} `,size:"sm",iconClass:"white",onClick:()=>{v(!h),e.onPeriyaMenuChange(!h)}},J={tooltip:c?"Close":"Search",icon:`${c?K:W}`,size:"sm",iconClass:`top8 ${c?" icons-sm":"icons-md "} white`,onClick:()=>{setTimeout((()=>{Q()}),1e3),p(!c),v(!1),e.onPeriyaMenuChange(!1),x({}),C("List name"),b(""),i({userId:"288",firstName:"-- Select created by --"}),c&&e.onSearchDataReceived({})}},Z=new Date,X=e=>{if(JSON.stringify(e).includes("isSearchName")&&0===(null==e?void 0:e.isSearchName.length)){let e={...g};return delete e.isSearchName,void x(e)}let t={...g};if(Object.keys(e).length)for(const[a,s]of Object.entries(e))s?t={...g,...e}:delete t[a];x(t)},Q=()=>{var e;null==(e=document.getElementById("list_search"))||e.focus()};m.useEffect((()=>{const e=e=>{var t;null==(t=document.getElementById("list_search"))||t.blur()};return document.addEventListener("mousedown",e),()=>{document.removeEventListener("mousedown",e)}}),[]);const ee=m.useCallback(((t,a)=>{null==e||e.onSearchDataReceived(t,a)}),[]);return u.jsxs("div",{style:{width:h?e.fullWidth:c?"350px":"33px"},className:`rsp-advanced-search-wrapper ${c?"open-search":"close-search"} ${h?"open-megamenu":"close-megamenu"}`,children:[u.jsxs("div",{className:`rsp-advanced-search-container ${c?"open-search":"close-search"} ${h?"open-megamenu":"close-megamenu"}`,children:[u.jsx("div",{className:`rsp-search-inner rsp-search-dropdown ${h&&"click-off"}`,children:u.jsx(gt,{className:"",data:[{text:"List name",id:1e3},{text:"Created by",id:1001},{text:"Approval status",id:1002}],icon:` ${B} icons-sm white`,onItemClick:e=>{C(e.item.text)}})}),h?u.jsxs("div",{className:"search-chips-container",style:{width:h?e.fullWidth:"100%"},children:[Object.keys(g).map((e=>u.jsxs("div",{className:"search-chips-box",children:[u.jsx("label",{children:Jt[e]}),u.jsx("ul",{className:"chips-custom",children:u.jsxs("li",{children:["approvalStatus"===e?N.toString():"userId"===e?(g[e],l.map((e=>e.firstName)).toString()):g[e],"Â ",u.jsx(O,{color:"color-remove",size:"sm",icon:q,onClick:()=>{let t={...g};delete t[e],x(t)}})]})})]}))),u.jsx(O,{mainClass:"ad-search",icon:$,size:"sm",color:"input-icon"})]}):u.jsxs("div",{className:"rsp-search-inner rsp-search-input",children:["List name"===f?u.jsx(ct,{id:"list_search",placeholder:"List name",defaultValue:"fsdf",val:y,cb:e=>{let t=e.trimStart();b(t.trim())},ob:e=>{X({isSearchName:e.trim()})}}):null,"Created by"===f?u.jsx(u.Fragment,{children:u.jsx(j,{textField:"firstName",dataItemKey:"userId",data:a,onBlur:e=>{a.map((t=>{t.firstName!==e.target.value||X({userId:t.userId})}))},placeholder:"Created by"})}):null,"Approval status"===f?u.jsx(u.Fragment,{children:u.jsx(j,{data:["Approved","Pending for approval","Rejected","Approval not enabled"],placeholder:"Approval status",onBlur:e=>{let t=3;"Approved"===e.target.value?t=1:"Rejected"===e.target.value?t=2:"Pending for approval"===e.target.value?t=0:"Approval not enabled"===e.target.value&&(t=3),X({approvalStatus:t})}})}):null,u.jsx(O,{icon:$,size:"sm",color:"input-icon",onClick:()=>{Object.keys(g).length&&Object.keys(g).map((t=>{g[t]&&(e.onSearchDataReceived(g,!0),x({}))}))}})]}),u.jsx("div",{className:"rsp-search-inner rsp-search-caret",children:u.jsx(O,{config:Y})}),u.jsx("div",{className:"rsp-search-toggle",children:u.jsx(O,{config:J})})]}),u.jsxs("div",{className:"rsp-megamenu-container "+(h?"open-megamenu":"close-megamenu"),children:[u.jsx(yt,{className:"mt10",children:u.jsxs(Qe,{children:[u.jsxs(et,{md:6,children:[u.jsx(yt,{children:u.jsxs(Qe,{children:[u.jsx(et,{md:4,children:u.jsx(bt,{right:!0,label:"List name"})}),u.jsx(et,{md:8,children:u.jsx("div",{style:{borderBottom:1,borderBottomColor:"gray",borderBottomStyle:"solid"},children:u.jsx(ut,{noinput:!0,errorMessage:w,label:"List name",placeholder:0===(null==(t=null==g?void 0:g.isSearchName)?void 0:t.length)?"Type and enter":"Enter list name",data:[],value:G((null==g?void 0:g.isSearchName)||""),allowCustom:!0,onChange:e=>{if(e.target.value.length<=5){let t=e.target.value.toString();S(t),X({isSearchName:t})}else k("Maximum of 5 list names are allowed"),setTimeout((()=>{k("")}),2e3)},onFilterChange:e=>{}})})})]})}),a&&u.jsx(yt,{children:u.jsxs(Qe,{children:[u.jsx(et,{md:4,children:u.jsx(bt,{right:!0,label:"Created by"})}),u.jsx(et,{children:a&&u.jsx(ut,{label:"Created by",placeholder:0===(null==l?void 0:l.length)?"Type and enter":"Select user",data:a,value:g.userId?l:{userId:"288",firstName:"-- Select created by --"},allowCustom:!1,textField:"firstName",dataItemKey:"userId",errorMessage:T,onChange:e=>{if(e.target.value.length<=5){let t=e.target.value.map((e=>e.userId));X({userId:t.toString()}),i(e.target.value)}else R("Maximum of 5 users are allowed"),setTimeout((()=>{R("")}),2e3)},onFilterChange:e=>{}})})]})})]}),u.jsxs(et,{md:6,children:[u.jsx(yt,{children:u.jsxs(Qe,{children:[u.jsx(et,{md:4,children:u.jsx(bt,{right:!0,label:"Approval status"})}),u.jsx(et,{children:u.jsx(ut,{errorMessage:A,label:"Approval status",placeholder:0===(null==l?void 0:l.length)?"Type and enter":"Select approval status",data:["Approved","Pending for approval","Rejected","Approval not enabled"],value:g.approvalStatus?N:{userId:"288",firstName:"-- Select created by --"},allowCustom:!1,onChange:e=>{if(e.target.value.length<=5){I(e.target.value);let t=e.target.value.map((e=>{let t=3;return"Approved"===e?t=1:"Rejected"===e?t=2:"Pending for approval"===e?t=0:"Approval not enabled"===e&&(t=3),t}));P("RR ApprovalStatus",JSON.stringify(t)),X({approvalStatus:t.toString()})}else M("Maximum of 5 approval status are allowed"),setTimeout((()=>{M("")}),2e3)},onFilterChange:e=>{}})})]})}),u.jsx(yt,{children:u.jsxs(Qe,{children:[u.jsx(et,{md:4,children:u.jsx(bt,{right:!0,label:"Start date"})}),u.jsx(et,{children:u.jsx("div",{className:"position-relative",children:u.jsx("div",{className:"rspdate-picker",children:u.jsx(xt,{anchorElement:"target",position:"top",children:u.jsx(jt,{format:"MMM dd, yyyy",placeholder:"Start date",value:(null==g?void 0:g.startDate)?r:null,handleChange:e=>{n(e.target.value);let t=new Date(e.target.value.toISOString().split("T")[0]);t=it(t).format("DD MMM yyyy"),X({startDate:Yt(e.target.value)})}})})})})})]})}),u.jsxs(Qe,{children:[u.jsx(et,{md:4,children:u.jsx(bt,{right:!0,label:"End date"})}),u.jsx(et,{children:u.jsx("div",{className:"position-relative",children:u.jsx("div",{className:"rspdate-picker",children:u.jsx(xt,{anchorElement:"target",position:"top",children:u.jsx(jt,{format:"MMM dd, yyyy",placeholder:"End date",value:(null==g?void 0:g.endDate)?o:null,min:Z,handleChange:e=>{d(e.target.value);let t=new Date(e.target.value.toISOString().split("T")[0]);t=it(t).format("DD MMM yyyy"),X({endDate:Yt(e.target.value)})}})})})})})]})]})]})}),u.jsxs("div",{className:"btn-container d-flex justify-content-end "+(h?"d-block":"d-none"),children:[u.jsx(U,{onClick:()=>{v(!1),e.onPeriyaMenuChange(!h),e.onSearchDataReceived(null),x({})},children:"Cancel"}),u.jsx(z,{className:Object.keys(g).length?"":"click-off",onClick:()=>{if(Object.keys(g).length){for(const[e,t]of Object.entries(g))if(!t)return;v(!1),e.onPeriyaMenuChange(!h),ee(g,!0)}},children:"Search"})]})]})]})},Yt=e=>{var t=new Date(e),a=""+(t.getMonth()+1),s=""+t.getDate();return[t.getFullYear(),a,s].join("-")},Jt={isSearchName:"List name",userId:"User",approvalStatus:"Approval status",startDate:"Start date",endDate:"End date"},Zt=e=>{var t,a;m.useState(!1),m.useState(""),m.useState(""),m.useState(null);const[s,l]=m.useState(!1),[i,r]=m.useState(!1);m.useState(!1),m.useState(!1);const n=h();m.useContext(k);const o=e=>{var t;return((null==(t=F())?void 0:t.userId)||0)===e?"click-on":"click-off"};return u.jsxs(u.Fragment,{children:[!0===s&&u.jsx(ft,{headerTitle:"Sorry",para:"Please try again after sometime...",primaryButtonText:"OK",buttonClicked:e=>{l(!1)}}),i&&u.jsx(ft,{size:"md",headerTitle:"Dynamic list",para:"Dynamic list limit exceeded, please upgrade your plan.",primaryButtonText:"Proceed",secondaryButtonText:"Cancel",buttonClicked:e=>{r(!1),!0===e&&n.push("/subscription")}}),u.jsx("td",{children:u.jsxs("div",{className:`rs-communication-list campaign-analytics-list ${Xt(e.dataItem.approverStatus).className}`,children:[u.jsxs("div",{className:"communication-content",children:[u.jsx("span",{className:"badge",children:window.btoa(e.dataItem.dynamicListID)}),u.jsxs("small",{children:["Created by: ",e.dataItem.createdByName&&e.dataItem.createdByName,", on: ",M(e.dataItem.createdDate,!1)]}),u.jsx("p",{className:"py5",children:null==e?void 0:e.dataItem.dynamicListName})]}),u.jsxs("div",{className:"communication-content",children:[u.jsx("small",{children:"No of linked campaign"}),u.jsx("p",{children:e.dataItem.recentBlastedCount})]}),u.jsxs("div",{className:"communication-content",children:[u.jsx("div",{className:`communication-status ${Xt(e.dataItem.approverStatus).className}`,children:u.jsx("small",{children:Xt(e.dataItem.approverStatus).title})}),u.jsx("div",{className:"rs-communication-icon",children:u.jsxs(Y,{children:[u.jsx(O,{tooltip:"Edit",icon:"icon-rs-pencil-edit-medium",size:"md",mainClass:"ml10",iconClass:`${o((null==(t=e.dataItem)?void 0:t.createdBy)||0)} ${0===e.dataItem.recentBlastedCount?"click-on":"click-off"}`,onClick:()=>{(()=>{var t;let a=!1;"click-off"===o((null==(t=e.dataItem)?void 0:t.createdBy)||0)&&(a=!0),n.push({pathname:"audience/new-dynamic-list",search:`?lId=${e.dataItem.dynamicListID}&bc=${e.dataItem.recentBlastedCount}&ar=false&view=${a}`,state:{mode:"edit",listId:e.dataItem.dynamicListID,dataItem:e.dataItem,blastCount:e.dataItem.recentBlastedCount}})})()}}),u.jsx(O,{tooltip:"View",icon:"icon-rs-eye-medium",size:"md",mainClass:"ml10",onClick:()=>{n.push({pathname:"audience/new-dynamic-list",search:`?lId=${e.dataItem.dynamicListID}&bc=${e.dataItem.recentBlastedCount}&ar=false&view=true`,state:{mode:"edit",listId:e.dataItem.dynamicListID,dataItem:e.dataItem,blastCount:e.dataItem.recentBlastedCount}})}}),u.jsx(O,{tooltip:"Duplicate",icon:"icon-rs-duplicate-medium",size:"md",onClick:()=>{e.dublicateButtonClicked(e.dataItem)}}),u.jsx(O,{tooltip:"Info",icon:"icon-rs-circle-info-medium",size:"md",onClick:()=>{e.infoButtonClicked(e.dataItem)}}),u.jsx(O,{tooltip:0===e.dataItem.approverStatus?"Pending for approval":1===e.dataItem.approverStatus?"Approved":2===e.dataItem.approverStatus?"Rejected":"",icon:(!1===e.dataItem.isRequestApproval?"icons-md icon-rs-user-tick-medium blue":0===e.dataItem.approverStatus?"icon-rs-user-question-mark-edge-medium orange":1===e.dataItem.approverStatus?"icons-md icon-rs-user-tick-medium green":2===e.dataItem.approverStatus?"icon-rs-user-tick-medium red":"icon-rs-user-tick-medium blue")+" ",iconClass:`${e.dataItem.isRequestApproval?"":"click-off"}${d=(null==(a=e.dataItem)?void 0:a.createdBy)||0,((null==(c=F())?void 0:c.userId)||0)===d?"click-off":"click-on"}`,size:"md",onClick:()=>{n.push({pathname:"audience/new-dynamic-list",search:`?lId=${e.dataItem.dynamicListID}&bc=${e.dataItem.recentBlastedCount}&ar=${e.dataItem.isRequestApproval}`,state:{mode:"edit",listId:e.dataItem.dynamicListID,dataItem:e.dataItem,blastCount:e.dataItem.recentBlastedCount}})}})]})})]}),u.jsx("div",{className:`expand-plus ${Xt(e.dataItem.approverStatus).className}`,children:u.jsx("ul",{className:"camp-icon-pannel",children:u.jsx("li",{children:u.jsx("i",{className:"k-icon k-i-plus"})})})})]})})]});var d,c},Xt=e=>Qt[e],Qt={0:{title:"Pending for approval",className:"status-scheduled",icon:"icon-rs-form-edit-large",id:0},1:{title:"Approved",className:"status-completed",icon:"icon-rs-in-progress-large",id:5},2:{title:"Rejected",className:"status-alert",icon:"icon-rs-alert-large",id:52},3:{title:"Approved",className:"status-completed",icon:"icon-rs-in-progress-large",id:5}},ea=v(class extends f{constructor(){super(...arguments),c(this,"state",{campaignList:[],activationKey:"0"}),c(this,"TableHead",(e=>u.jsx("thead",{children:u.jsxs("tr",{children:[u.jsx("th",{width:"11%",className:"text-right",children:"Channel"}),u.jsx("th",{width:"15%",className:"text-right",children:"friendly name"}),u.jsx("th",{width:"10%",className:"text-right",children:"Delivered"}),u.jsx("th",{width:"13%",className:"text-right",children:"Invalid registration"}),u.jsx("th",{width:"18%",className:"text-right",children:"Mismatch senderId"}),u.jsx("th",{width:"18%",className:"text-right",children:"Not registerted"})]})}))),c(this,"ChannelConntent",(e=>{var t,a,s,l,i,r,n,o;return u.jsxs("tr",{children:[u.jsx("td",{className:"text-center",children:u.jsx(O,{style:{backgroundColor:ta[null==(t=e.item)?void 0:t.channelName.toLowerCase()].bgColor},tooltip:`${ta[null==(a=e.item)?void 0:a.channelName.toLowerCase()].title}`,icon:`${ta[null==(s=e.item)?void 0:s.channelName.toLowerCase()].icon}`,size:"md",color:"white",mainClass:"box-view-icon bv-md mx-auto}"})}),u.jsx("td",{children:u.jsx("p",{children:ta[null==(l=e.item)?void 0:l.channelName.toLowerCase()].title})}),u.jsx("td",{children:u.jsx("p",{children:null==(i=e.item)?void 0:i.delivered})}),u.jsx("td",{children:u.jsx("p",{children:null==(r=e.item)?void 0:r.invalidRegistration})}),u.jsx("td",{children:u.jsx("p",{children:null==(n=e.item)?void 0:n.mismatchsenderId})}),u.jsx("td",{children:u.jsx("p",{children:null==(o=e.item)?void 0:o.notregisterted})})]})})),c(this,"NoDataAvailable",(()=>u.jsx("div",{className:"box-design pb10",children:u.jsx(Ue,{count:2,isError:!0,children:u.jsxs("div",{className:"nodata-bar",children:[u.jsx(O,{icon:J,size:"md",color:"orange-medium",mainClass:"mr5"}),u.jsx("p",{children:"No data available"})]})})}))),c(this,"DynamicListHeader",(e=>{var t,a,s;let l=null==(s=null==(t=null==e?void 0:e.info)?void 0:t.webPushChannelsList)?void 0:s.concat(null==(a=null==e?void 0:e.info)?void 0:a.mobilePushChannelsList);return 0===l.length?u.jsx(this.NoDataAvailable,{}):u.jsx(tt,{className:"rs-accordin",activeKey:this.state.activationKey,children:u.jsxs(at,{eventKey:e.index.toString(),children:[u.jsx(at.Header,{onClick:()=>{this.state.activationKey===e.index.toString()?this.setState({activationKey:"-1"}):this.setState({activationKey:e.index.toString()})},children:u.jsx("div",{className:"rs-accordin-header",children:u.jsxs("div",{className:"d-flex align-items-center",children:[u.jsx("i",{className:`icons-md ${this.state.activationKey!==e.index.toString()?"icon-rs-square-plus-fill-medium blue":"icon-rs-square-minus-fill-medium grey-medium"} marginR8`}),u.jsxs("h3",{className:"marginB0",children:[" ",e.item.campaignName]})]})})}),u.jsx(tt.Collapse,{eventKey:null==e?void 0:e.index.toString(),children:(null==l?void 0:l.length)>0&&u.jsx(at.Body,{children:u.jsx("div",{className:"rs-accordin-panel",children:u.jsxs("div",{className:"rs-accordin-body",id:"collapseOne","aria-labelledby":"headingOne",children:[u.jsx("div",{className:"marginT5"}),u.jsxs("table",{className:"grid-detail-content",children:[u.jsx(this.TableHead,{}),u.jsx("tbody",{children:l.map(((e,t)=>u.jsx(this.ChannelConntent,{item:e})))})]})]})})})})]})})}))}componentDidMount(){}render(){var e,t,a;return u.jsx("div",{className:"rs-grid-detail-view",children:u.jsx("div",{children:null==(a=null==(t=null==(e=this.props.data)?void 0:e.info)?void 0:t.campaignsList)?void 0:a.map(((e,t)=>{var a,s;return u.jsx(this.DynamicListHeader,{item:e,index:t,info:null==(s=null==(a=this.props)?void 0:a.data)?void 0:s.info})}))})})}}),ta={"web notification":{title:"Web push notification",icon:"icon-rs-web-notification-medium",bgColor:"#5ba529"},"push notification":{title:"Mobile push notification",icon:"icon-rs-mobile-notification-medium",bgColor:"#99cc03"}},aa={skip:0,take:5,sort:[{field:"orderDate",dir:"desc"}]},sa=e=>it().add(e,"d").toDate(),la=e=>{const t=new Date(e),a=String(t.getMonth()+1).padStart(2,"0"),s=String(t.getDate()).padStart(2,"0");return[t.getFullYear(),a,s].join("-")},ia=()=>{var e,t,a;const s=m.useContext(Z),l=g(),i=h(),r=m.useContext(k),[n,o]=m.useState({applyBtn:!1,result:null,isDuplicate:!1,dataState:aa,SkeletonTabledynamicList:[],listName:"",filterData:"",listId:0,isOpenInfoModal:!1,dublicateListModal:!1,isShowDateRangePicker:!1,listError:!1,previousListName:"",listNameLoader:!1,listNameStatus:!1,errMsgDynamicListName:null,isShowLoader:!1,listLoading:!0,selectItem:null,addToolTip:"",noapps:!1,newDataS:{data:[],total:200},newDataState:{take:5,skip:0},startDate:la(it(sa(-29)).format("DD MMM yyyy")),endDate:la(it(new Date).format("DD MMM yyyy")),isDateSearch:!1,pageCount:1,totalCount:0,cDate:!0,isBlastCount:"",filterType:0,noData:!1,userId:0,logIn_UserId:null,approvalStatus:"",periyaMenu:!1,isSearchedDataStatus:!1,isSearchedData:null,approverList:[],limitExceed:!1,planId:0,modalClose:!1,isFilterApply:!1,companyDropdownSelectedItem:null,CompanyListData:[],getAddAccessData:!1,getUpdateAccessData:!1,getDeleteAccessData:!1,getViewAccessData:!1,dynamicList:[],channelListErrMsg:null,checkNameExist:!1}),d=m.useRef(null),c=m.useRef(null),p=m.useRef(null),v=m.useRef(null);m.useRef(""),m.useRef("");const x=m.useCallback((()=>{var e;return{startDate:n.startDate,endDate:n.endDate,listType:"",userId:n.userId,isSearchName:null==(e=n.listName)?void 0:e.trim(),recordLimit:n.dataState.take,pageNumber:n.pageCount,isBlastCount:n.isBlastCount,filterType:n.filterType,approvalStatus:n.approvalStatus}}),[n.startDate,n.endDate,n.userId,n.listName,n.dataState.take,n.pageCount,n.isBlastCount,n.filterType,n.approvalStatus]),y=m.useCallback((()=>{const e=X("Audience");o((t=>({...t,getAddAccessData:!0===(null==e?void 0:e.get_AddAccessData),getUpdateAccessData:!0===(null==e?void 0:e.accessUpdateData),getDeleteAccessData:!0===(null==e?void 0:e.accessDeleteData),getViewAccessData:!0===(null==e?void 0:e.accessViewData)})))}),[]),b=m.useCallback((()=>{var e,t;const a=F(),s=localStorage.getItem("companyvalue");if(s){const e=JSON.parse(s);o((t=>({...t,companyDropdownSelectedItem:e})))}a&&o((e=>({...e,logIn_UserId:null==a?void 0:a.userId,CompanyListData:(null==a?void 0:a.clientLists)||[]}))),document.body.classList.add("dynamicList");const l=Q();(!l||0===(null==(e=null==l?void 0:l.mobileAppsList)?void 0:e.length)&&0===(null==(t=null==l?void 0:l.domainsList)?void 0:t.length))&&o((e=>({...e,noapps:!0,addTooltip:"No apps available"}))),j(x(),!1,(()=>{})),N()}),[x]),j=m.useCallback(((e,t,a)=>{o((e=>({...e,listError:!1,dynamicList:[],noData:!1,listLoading:!0}))),D({path:ee,params:e,sessionOut:r.globalStateData.setSessionOutData,isCache:!1,isServiceWorker:!1,ok:e=>{var t,s;if((null==e?void 0:e.status)&&(null==e?void 0:e.data)&&(null==(s=null==(t=null==e?void 0:e.data)?void 0:t.dynamiclists)?void 0:s.length)){const t={skip:0,take:n.dataState.take},s=[...e.data.dynamiclists],l=C(s,t);o((t=>({...t,listLoading:!1,dynamicList:e.data.dynamiclists,totalCount:e.data.totalNoRecord,result:l,noData:!1,isShowLoader:!1}))),a(!0)}else o((e=>({...e,listLoading:!1,dynamicList:[],noData:!0,isShowLoader:!1,totalCount:0}))),a(!1)},fail:e=>{o((e=>({...e,listError:!0,isShowLoader:!1,listLoading:!1}))),a(!1)}})}),[r.globalStateData.setSessionOutData,n.dataState.take]),f=m.useCallback(((e,t)=>{const a={dynamicListId:e,departmentId:0,dynamicListName:t,dbName:"cust_c4363a53_4d19_4eb9_b83e_d3ba1f1f9f1e"};o((e=>({...e,dynamicList:[],listLoading:!0}))),D({path:te,params:a,isCache:!1,sessionOut:r.globalStateData.setSessionOutData,ok:e=>{if(e.status){const e={startDate:n.startDate,endDate:n.endDate,listType:"",userId:"",isSearchName:"",recordLimit:n.dataState.take,pageNumber:1,isBlastCount:0,filterType:n.filterType};j(e,!1,(e=>{if(e){const e={skip:0,take:n.dataState.take};o((t=>({...t,dataState:e})))}})),ae(r,(()=>{})),o((e=>({...e,isDuplicate:!1})))}},fail:()=>{o((e=>({...e,isDuplicate:!1})))}})}),[r,n.startDate,n.endDate,n.dataState.take,n.filterType,j]),N=m.useCallback((()=>{const e={dbName:"cust_c4363a53_4d19_4eb9_b83e_d3ba1f1f9f1e",departmentId:0,clientId:E()};D({path:se,params:e,sessionOut:r.globalStateData.setSessionOutData,isServiceWorker:!1,ok:e=>{e.status&&e.data.length&&o((t=>({...t,approverList:e.data})))},fail:()=>{}})}),[r.globalStateData.setSessionOutData]),I=m.useCallback(((e,t)=>{D({path:le,params:{dynamicListName:e},sessionOut:r.globalStateData.setSessionOutData,ok:e=>{!0===e.status?(o((e=>({...e,errMsgDynamicListName:"Dynamic list name already exists",checkNameExist:!0,modalClose:!1}))),t(!1)):(o((e=>({...e,dynamicListNameErrMessage:null,checkNameExist:!0}))),t(!0))},fail:()=>{}})}),[r.globalStateData.setSessionOutData]),w=m.useCallback((e=>{const{skip:t,take:a}=e.dataState,s=Math.floor(t/a+1);o((t=>({...t,result:C(t.dynamicList,e.dataState),dataState:e.dataState,pageCount:s})))}),[]),T=m.useCallback((e=>{const{skip:t,take:a}=e.page,s=Math.floor(t/a+1);o((t=>({...t,result:C(t.dynamicList,e.page),dataState:e.page,pageCount:s}))),j(x(),!1,(()=>{}))}),[j,x]),R=m.useCallback((e=>{var t;return((null==(t=F())?void 0:t.userId)||0)===e?"click-on":"click-off"}),[]),V=m.useCallback((e=>{var t;return((null==(t=F())?void 0:t.userId)||0)===e?"click-off":"click-on"}),[]),_=m.useCallback(((e,t)=>{var a;if(!e){const e=it(t.start.toISOString().split("T")[0]).format("DD MMM yyyy"),s=it(t.end.toISOString().split("T")[0]).format("DD MMM yyyy"),l={startDate:la(e),endDate:la(s),listType:"",userId:n.userId,isSearchName:null==(a=n.listName)?void 0:a.trim(),recordLimit:n.dataState.take,pageNumber:1,isBlastCount:n.isBlastCount,filterType:n.filterType,approvalStatus:n.approvalStatus};o((t=>({...t,isShowLoader:!0,startDate:la(e),endDate:la(s),isDateSearch:!0,dataState:aa,pageCount:1,isFilterApply:!0}))),j(l,!1,(()=>{}))}o((t=>({...t,isShowDateRangePicker:e,isFilterApply:!1})))}),[n.userId,n.listName,n.dataState.take,n.isBlastCount,n.filterType,n.approvalStatus,j]);m.useCallback((e=>{if(!Object.keys(e)||!e)return;const t=(null==e?void 0:e.from)?la(e.from):n.startDate,a=(null==e?void 0:e.to)?la(e.to):n.endDate;o((s=>({...s,listName:e.listName,approvalStatus:"Approved"===e.status?1:"Rejected"===e.status?2:0,userId:e.createdBy,startDate:t,endDate:a,pageCount:1}))),j(x(),!1,(()=>{}))}),[n.startDate,n.endDate,j,x]);const B=m.useCallback(((e,t)=>{const a={startDate:n.startDate,endDate:n.endDate,listType:"",userId:n.userId,isSearchName:"",recordLimit:n.dataState.take,pageNumber:n.pageCount,isBlastCount:n.isBlastCount,filterType:n.filterType,approvalStatus:n.approvalStatus};if(void 0===t)(!n.isSearchedDataStatus&&n.isSearchedDataStatus||null!==e)&&(n.isSearchedDataStatus||0!==Object.keys(e).length)&&n.isSearchedDataStatus&&0===Object.keys(e).length&&(o((e=>({...e,isSearchedDataStatus:!1,userId:"",listName:"",isBlastCount:"",filterType:0,approvalStatus:"",isFilterApply:!1}))),j(x(),!1,(()=>{})));else{o((a=>({...a,isSearchedData:e,isSearchedDataStatus:t||a.isSearchedDataStatus,listName:null==e?void 0:e.isSearchName,userId:null==e?void 0:e.userId,approvalStatus:(null==e?void 0:e.approvalStatus)||"",isFilterApply:!0})));const s={...a,...e};j(s,!1,(()=>{}))}}),[n,j,x]),q=m.useCallback((e=>{if(!1===ie(n.totalCount)){const e=re();if(4===(null==e?void 0:e.planId))return void o((t=>({...t,planId:e.planId})));o((e=>({...e,limitExceed:!0})))}else o((t=>({...t,dublicateListModal:!0,listName:e.dynamicListName,listId:e.dynamicListID,previousListName:e.dynamicListName+"_Copy"})))}),[n.totalCount]),$=m.useCallback((e=>{const t=void 0===e.dataItem.expanded?e.dataItem.aggregates:e.dataItem.expanded;e.dataItem.expanded=!t||!1;const a=[...n.dynamicList];a[e.dataIndex].expanded=e.dataItem.expanded,1==!t&&G(e.dataIndex,e.dataItem.dynamicListID,e.dataItem.expanded),o((e=>({...e,dynamicList:a,dataResult:Array.prototype.reverse.call(C(a,aa))})))}),[n.dynamicList]),G=m.useCallback(((e,t,a)=>{const s={dynamiclistId:t};o((e=>({...e,channelListErrMsg:null}))),D({path:A,params:s,ok:t=>{var s,l;if(t.status){0===(null==(l=null==(s=null==t?void 0:t.data)?void 0:s.campaignsList)?void 0:l.length)&&o((e=>({...e,channelListErrMsg:"No data"})));const i=[...n.dynamicList],r=Math.floor(e%n.dataState.take),d=i[r];d.expand=a,d.info=t.data,o((e=>({...e,dynamicList:i,dataResult:Array.prototype.reverse.call(C(i,aa))})))}else o((e=>({...e,channelListErrMsg:"No data"})))},fail:()=>{o((e=>({...e,channelListErrMsg:"No data"})))}})}),[n.dynamicList,n.dataState.take]),P=m.useCallback((({dataItem:e})=>u.jsx("td",{children:u.jsx("div",{className:"camp-icon",children:u.jsxs("ul",{className:"camp-icon-pannel",children:[u.jsx("li",{className:`${R((null==e?void 0:e.createdBy)||0)} ${0===e.recentBlastedCount?"click-on":"click-off"} ${n.getUpdateAccessData?"click-on":"click-off"}`,children:u.jsx(ne,{placement:"top",text:"Edit",children:u.jsx("i",{id:"dl_edit_button",className:"icon-rs-pencil-edit-medium icons-md blue",onClick:()=>{const t="click-off"===R((null==e?void 0:e.createdBy)||0);i.push({pathname:"audience/new-dynamic-list",search:`?lId=${e.dynamicListID}&bc=${e.recentBlastedCount}&ar=false&view=${t}`,state:{mode:"edit",listId:e.dynamicListID,dataItem:e,blastCount:e.recentBlastedCount}})}})})}),u.jsx("li",{className:n.getViewAccessData?"click-on":"click-off",children:u.jsx(ne,{placement:"top",text:"View",children:u.jsx("i",{className:"icon-rs-eye-medium icons-md color-primary-blue cursor-pointer",id:"dl_view_button",onClick:()=>{i.push({pathname:"audience/new-dynamic-list",search:`?lId=${e.dynamicListID}&bc=1&ar=false&view=true`,state:{type:"view",mode:"edit",listId:e.dynamicListID,dataItem:e,blastCount:e.recentBlastedCount}})}})})}),u.jsx("li",{className:n.getUpdateAccessData?"click-on":"click-off",children:u.jsx(ne,{placement:"top",text:"Duplicate",children:u.jsx("i",{className:`icon-rs-duplicate-medium icons-md blue ${!0===oe()&&"click-off"}`,id:"dl_duplicate_button",onClick:()=>q(e)})})}),u.jsx("li",{children:u.jsx(ne,{placement:"top",text:"Info",children:u.jsx("i",{className:`icon-rs-circle-info-medium icons-md color-primary-blue ${0===e.recentBlastedCount&&"click-off"}`,id:"dl_info_button",onClick:()=>{o((t=>({...t,selectItem:e,isOpenInfoModal:!t.isOpenInfoModal})))}})})}),u.jsx(ne,{placement:"top",text:0===e.approverStatus?"Pending for approval":1===e.approverStatus?"Approved":2===e.approverStatus?"Rejected":3===e.approverStatus?"Approval not enabled":"",children:u.jsx("li",{className:!0===(null==e?void 0:e.isRequestApproval)||3===e.approverStatus?"click-on":"click-off",children:u.jsx("i",{className:`icons-md ${!1===e.isRequestApproval||3===e.approverStatus?"icons-md icon-rs-user-tick-medium grey":0===e.approverStatus?"icon-rs-user-question-mark-edge-medium orange":1===e.approverStatus?"icons-md icon-rs-user-tick-medium green":2===e.approverStatus?"icon-rs-user-tick-medium red":3===e.approverStatus?"icons-md icon-rs-user-tick-medium grey":"icon-rs-user-tick-medium blue"} ${e.isRequestApproval?"":"click-off"} ${V((null==e?void 0:e.createdBy)||0)}`,id:"dl_approver_status_button",onClick:()=>{i.push({pathname:"audience/new-dynamic-list",search:`?lId=${e.dynamicListID}&bc=${e.recentBlastedCount}&ar=${e.isRequestApproval}`,state:{mode:"edit",listId:e.dynamicListID,dataItem:e,blastCount:e.recentBlastedCount}})}})})})]})})})),[R,V,n.getUpdateAccessData,n.getViewAccessData,q,i]),H=m.useMemo((()=>n.dublicateListModal&&u.jsxs(Ze,{show:n.dublicateListModal,centered:!0,children:[u.jsxs(Ze.Header,{children:[u.jsx("h2",{children:"Duplicate list"}),u.jsx(lt,{mainClass:n.modalClose?"close click-off":"close",size:"md",handleClose:()=>{o((e=>({...e,dublicateListModal:!1,errMsgDynamicListName:null,checkNameExist:!1})))}})]}),u.jsxs(Ze.Body,{children:[u.jsx(ht,{required:!0,label:"List name",placeholder:0===n.previousListName.length?"Enter the dynamic list name":"List name",errorMessage:n.errMsgDynamicListName,val:n.previousListName,max:Nt,isLoading:n.listNameLoader,cb:e=>{if((null==e?void 0:e.length)>0&&o((e=>({...e,modalClose:!0}))),!e.includes("'")&&(""===e||/^[' 'A-Za-z0-9_-]*$/.test(e))){const t=e.replace(/\s+/g," ");o((e=>({...e,previousListName:t.trimStart(),errMsgDynamicListName:null})))}},ob:e=>{if(null!=n.errMsgDynamicListName)return;const t=0===e.length?"Enter dynamic list name":null;o((e=>({...e,errMsgDynamicListName:t,listNameLoader:!0}))),I(n.previousListName,(e=>{o((e=>({...e,listNameLoader:!1}))),!0===e&&o((e=>({...e,listNameStatus:!0,dublicateListModal:!0,modalClose:!1})))}))},onFocus:e=>{""!==e.target.value&&o((e=>({...e,modalClose:!0})))}}),u.jsx("div",{className:"btn-container d-flex justify-content-end w-100 mb0 mt30",children:u.jsxs("div",{className:(n.modalClose?"click-off":"")+" d-flex",children:[u.jsx(U,{onClick:()=>{o((e=>({...e,dublicateListModal:!1,errMsgDynamicListName:null,checkNameExist:!1})))},children:"Cancel"}),u.jsx("div",{className:null!==n.errMsgDynamicListName?"click-off":"",children:u.jsx(z,{onClick:()=>{null!==n.previousListName?null===n.errMsgDynamicListName&&(o((e=>({...e,listNameLoader:!0}))),I(n.previousListName,(e=>{o((e=>({...e,listNameLoader:!1}))),!0===e&&(o((e=>({...e,dublicateListModal:!1,errMsgDynamicListName:null,checkNameExist:!1,listNameStatus:!1}))),f(n.listId,n.previousListName))}))):o((e=>({...e,errMsgDynamicListName:"Enter dynamic list name"})))},children:"Save"})})]})})]})]})),[n.dublicateListModal,n.modalClose,n.previousListName,n.errMsgDynamicListName,n.listNameLoader,n.checkNameExist,n.listId,I,f]),K=m.useMemo((()=>{var e;return u.jsx(St,{config:n.dataState,data:null==(e=n.result)?void 0:e.data,settings:{total:n.totalCount},pageable:!0,isDataStateRequired:!0,onDataStateChange:w,pageStateChange:T,column:[{field:"dynamicListName",filter:"text",title:"List name",cell:e=>{var t,a,s;return u.jsx("td",{children:u.jsx("span",{children:0===(null==(a=null==(t=e.dataItem)?void 0:t.dynamicListName)?void 0:a.length)?Mt:null==(s=e.dataItem)?void 0:s.dynamicListName})})}},{field:"createdByName",filter:"text",title:"Created by",width:200,cell:e=>{var t;return u.jsx("td",{children:u.jsx("span",{children:null==(t=e.dataItem)?void 0:t.createdByName})})}},{field:"createdDate",title:"Created on",width:170,cell:e=>u.jsx("td",{children:M(e.dataItem[e.field])})},{field:"recentBlastedCount",filter:"text",title:"No. of linked communications",cell:e=>{var t;return u.jsx("td",{className:"text-end",children:u.jsx("span",{children:null==(t=e.dataItem)?void 0:t.recentBlastedCount})})}},{field:"action",title:"Actions",cell:P}]})}),[n.dataState,null==(e=n.result)?void 0:e.data,n.totalCount,w,T,P]),W=m.useCallback((e=>u.jsx(Zt,{...e,approverList:n.approverList,totalCount:n.totalCount,dublicateButtonClicked:q,infoButtonClicked:e=>{o((t=>({...t,selectItem:e,isOpenInfoModal:!t.isOpenInfoModal})))},callback:()=>{}})),[n.approverList,n.totalCount,q]),Y=m.useCallback((e=>{var t,a,s;return(null==(s=null==(a=null==(t=null==e?void 0:e.dataItem)?void 0:t.info)?void 0:a.campaignsList)?void 0:s.length)>0?u.jsx(ea,{data:e.dataItem}):u.jsx("div",{className:"theme-space-m mb10",children:u.jsx(Ue,{isError:!!n.channelListErrMsg,count:2})})}),[n.channelListErrMsg]),ce=m.useMemo((()=>u.jsx(Qe,{children:u.jsx(et,{children:u.jsx("div",{className:"rs-grid-listing",children:u.jsx(L,{total:n.totalCount,className:"grid-pagenation rs-grid-listing",sortable:!1,scrollable:"none",groupable:!1,pageable:n.totalCount>5?{type:"numeric",info:!1,pageSizes:[5,10,20,50],previousNext:!0,buttonCount:4,className:"rs-kendo-pager"}:null,data:n.dynamicList,...n.dataState,onDataStateChange:w,detail:Y,expandField:"expanded",onExpandChange:$,children:u.jsx(S,{field:"customerID",cell:W})})})})})),[n.totalCount,n.dynamicList,n.dataState,w,Y,$,W]),ue=m.useMemo((()=>{var e,t,a,s,r;const[h,g]=m.useState(0);return m.useEffect((()=>{d.current&&g(d.current.clientWidth)}),[]),u.jsxs("div",{className:"my15 p0 sd-dynamiclist-wrapper",children:[u.jsxs("div",{ref:d,className:`rs-ad-search-container marginB15 ${n.periyaMenu?"advanced-search-opened":"advanced-search-closed"} ${!0===n.listLoading?"click-off":"click-on"} position-relative zIndex3`,children:[u.jsxs("div",{ref:c,className:"advanceSearchLeft "+(n.periyaMenu?"periya-menu-enabled":"periya-menu-disabled"),children:[4===n.planId&&u.jsxs(Ze,{show:!0,centered:!0,onHide:()=>o((e=>({...e,planId:0}))),children:[u.jsxs(Ze.Header,{children:[u.jsx("h2",{children:"Alert"}),u.jsx(lt,{mainClass:"close",size:"md",handleClose:()=>o((e=>({...e,planId:0})))})]}),u.jsx(Ze.Body,{children:u.jsx("div",{className:"d-flex align-items-center justify-content-start",children:u.jsx("label",{className:"py10",children:"You have reached the maximum limit"})})})]}),n.limitExceed&&u.jsx(ft,{size:"md",headerTitle:"Dynamic list",para:"Dynamic list limit exceeded, please upgrade your plan.",primaryButtonText:"Proceed",secondaryButtonText:"Cancel",buttonClicked:e=>{o((e=>({...e,limitExceed:!1}))),!0===e&&i.push("/subscription")}}),u.jsx(ze,{isShowDateRangePicker:n.isShowDateRangePicker,enable:!0,closeDateRangePicker:_,applyBtnClicked:e=>o((t=>({...t,applyBtn:e}))),cancelBtnClicked:()=>o((e=>({...e,isShowDateRangePicker:!1}))),class:"marginR10"})]}),u.jsx("div",{ref:p,className:"search-view-container "+(n.periyaMenu?"periya-menu-enabled":"periya-menu-disabled"),children:u.jsx(Wt,{fullWidth:h,onPeriyaMenuChange:e=>o((t=>({...t,periyaMenu:e}))),onSearchDataReceived:B})}),u.jsx("div",{ref:v,className:"advanceSearchRight ml15 "+(n.periyaMenu?"periya-menu-enabled":"periya-menu-disabled"),children:null!==n.dynamicList&&u.jsx(O,{id:"dl_add_button",icon:de,size:"lg",shadow:!0,tooltip:"Create dynamic list",iconClass:`${!0===n.noapps&&"click-on"} ${!0===oe()&&"click-off"} ${n.getAddAccessData?"click-on":"click-off"}`,onClick:()=>{if(!1===ie(n.totalCount)){const e=re();if(4===(null==e?void 0:e.planId))return void o((t=>({...t,planId:e.planId})));o((e=>({...e,limitExceed:!0})))}else i.push({pathname:`${l.url}/new-dynamic-list`,search:"?lId=0&bc=0",state:{mode:"add",listId:0,blastCount:0}})}})})]}),n.listError?u.jsx(Qe,{children:u.jsx("div",{className:"box-design pb10",children:u.jsx(Ue,{count:5,isError:n.listError,children:u.jsxs("div",{className:"nodata-bar add-func",children:[u.jsx("i",{className:"icon-rs-alert-medium icons-md orange-medium"}),u.jsx("p",{children:"No record matched"})]})})})}):u.jsx(u.Fragment,{children:!n.isDuplicate&&(null==(e=null==n?void 0:n.dynamicList)?void 0:e.length)>0?u.jsxs(u.Fragment,{children:["/audience1"===window.location.pathname.toLowerCase()&&ce,"/audience"===window.location.pathname.toLowerCase()&&K]}):0===(null==(t=n.dynamicList)?void 0:t.length)?u.jsx("div",{className:"box-design pb10",children:u.jsx(Ue,{isError:n.noData,count:4,children:u.jsxs("div",{className:"nodata-bar",children:[u.jsx(O,{icon:J,size:"md",color:"orange-medium",mainClass:"mr5"}),u.jsx("p",{children:n.isSearchedDataStatus?"No records available":"No data available"})]})})}):!1===n.applyBtn&&0===(null==(a=n.dynamicList)?void 0:a.length)&&0===(null==(s=n.listName)?void 0:s.length)?u.jsx("div",{className:"box-design pb10",children:u.jsx(Ue,{count:5,isError:n.noData,children:u.jsxs("div",{className:`nodata-bar add-func ${oe()&&"click-off"}`,onClick:()=>{i.push({pathname:`${l.url}/new-dynamic-list`,search:"?lId=0&bc=0",state:{mode:"add",listId:0,blastCount:0}})},children:[u.jsx("i",{className:"icon-rs-circle-plus-fill-edge-medium icons-md color-primary-blue cursor-pointer px5"}),u.jsx("p",{children:"Create"})]})})}):n.applyBtn&&0===(null==(r=n.dynamicList)?void 0:r.length)&&0===n.listName.length||n.noData?u.jsx("div",{className:"box-design pb10",children:u.jsx(Ue,{isError:n.noData,children:u.jsxs("div",{className:"nodata-bar",children:[u.jsx(O,{icon:J,size:"md",color:"orange-medium",mainClass:"mr5"}),u.jsx("p",{children:"No data available"})]})})}):null})]})}),[n,i,l,_,B,K,ce]);return m.useEffect((()=>(b(),y(),()=>{document.body.classList.remove("dynamicList")})),[b,y]),m.useEffect((()=>{s.apiStateData.getIsReloadData&&(s.apiStateData.setIsReloadData(!1),j(x(),!1,(()=>{})));const e=document.getElementsByClassName("k-link k-pager-nav");Object.keys(e).forEach(((t,a)=>{e[a].title=""}))}),[s.apiStateData,j,x]),u.jsxs(Je,{children:[u.jsx(st,{fluid:!0,className:"main-heading-wrapper mb0",children:u.jsxs(st,{className:"mhw-container",children:[u.jsx("div",{className:"mhwc-left",children:u.jsx("h1",{children:u.jsx("div",{className:"mh-wrapper",children:u.jsx("span",{className:"mh-text",children:"Dynamic lists"})})})}),u.jsx("div",{className:"mhwc-right",children:((null==(t=n.CompanyListData)?void 0:t.length)>0||null!=n.companyDropdownSelectedItem)&&u.jsx(Tt,{data:n.CompanyListData,defaultItem:null==(a=null==n?void 0:n.companyDropdownSelectedItem)?void 0:a.clientName,alignRight:!0,fieldKey:"clientName",onSelect:e=>{o((e=>({...e,startDate:la(it(sa(-29)).format("DD MMM yyyy")),endDate:la(it(new Date).format("DD MMM yyyy")),userId:e.userId,pageCount:1,isBlastCount:"",filterType:0,approvalStatus:""}))),b()}})})]})}),H,u.jsxs(st,{className:"page-header box-bottom-space",children:[ue,n.isOpenInfoModal&&u.jsx(Kt,{isOpen:n.isOpenInfoModal,selectItem:n.selectItem,onChangeIsOpen:()=>{o((e=>({...e,isOpenInfoModal:!e.isOpenInfoModal})))}})]})]})},ra={dynamicListApprovalID:0,dynamicListId:0,dynamicListListName:"",departmentId:0,userid:0,roleID:0,isMandatory:!1,firstName:"Buvanesh",lastName:null,email:"-- Select approver --",accessToken:null,errorMessage:""},na={email:"-- Select approver list --",userid:0},oa=({approvalList:e,approverList:t,approvalSettings:a,isReqApprSettings:s,isRFAhierarchy:l,onApprovalListChange:i,onApprovalSettingsChange:r})=>{var n,o,d;const c=m.useContext(k),[p,h]=m.useState({approverList:t||[],localApprovalList:[...e||[]],isModalOpen:!1,matchType:(null==a?void 0:a.approvalMatchType)||"All",anyCount:(null==a?void 0:a.approvalMatchCount)||0,followHierarchyChecked:(null==a?void 0:a.isFollowHierarchyEnabled)||!1,backupData:{matchType:(null==a?void 0:a.approvalMatchType)||"All",anyCount:(null==a?void 0:a.approvalMatchCount)||0,followHierarchyChecked:(null==a?void 0:a.isFollowHierarchyEnabled)||!1}});m.useEffect((()=>{h((t=>({...t,localApprovalList:[...e||[]],matchType:(null==a?void 0:a.approvalMatchType)||"All",anyCount:(null==a?void 0:a.approvalMatchCount)||0,followHierarchyChecked:(null==a?void 0:a.isFollowHierarchyEnabled)||!1})))}),[e,a]);const v=m.useCallback((e=>{h((t=>({...t,localApprovalList:[...e]}))),null==i||i(e)}),[i]),g=m.useCallback((e=>{null==r||r(e)}),[r]),x=m.useCallback((()=>{const e={dbName:"cust_c4363a53_4d19_4eb9_b83e_d3ba1f1f9f1e",departmentId:0,clientId:E()};D({path:se,params:e,isServiceWorker:!1,loading:c.globalStateData.setIsLoadingData,sessionOut:c.globalStateData.setSessionOutData,ok:e=>{h((t=>{var a;return{...t,approverList:(null==(a=null==e?void 0:e.data)?void 0:a.length)>0?e.data:[]}}))},fail:()=>{h((e=>({...e,approverList:[]})))}})}),[c.globalStateData.setIsLoadingData,c.globalStateData.setSessionOutData]),y=m.useCallback((()=>{var e;if(!(null==(e=p.approverList)?void 0:e.length))return[na];const t=p.approverList.filter((e=>{var t;return!(null==(t=p.localApprovalList)?void 0:t.some((t=>t.email===e.email)))}));return 0===t.length?[]:t}),[p.approverList,p.localApprovalList]),b=m.useCallback(((e,t)=>{const a=e.target.value.email.length>0?null:ce,s=[...p.localApprovalList];s[t]={...e.target.value,errorMessage:a},v(s)}),[p.localApprovalList,v]),j=m.useCallback(((e,t)=>{if("add"===t&&p.localApprovalList.length<3){let e=!0;const t=[...p.localApprovalList];t.forEach((t=>{ue(t.email)||t.email.toLowerCase().includes("select")?(e=!1,t.errorMessage=ce):t.errorMessage=""})),e?(t.push({...ra}),v(t)):v(t)}else if("remove"===t){const t=[...p.localApprovalList];t.splice(e,1),t.forEach((e=>{e.isMandatory=!1})),h((e=>({...e,matchType:"All"}))),v(t),g({...a,approvalMatchType:"All",approvalMatchCount:0})}}),[p.localApprovalList,v,g,a]),f=m.useCallback(((e,t)=>{const a=[...p.localApprovalList];e.isMandatory?a[t].isMandatory=!1:p.localApprovalList.length>p.anyCount&&p.localApprovalList.filter((e=>e.isMandatory)).length<p.localApprovalList.length-2&&(a[t].isMandatory=!0),v(a)}),[p.localApprovalList,p.anyCount,v]),C=m.useCallback((()=>{let e=!1;const t=[...p.localApprovalList];t.forEach((t=>{e||!ue(t.email)&&!t.email.toLowerCase().includes("select")||(t.errorMessage=ce,e=!0)})),e?v(t):h((e=>({...e,isModalOpen:!0})))}),[p.localApprovalList,v]),L=m.useCallback((()=>{const e=[{...ra}];v(e)}),[v]),S=m.useCallback((()=>{h((e=>({...e,isModalOpen:!1})))}),[]),N=m.useCallback((e=>{const t="All"===e?0:1;h((a=>({...a,matchType:e,anyCount:t,..."Any"===e&&{followHierarchyChecked:!1}})));const s={...a,approvalMatchType:e,approvalMatchCount:t,..."Any"===e&&{isFollowHierarchyEnabled:!1}};g(s);const l=p.localApprovalList.map((e=>({...e,isMandatory:!1})));v(l)}),[a,g,p.localApprovalList,v]),I=m.useCallback((e=>{h((t=>({...t,anyCount:e})));const t={...a,approvalMatchCount:e};g(t),null==s||s(e);const l=p.localApprovalList.map((e=>({...e,isMandatory:!1})));v(l)}),[a,g,s,p.localApprovalList,v]),w=m.useCallback((()=>{const e=!p.followHierarchyChecked;h((t=>({...t,followHierarchyChecked:e,...e&&{matchType:"All",anyCount:0}})));const t={...a,isFollowHierarchyEnabled:e,...e&&{approvalMatchType:"All",approvalMatchCount:0}};g(t),null==l||l(e)}),[p.followHierarchyChecked,a,g,l]),A=m.useCallback((()=>{h((e=>({...e,matchType:e.backupData.matchType,anyCount:e.backupData.anyCount,followHierarchyChecked:e.backupData.followHierarchyChecked,isModalOpen:!1})));const e={...a,approvalMatchType:p.backupData.matchType,approvalMatchCount:p.backupData.anyCount,isFollowHierarchyEnabled:p.backupData.followHierarchyChecked};if(g(e),"all"===p.backupData.matchType.toLowerCase()){const e=p.localApprovalList.map((e=>({...e,isMandatory:!1})));v(e)}}),[p.backupData,p.localApprovalList,a,g,v]),M=m.useCallback((()=>{const e={matchType:p.matchType,anyCount:p.anyCount,followHierarchyChecked:p.followHierarchyChecked};h((t=>({...t,isModalOpen:!1,backupData:e})))}),[p.matchType,p.anyCount,p.followHierarchyChecked]);m.useEffect((()=>{(null==t?void 0:t.length)?h((e=>({...e,approverList:t}))):x()}),[t,x]);const T=m.useMemo((()=>y()),[y]),R=m.useMemo((()=>{var e;const t=(null==(e=p.localApprovalList)?void 0:e.length)||0;return 2===t?[1]:3===t?[1,2]:[]}),[null==(n=p.localApprovalList)?void 0:n.length]),V=m.useMemo((()=>{var e,t;return(null==(e=p.approverList)?void 0:e.length)>0&&(null==(t=p.localApprovalList)?void 0:t.map(((e,t)=>{var a;const s=t===p.localApprovalList.length-1,l=p.approverList.length!==p.localApprovalList.length&&p.localApprovalList.length<3,i=1!==p.anyCount&&""!==p.matchType&&3===p.localApprovalList.length&&"all"!==p.matchType.toLowerCase();return u.jsx(yt,{children:u.jsxs(Qe,{children:[u.jsxs(et,{md:8,children:[u.jsx(mt,{required:!0,id:`dl_approver_value${t+1}`,label:`Approver ${t+1}`,errorMessage:e.errorMessage,data:T,textField:"email",dataItemKey:"userid",value:e,onChange:e=>b(e,t)}),s&&u.jsx(Qe,{children:u.jsx(et,{children:u.jsx(Rt,{className:"justify-content-end "+(1===p.localApprovalList.length?"click-off d-none":""),children:u.jsx(Y,{alignRight:!0,children:u.jsx(O,{tooltip:"Approval settings",icon:"icon-rs-settings-medium",id:"dl_approver_settings",onClick:C})})})})})]}),u.jsx(et,{md:2,children:u.jsx(Vt,{children:u.jsxs(Y,{children:[u.jsx(O,{id:0===t?"dl_approver_add":"dl_approver_remove",tooltip:0===t?"Add":"Remove",icon:"icons-md color-primary-blue cursor-pointer d-block "+(0===t?l?"icon-rs-circle-plus-fill-edge-medium":"icon-rs-circle-plus-fill-edge-medium click-off":"icon-rs-circle-minus-fill-edge-medium red"),onClick:()=>j(t,0===t?"add":"remove")}),i&&u.jsx(O,{mainClass:"mt5",id:"dl_approver_mandadory",tooltip:"Set mandatory",color:e.isMandatory?"color-primary-red":"mand-field",icon:e.isMandatory?"icon-rs-asterisk-mini red mand-field cursor-pointer":"icon-rs-asterisk-mini mand-field cursor-pointer",size:"sm",onClick:()=>f(e,t)}),u.jsx(O,{tooltip:"Reset",id:"dl_approver_reset",icon:("-- Select approver --"===(null==(a=p.localApprovalList[0])?void 0:a.email)||0!==t?"d-none":"on")+" icon-rs-refresh-medium icons-md color-primary-blue d-none",onClick:L})]})})})]})},t)})))}),[p.approverList,p.localApprovalList,p.anyCount,p.matchType,T,b,C,j,f,L]),_=m.useMemo((()=>{var e;return p.isModalOpen&&u.jsxs(Ze,{onHide:S,show:p.isModalOpen,centered:!0,size:"lg",children:[u.jsxs(Ze.Header,{children:[u.jsx("h2",{children:"Request approval settings"}),u.jsx(lt,{id:"dl_approver_close_button",mainClass:"close",size:"md",handleClose:S})]}),u.jsxs(Ze.Body,{children:[u.jsx(yt,{className:"mt20",children:u.jsxs(Qe,{children:[u.jsx(et,{md:3,children:u.jsx(bt,{label:"Get approval from"})}),u.jsx(et,{md:9,children:u.jsxs(Et,{children:[u.jsx("li",{children:u.jsx(pt,{lbl:"All",id:"dl_approver_settings_all",name:"rmatchtype",labelId:"dl_approver_settings_all",checked:"all"===p.matchType.toLowerCase(),handleChange:()=>N("All")})}),u.jsx("li",{className:"pl15",children:u.jsx(pt,{lbl:"Any",name:"rmatchtype",labelId:"dl_approver_settings_any",id:"dl_approver_settings_any",checked:"any"===p.matchType.toLowerCase(),handleChange:()=>N("Any")})}),"any"===p.matchType.toLowerCase()&&u.jsx("li",{className:"pl15",children:u.jsx(mt,{required:!0,label:"Any count",id:"dl_approver_settings_anycount",data:R,value:p.anyCount,customAlignRight:!0,className:"mb0 match-type-input",onChange:e=>I(e.target.value)})})]})})]})}),u.jsx(yt,{children:u.jsxs(Qe,{className:1===(null==(e=p.localApprovalList)?void 0:e.length)||"all"===p.matchType.toLowerCase()?"click-on":"",children:[u.jsx(et,{md:3,children:u.jsx(bt,{label:"Follow hierarchy"})}),u.jsx(et,{md:3,children:u.jsx(_t,{className:"mt9 "+("any"===p.matchType.toLowerCase()?"click-off":""),id:"dl_approver_hierarchy",onChange:w,checked:p.followHierarchyChecked})})]})})]}),u.jsxs(Ze.Footer,{children:[u.jsx(U,{id:"dl_approver_cancel_button",onClick:A,children:"Cancel"}),u.jsx(z,{id:"dl_approver_save_button",onClick:M,children:"Save"})]})]})}),[p.isModalOpen,p.matchType,p.anyCount,p.followHierarchyChecked,null==(o=p.localApprovalList)?void 0:o.length,R,S,N,I,w,A,M]);return u.jsxs("div",{children:[u.jsxs(Qe,{className:"custom-approval",children:[(null==(d=p.approverList)?void 0:d.length)>0&&u.jsx(et,{md:3,children:u.jsx(bt,{label:"Send approval request to"})}),u.jsx(et,{md:5,children:V})]}),_]})},da=(e,t)=>{if(!t||0===t.length)return!1;const a=e.toLowerCase();for(let s=0;s<t.length;s++){const l=t[s];if(void 0===l.rulename||""===l.rulename||l.rulename.toLowerCase().includes("select"))return l.error.errRulename="Select Rule",!1;{let t=!1;if("location"===a?t=ca(l,e):"forms"===a?t=ua(l):"mobile app"!==a&&"website"!==a||(t=ma(l,e)),!t)return!1}}return!0},ca=(e,t)=>{var a=!1;if("latitude & longitude - radius"===e.rulename.toLowerCase()){if(void 0!==e.value&&""!==e.value&&e.value.split(":").length>2){let t=!1,s=e.value.split(":");for(let e=0;e<s.length;e++){const l=s[e];if(!0===t)break;if(""===l){t=!0,a=!1;break}}return!0!==t}}else"beacon"===e.rulename.toLowerCase()||"city/area"===e.rulename.toLowerCase()||"city"===e.rulename.toLowerCase()?void 0!==e.name&&""!==e.name&&("Website"===t||void 0!==e.value&&""!==e.value)&&(a=!0):"location url"===e.rulename.toLowerCase()&&void 0!==e.value&&""!==e.value&&(a=!0);return a},ua=e=>{var t=!1;return"forms"!==e.rulename.toLowerCase()&&"attributes"!==e.rulename.toLowerCase()||void 0!==e.name&&""!==e.name&&void 0!==e.value&&""!==e.value&&(t=!0),"page url"===e.rulename.toLowerCase()&&void 0!==e.value&&""!==e.value&&(t=!0),"page url"!==e.rulename.toLowerCase()&&"form submission date"!==e.rulename.toLowerCase()||void 0!==e.value&&""!==e.value&&(t=!0),t},ma=(e,t)=>{var a,s,l,i,r=!1;return"forms"===e.rulename.toLowerCase()?r=ua(e):"city"===e.rulename.toLowerCase()||"city/area"===e.rulename.toLowerCase()||"location url"===e.rulename.toLowerCase()||"latitude & longitude - radius"===e.rulename.toLowerCase()||"beacon"===e.rulename.toLowerCase()?r=ca(e,t):"geofence"===e.rulename.toLowerCase()?(null==(a=null==e?void 0:e.name)?void 0:a.length)>0&&(null==(s=null==e?void 0:e.value)?void 0:s.length)>0&&(null==(l=null==e?void 0:e.geoFenceData)?void 0:l.length)>0||(e.error.name="Select compare",!1):e.compareValue.toLowerCase().includes("select")?(e.error.errCompare="Select compare",!1):""===e.value||void 0===e.value||null===e.value?(e.error.errValue="Select value",!1):"custom events"===e.rulename.toLowerCase()&&"contains"===e.compareValue.toLowerCase()&&(null==(i=e.customAttributtes)?void 0:i.length)>0?!Ca(e.customAttributtes):(void 0!==e.value&&""!==e.value&&(r=!0),r)},pa=(e,t)=>{var a=[!1,"Enter valid dynamic list"];if(""===e)return a=[!1,"Enter valid dynamic list"];""!==e&&(a=!0);let s=!1;return t.length>0&&t.map(((e,t)=>{!1===s&&(!1===(a=ha(e,t))[0]&&(s=!0),!0===a[0]&&e.rule.length>0&&((a=da(e.trigger,e.rule))?a=[!0,""]:(a=[!1,"Select valid rules & value"],s=!0)))})),a},ha=(e,t)=>{var a=[!1,""];if(""===e.matchtype)return e.error.errMatchType="Select match type",[!1,"Select match type"];if("all"===e.matchType.toLowerCase())a=[!0,""];else{if("any"!==e.matchType.toLowerCase()||""===e.matchCount)return e.error.errMatchType="Fill any count value",[!1,"Fill any count value"];if(0===e.rule.filter((e=>e.mandatory)).length&&1!==(null==e?void 0:e.matchCount))return e.error.errMatchType="Any count value & rule attributes mismatch in Rule group"+parseInt(t+1),[!1,"Any count value & rule attributes mismatch in Rule group"+parseInt(t+1)];if(!(e.matchCount<e.rule.length))return e.error.errMatchType="Any count value & rule attributes mismatch in Rule group"+parseInt(t+1),[!1,"Any count value & rule attributes mismatch in Rule group"+parseInt(t+1)];a=[!0,""]}return""!==e.trigger?(a=[!0,""],e.trigger.toLowerCase().includes("web")?void 0!==e.source&&""!==e.source&&!1===e.source.domainUrl.toLowerCase().includes("select")?a=[!0,""]:(e.error.errSource="Select source",a=[!1,"Select source"]):e.trigger.toLowerCase().includes("mobile")&&(void 0!==e.source&&""!==e.source&&!1===e.source.appGuid.toLowerCase().includes("select")?a=[!0,""]:(e.error.errSource="Select source",a=[!1,"Select source"]))):(e.error.errTrigger="Select trigger",a=[!1,"Select trigger"]),a},va=e=>{const t=F();let a={dynamicListRule:{RuleSummary:"",RuleGroups:e.ruleList.length,RuleCondition:e.ruleCondition,RuleMatch1:{},RuleMatch2:{},RuleGroup1:{},RuleGroup2:{}},dynamicListName:e.listName,noOfRules:e.ruleList.length,dynamicListId:e.listId,isRequestApproval:e.isRequestApproval,objectRequestApproval:ga(e),dbName:"cust_c4363a53_4d19_4eb9_b83e_d3ba1f1f9f1e",departmentId:0,userId:t.userId,clientId:t.clientId,fromCampaign:"",campaignId:0,tenantShortCode:"T8Q",businessShortCode:"I",currentUserEmail:t.emailId};for(let s=0;s<e.ruleList.length&&s<2;s++){const t=e.ruleList[s];0===s?(a.dynamicListRule.RuleMatch1=xa(t),a.dynamicListRule.RuleGroup1=ba(t)):1===s&&(a.dynamicListRule.RuleMatch2=xa(t),a.dynamicListRule.RuleGroup2=ba(t))}return a},ga=e=>{let t=[],a=e;const s=F(),l=rt.parse(window.location.search);let i=window.location.origin+window.location.pathname+"?",r=0;(null==l?void 0:l.lId)&&(r=parseInt(null==l?void 0:l.lId)),i=i+"lId="+r+"&bc=0";for(let n=0;n<e.approverList.length;n++){const l=e.approverList[n];l.dynamicListId=a.listId,l.approverEmail=l.email,l.approverName=l.firstName;const r={dynamicListApprovalID:l.userId,dynamicListId:a.listId,dynamicListListName:a.listName,departmentId:0,approverName:l.firstName,approverEmail:l.email,approvalCondition:a.approverSetting.approvalMatchType,isMandatory:(null==l?void 0:l.isMandatory)||!1,noOfApprover:"all"===a.approverSetting.approvalMatchType.toLowerCase()?a.approverList.length:null==a?void 0:a.approverSetting.approvalMatchCount,isHierarchy:a.approverSetting.isFollowHierarchyEnabled,approvalStatus:0,makeChangesComments:"",commentCreatedBy:0,priority:(a.approverSetting.isFollowHierarchyEnabled,n+1),emailAcknowledge:"",createdDate:new Date,createdBy:s.userId,createdEmail:s.emailId,modifiedDate:null,modifiedBy:null,status:1,reRequestCount:0,domainName:a.domainName,parameter:i,approverCount:a.approverList.length};t.push(r)}return t},xa=e=>({Combination:e.matchType,Count:0===e.matchCount?"":e.matchCount}),ya=e=>{switch(e.toLowerCase()){case"website":return 1;case"mobile app":return 5;case"forms":return 13;case"location":return 18;default:return 0}},ba=e=>{let t={MatchType:e.matchType,MatchCount:e.matchCount,RuleType:"",TriggerName:ya(e.trigger),RuleAttributes:[]};for(let a=0;a<e.rule.length;a++){const s=e.rule[a];let l="",i=0;5===t.TriggerName?(l=e.source.appName,i=e.source.appGuid):1===t.TriggerName?(l=e.source.domainUrl,i=new URL(l).host):13===t.TriggerName?(l="",i=13):18===t.TriggerName&&(l=e.source,i=18);const r={Name:s.rulename,FieldType:s.type,Mandatory:void 0!==s.mandatory&&s.mandatory,CompareValue:"forms"===s.rulename.toLowerCase()?null==s?void 0:s.value:void 0!==s.compareValue?s.compareValue:"=",AttributeName:null==s?void 0:s.name,auidenceCount:(null==s?void 0:s.auidenceCount)||0,isRecency:(null==s?void 0:s.isRecency)||!1,recencyValue:(null==s?void 0:s.recencyValue)||null,hourValue:(null==s?void 0:s.hourItem)||"",Value:"forms"===s.rulename.toLowerCase()?null==s?void 0:s.formId:s.value,SourceName:l,AttributeType:(null==s?void 0:s.attributeType)||"",AttributeValue:(null==s?void 0:s.customAttributtes)||[],AttributteData:(null==s?void 0:s.customAttributtesData)||[],RudimentaryTableName:i,Id:s.id,GeofenceId:(null==s?void 0:s.geoFenceId)||"",GeoFenceData:null,isSelectAll:(null==s?void 0:s.isSelectAll)||!1,selectedValue:(null==s?void 0:s.selectedValue)||[]};null!==(null==s?void 0:s.geoFenceData)&&void 0!==(null==s?void 0:s.geoFenceData)&&(r.AttributeValue=s.geoFenceData),t.RuleAttributes.push(r)}return t},ja=(e,t,a,s)=>{let l=me,i=1;"mobile app"!==e.toLowerCase()&&"mobile"!==e.toLowerCase()||(l=pe,i=5),"location"===e.toLowerCase()&&(l=pe,i=18),"forms"===e.toLowerCase()&&(i=13),l=he;let r={dbName:"cust_c4363a53_4d19_4eb9_b83e_d3ba1f1f9f1e",departmentId:0,triggerId:i};const n=rt.parse(window.location.search);let o=0;(null==n?void 0:n.lId)&&(o=parseInt(null==n?void 0:n.lId));try{D({path:l,isServiceWorker:!1,isCache:!1,params:r,loading:0===o&&t.globalStateData.setIsLoadingData,ok:e=>{1==i&&(null==e||e.data.forEach((e=>{"City/Area"===e.name&&(e.name="City")}))),a(e)},fail:e=>{s(e)}})}catch(d){}},fa=(e,t,a)=>1==e.mandatory||a.filter((e=>!0===e.mandatory)).length<a.length-2?"click-on":"click-off disabled",Ca=e=>{var t,a;for(let s=0;s<e.length;s++){const l=e[s];if(""===(null==l?void 0:l.attributeName))return l.errAttributteName="Select attribute name",!0;if(""===(null==l?void 0:l.attributeCompare)||(null==(t=null==l?void 0:l.attributeCompare)?void 0:t.toLowerCase().includes("select")))return l.errAttributeCompare="Select attribute compare",!0;if(""!==(null==l?void 0:l.attributeCompare)&&(null==(a=null==l?void 0:l.attributeCompare)?void 0:a.toLowerCase().includes("between"))){if(""===(null==l?void 0:l.attributeFrom))return l.errAttributeFrom="Enter from",!0;if(""===(null==l?void 0:l.attributeTo))return l.errAttributeTo="Enter to",!0}else if(""===(null==l?void 0:l.attributteValue))return l.errAttributteValue="Select attribute value",!0}return!1};class La extends m.Component{constructor(){super(...arguments),c(this,"state",{latitude:(null==(a=null==(t=null==(e=this.props)?void 0:e.selectValues)?void 0:t.value)?void 0:a.length)>0&&this.props.selectValues.value.split(":").length>0?this.props.selectValues.value.split(":")[0]:"",longitude:(null==(i=null==(l=null==(s=this.props)?void 0:s.selectValues)?void 0:l.value)?void 0:i.length)>0&&this.props.selectValues.value.split(":").length>1?this.props.selectValues.value.split(":")[1]:"",radius:(null==(o=null==(n=null==(r=this.props)?void 0:r.selectValues)?void 0:n.value)?void 0:o.length)>0&&this.props.selectValues.value.split(":").length>2?this.props.selectValues.value.split(":")[2]:""}),c(this,"componentDidMount",(()=>{})),c(this,"latLongComponent",(e=>u.jsxs(Qe,{children:[u.jsx(et,{md:4,children:u.jsx(ht,{required:!0,placeholder:"Latitude",keyboardType:"number",val:this.state.latitude,max:It,cb:e=>{this.latitude=e,this.setState({latitude:e},(()=>{this.props.selectValues.value=this.state.latitude+":"+this.state.longitude+":"+this.state.radius})),this.forceUpdate()}})}),u.jsxs(et,{md:5,className:"d-flex",children:[u.jsx("label",{className:"mr20",children:"to"}),u.jsx(ht,{required:!0,placeholder:"Longitude",keyboardType:"number",val:this.state.longitude,max:wt,cb:e=>{this.setState({longitude:e},(()=>{this.props.selectValues.value=this.state.latitude+":"+this.state.longitude+":"+this.state.radius})),this.longitude=e}})]}),u.jsx(et,{md:3,children:u.jsx(mt,{required:!0,label:"Radius",data:["2 KM","3 KM","4 KM"],defaultItem:""===this.state.radius?"-- Select --":this.state.radius,onChange:e=>{this.setState({radius:e.target.value}),this.props.selectValues.value=this.state.latitude+":"+this.state.longitude+":"+e.target.value,this.forceUpdate()}})})]})))}render(){return u.jsx(u.Fragment,{children:"latitude & longitude - radius"===this.props.rulename.toLowerCase()&&u.jsx(this.latLongComponent,{})})}}const Sa=(e,t,a)=>{D({path:ve,isServiceWorker:!1,isCache:!1,loading:e.globalStateData.setIsLoadingData,params:t,ok:e=>{(null==e?void 0:e.status)?a(e):a({status:!1,data:[]})},fail:e=>{}})},Na=(e,t,a)=>{D({path:ge,isCache:!1,isServiceWorker:!1,params:t,ok:t=>{var s,l;if(null==t?void 0:t.status){let i=1===e?(null==(s=null==t?void 0:t.data)?void 0:s.webTokens)||0:5===e&&(null==(l=null==t?void 0:t.data)?void 0:l.pushTokens)||0;a({token:i})}else a({token:0})},fail:e=>{a({token:0})}})},Ia=e=>{var t,a,s;const[l,i]=m.useState(!0),[r,n]=m.useState((null==(t=null==e?void 0:e.data)?void 0:t.recencyFrom)||He(-7)),[o,d]=m.useState((null==(a=null==e?void 0:e.data)?void 0:a.recencyTo)||He(0)),[c,p]=m.useState((null==(s=null==e?void 0:e.data)?void 0:s.frequency)||"1"),[h,v]=m.useState(!1),g=(e,t)=>{(null==t?void 0:t.start)&&(null==t?void 0:t.end)&&(n(null==t?void 0:t.start),d(null==t?void 0:t.end)),v(e)};return u.jsxs(Ze,{show:l,centered:!0,size:`${e.size?e.size:"md"}`,children:[u.jsxs(Ze.Header,{children:[u.jsx("h2",{children:"Recency"}),u.jsx(lt,{mainClass:"close",size:"md",handleClose:()=>{var t,a,s;i(!1),e.cancelBtnClicked({recencyFrom:(null==(t=null==e?void 0:e.data)?void 0:t.recencyFrom)||He(-7),recencyTo:(null==(a=null==e?void 0:e.data)?void 0:a.recencyFrom)||He(0),frequency:(null==(s=null==e?void 0:e.data)?void 0:s.frequency)||"1"})}})]}),u.jsxs(Ze.Body,{children:[u.jsx(yt,{children:u.jsxs(Qe,{children:[u.jsx(et,{md:3,children:u.jsx(bt,{label:"Recency"})}),u.jsx(et,{md:8,children:u.jsx(ze,{data:{from:r,to:o},closeDateRangePicker:(e,t)=>{g(e,t)},cancelBtnClicked:()=>{g(!1)},applyBtnClicked:e=>{v(!1)},isShowDateRangePicker:h,show:!0,class:"marginR10",enable:!0})})]})}),u.jsx(yt,{children:u.jsxs(Qe,{children:[u.jsx(et,{md:3,children:u.jsx(bt,{label:"Frequency"})}),u.jsx(et,{md:8,children:u.jsxs(Qe,{children:[u.jsx(et,{md:7,children:u.jsx(mt,{required:!0,id:"dl_frequency_item",label:"Frequency",data:["1","2","3","4","5","6","7"],value:""!==c?c:"-- Select -- ",onChange:e=>{p(e.target.value)}})}),"/ Times"]})})]})})]}),u.jsxs("div",{className:"d-flex justify-content-end mt30",children:[u.jsx(U,{onClick:()=>{var t,a,s;i(!1),e.cancelBtnClicked({recencyFrom:(null==(t=null==e?void 0:e.data)?void 0:t.recencyFrom)||He(-7),recencyTo:(null==(a=null==e?void 0:e.data)?void 0:a.recencyFrom)||He(0),frequency:(null==(s=null==e?void 0:e.data)?void 0:s.frequency)||"1"})},variant:"outline-success",children:"Cancel"}),u.jsx(z,{onClick:()=>{i(!1),it(r).format("MMM DD YYYY"),it(o).format("MMM DD YYYY"),e.selectBtnClicked({recencyFrom:r,recencyTo:o,frequency:c})},variant:"outline-success",children:"Select"})]})]})},wa=e=>{const[t,a]=m.useState(null);function s(e,t,a){return{regionName:e,latitude:t,longitude:a,radius:"",radiusType:""}}function l(t,a){fetch(`https://nominatim.openstreetmap.org/reverse?format=json&lat=${t}&lon=${a}`).then((e=>e.json())).then((l=>{var i,r;if((null==(i=null==l?void 0:l.display_name)?void 0:i.length)>0){let i=null==(r=null==l?void 0:l.display_name)?void 0:r.split(",");i.length>0?e.onDataUpdate(s(i[0],t,a)):e.onDataUpdate(s("",t,a))}else e.onDataUpdate(s("",t,a))})).catch((e=>{}))}function i(){const e=Ot({click(t){a([t.latlng.lat.toFixed(4),t.latlng.lng.toFixed(4)]),l(t.latlng.lat.toFixed(4),t.latlng.lng.toFixed(4)),e.flyTo(t.latlng,e.getZoom),e.locate()},locationfound(t){e.flyTo(t.latlng,e.getZoom)}});return null!==t&&u.jsx(qt,{position:t,children:u.jsx($t,{children:t[0]+","+t[1]})})}return m.useEffect((()=>{!function(){if(!("geolocation"in navigator)){let e=null;return null!==localStorage.getItem("bdetails")&&(e=xe(localStorage.getItem("bdetails")),a([e.latitude,e.longitude]),l(e.latitude,e.longitude)),e}navigator.geolocation.getCurrentPosition((function(e){var t=e.coords.latitude,s=e.coords.longitude;a([t,s]),l(t,s)}))}()}),[]),u.jsx(u.Fragment,{children:null!==t&&u.jsxs(Ft,{center:t,zoom:13,style:{height:"500px"},children:[u.jsx(Bt,{url:"https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png",attribution:"Â© OpenStreetMap contributors"}),u.jsx(i,{})]})})};class ka extends m.Component{constructor(){super(...arguments),c(this,"state",{regionName:"",errRegionName:null,latitute:"",errLatitude:null,longitute:"",errLongitute:null,radius:"",errRadius:null,radiusType:"",errRadiusType:null,zoneList:[]}),c(this,"addRegionBtnClicked",(()=>{var e;!0===(e=>{let t=!1;return ue(e.regionName)?(e.errRegionName="Enter region name",t=!0,t):ue(e.latitute)?(e.errLatitude="Enter latitute",t=!0,t):ue(e.longitute)?(e.errLongitute="Enter longitute",t=!0,t):ue(e.radius)?(e.errRadius="Enter radius",t=!0,t):ue(e.radiusType)?(e.errRadiusType="Select radius type",t=!0,t):t})(this.state)?this.setState({state:this.state}):this.setState({zoneList:[(e=this.state,{regionName:e.regionName,latitute:e.latitute,longitute:e.longitute,radius:e.radius,radiusType:e.radiusType})]})})),c(this,"LoadZoneComponent",(()=>u.jsxs(Qe,{children:[u.jsxs("div",{className:"align-items-center d-flex mb10",children:[u.jsx("i",{className:"icon-rs-events-mini icon-sm color-primary-blue padding-R5"}),u.jsx("h4",{className:"mb-0 padding-L5",style:{paddingLeft:5},children:"Zones List"})]}),this.state.fieldTrackData.map(((e,t)=>u.jsxs("div",{className:"event-tracking-list",children:[u.jsxs("div",{className:"event-actions",children:[!0===e.eventTracking.markAsGoal&&u.jsx("span",{children:u.jsx("i",{className:"icon-rs-goal-achieved-medium icons-md blue"})}),u.jsx("span",{children:u.jsx("i",{className:!0===e.eventTracking.mandadory?"icon-rs-asterisk-mini red icons-sm mand-field cursor-pointer":"icon-rs-asterisk-mini icons-sm mand-field cursor-pointer",onClick:()=>{let e=[...this.state.elementArray];e[t].eventTracking.mandadory=!e[t].eventTracking.mandadory,this.setState({elementArray:e})}})}),u.jsx("span",{children:u.jsx("i",{className:"icon-rs-delete-medium icons-md color-primary-blue cursor-pointer",onClick:()=>{let t=[...this.state.elementArray];const a=t.indexOf(e);a>-1&&t.splice(a,1);let s=[...this.state.controlsArray];s.map((t=>{t.viewId===e.field.viewId&&(t.select=!1,t.click=!1)}));let l=[...this.state.selectControls];l.map((t=>{t.viewId===e.field.viewId&&(t.select=!1,t.click=!1)})),this.setState({elementArray:t,selectControls:l,controlsArray:s})}})})]}),u.jsxs("div",{className:"event-section",children:[u.jsxs("div",{className:"event-row",children:[u.jsx("span",{className:"label-field",children:"Friendly name:"}),u.jsx("span",{className:"label-value",children:e.eventTracking.friendlyName})]}),u.jsxs("div",{className:"event-row",children:[u.jsx("span",{className:"label-field",children:"Attribute name:"}),u.jsx("span",{className:"label-value",children:e.eventTracking.trackingType.displayName})]})]})]})))]})))}componentDidMount(){}render(){return u.jsxs(u.Fragment,{children:[u.jsxs("div",{className:"header-title d-flex justify-content-between",children:[u.jsx("h1",{children:"Location map"}),u.jsxs("div",{className:"back-text",onClick:()=>this.props.cancelBtnClicked(),children:[u.jsx(O,{icon:ye,size:"sm"}),"Back"]})]}),u.jsx("hr",{className:"blue"}),u.jsxs(st,{fluid:!0,className:"field-tracking-container mobile-field",children:[u.jsx("div",{children:u.jsxs(Qe,{children:[u.jsx(et,{md:9,className:"field-tracking-content-wrapper",children:u.jsx(wa,{onDataUpdate:e=>{this.setState({regionName:e.regionName,latitute:e.latitude,longitute:e.longitude,radius:e.radius,radiusType:e.radiusType}),this.setState({zoneList:[]})}})}),u.jsx(et,{sm:3,className:"field-tracking-cost-wrapper",style:{top:0},children:u.jsxs(u.Fragment,{children:[u.jsx("h2",{style:{color:"blue"},children:"Add zone"}),u.jsxs(st,{fluid:!0,className:`features-container mobile-field ${this.state.zoneList.length>0&&"click-off"}`,children:[u.jsx(yt,{children:u.jsx(Qe,{children:u.jsx("div",{className:"postion-releative",children:u.jsx(ht,{required:!0,placeholder:"Region name",val:this.state.regionName,max:50,cb:e=>{let t=0===e.length?"Add region":null;this.setState({regionName:e,errRegionName:t})},ob:e=>{let t=0===e.length?"Add region":null;this.setState({regionName:e,errRegionName:t})},errorMessage:this.state.errRegionName})})})}),u.jsx(yt,{children:u.jsxs(Qe,{children:[u.jsx(et,{children:u.jsx(ht,{placeholder:"Latitute",required:!0,val:this.state.latitute,cb:e=>{let t=0===e.length?"Enter latitute":null;this.setState({latitute:e,errLatitude:t})},ob:e=>{let t=0===e.length?"Enter latitute":null;this.setState({latitute:e,errLatitude:t})},errorMessage:this.state.errLatitude})}),u.jsx(et,{children:u.jsx(ht,{placeholder:"Longitute",required:!0,val:this.state.longitute,cb:e=>{let t=0===e.length?"Enter longitute":null;this.setState({longitute:e,errLongitute:t})},ob:e=>{let t=0===e.length?"Enter longitute":null;this.setState({longitute:e,errLongitute:t})},errorMessage:this.state.errLongitute})})]})}),u.jsx(yt,{children:u.jsxs(Qe,{children:[u.jsx(et,{children:u.jsx(ht,{placeholder:"Radius",required:!0,val:this.state.radius,type:"number",max:5,cb:e=>{if(e.length>5){let e="Max radius reached";return void this.setState({errRadius:e})}let t=0===e.length?"Enter radius":null;this.setState({radius:e,errRadius:t})},ob:e=>{if(e.length>5){let e="Max radius reached";return void this.setState({errRadius:e})}let t=0===e.length?"Enter radius":null;this.setState({radius:e,errRadius:t})},errorMessage:this.state.errRadius})}),u.jsx(et,{children:u.jsxs("div",{className:"position-relative",children:[this.state.errRadiusType&&u.jsx("div",{className:"validation-message",children:this.state.errRadiusType}),u.jsx(ot,{className:"required",data:["Miles","KM","Feet","Meter"],value:""!==this.state.radiusType?this.state.radiusType:"-- Select --",onChange:e=>{this.setState({radiusType:e.target.value,errRadiusType:null})}})]})})]})}),u.jsxs("div",{className:"d-flex justify-content-end marginT30",children:[u.jsx("div",{children:u.jsx(U,{onClick:()=>{this.props.cancelBtnClicked()},children:"Cancel"})}),u.jsx("div",{children:u.jsx(z,{onClick:()=>{this.addRegionBtnClicked()},children:"Add"})})]})]}),this.state.zoneList.length>0&&u.jsxs("div",{className:"event-section",children:[u.jsx("i",{className:"icon-rs-delete-medium icons-md blue",style:{position:"relative",left:"95%"},onClick:()=>{this.setState({zoneList:[]})}}),this.state.zoneList.map((e=>Object.keys(e).map((t=>u.jsx("div",{className:"event-tracking-list",children:u.jsx("div",{className:"event-section",children:u.jsxs("div",{className:"event-row",children:[u.jsx("span",{className:"label-field",children:t+" : "}),u.jsx("span",{className:"label-value",children:e[t]})]})})})))))]})]})})]})}),u.jsxs("div",{className:"d-flex justify-content-end marginT30",children:[u.jsx("div",{children:u.jsx(U,{onClick:()=>{this.props.cancelBtnClicked()},children:"Cancel"})}),u.jsx("div",{className:this.state.zoneList.length>0?"click-on":"click-off",children:u.jsx(z,{onClick:()=>{this.props.generateLink("https://resu.io/loc123")},children:"Generate"})})]})]})]})}}c(ka,"contextType",k);const Da=v(ka);class Aa extends m.Component{constructor(){super(...arguments),c(this,"state",{formsData:[],beaconData:["11ex06fW","11ey06fX","11o20336","11o30337","11oB033F","11e006fZ","11oC033G","11er06fQ","11oG033L","11ew06fV"],cityData:[{type:"dropdown",index:0,name:"Chennai"}],cityInputType:"dropdown",city:"",area:"",treeUpdate:2,isLoadMap:!1}),c(this,"componentDidMount",(()=>{this.getLocationData()})),c(this,"getLocationData",(()=>{D({path:be,params:{userId:F().userId},loading:this.context.globalStateData.setIsLoadingData,ok:e=>{var t;let a=[{type:"text",name:"Enter your location"}];if(e.status){let s=[];null==(t=null==e?void 0:e.data)||t.map(((e,t)=>{s.push({type:"dropdown",index:t,name:e})})),a[0].index=s.length,this.setState({cityData:s.concat(a)})}else this.setState({cityData:a})},fail:e=>{}})})),c(this,"loadbeaconComponent",(()=>u.jsxs(Qe,{children:[u.jsx(et,{children:u.jsx(mt,{required:!0,label:"Name",data:["11ex06fW","11ey06fX","11o20336","11o30337","11oB033F","11e006fZ","11oC033G","11er06fQ","11oG033L","11ew06fV"],value:void 0!==this.props.selectValues.name&&""!==this.props.selectValues.name?this.props.selectValues.name:"-- Select type --",onChange:e=>{this.props.onChanged(e.target.value),this.props.selectValues.name=e.target.value}})}),u.jsx(et,{children:u.jsx(mt,{required:!0,label:"Value",className:"required",data:["In","Out"],defaultItem:void 0!==this.props.selectValues.value&&""!==this.props.selectValues.value?this.props.selectValues.value:"-- Select type --",onChange:e=>{this.props.onChanged(e.target.value),this.props.selectValues.value=e.target.value}})})]}))),c(this,"loadCityComponent",(e=>{var t;return u.jsxs(Qe,{children:[this.state.cityData.length>0&&"dropdown"===this.state.cityInputType&&u.jsx(et,{children:u.jsx(mt,{required:!0,className:"required",label:"City",data:this.state.cityData,textField:"name",dataItemKey:"index",value:void 0!==this.props.selectValues.name&&""!==this.props.selectValues.name?{type:"dropdown",name:this.props.selectValues.name}:{type:"dropdown",name:"-- Select --"},onChange:e=>{"dropdown"===e.target.value.type&&(this.props.selectValues.name=e.target.value.name),this.props.selectValues.value="",this.setState({cityInputType:e.target.value.type}),this.props.onChanged(e.target.value)}})}),"text"===this.state.cityInputType&&u.jsx(et,{children:u.jsx(ht,{required:!0,placeholder:"Enter city",iconPlaceholder:!0,iconName:K,iconColor:"red",iconSize:"sm",iconOnClick:()=>{this.props.selectValues.name="",this.props.selectValues.value="",this.setState({cityInputType:"dropdown"})},cb:e=>{this.props.selectValues.name=e,this.props.selectValues.value="",this.setState({treeUpdate:this.state.treeUpdate+1})},onBlur:e=>{this.props.onChanged(e)}})}),(null==(t=this.props.selectValues.name)?void 0:t.length)>0&&"Website"!==this.props.trigger?u.jsx(et,{children:u.jsx(ht,{required:!0,placeholder:"Enter area",val:this.props.selectValues.value,ob:e=>{this.props.onChanged(e)},cb:e=>{this.props.selectValues.value=e,this.setState({treeUpdate:this.state.treeUpdate+1})}})}):null]})})),c(this,"TextComponent",(()=>u.jsx(ht,{required:!0,placeholder:"Enter page url",val:this.props.selectValues.value,max:100,cb:e=>{this.props.selectValues.value=e,this.setState({treeUpdate:this.state.treeUpdate+1})},onBlur:e=>{this.props.onChanged(e)}}))),c(this,"LoadLocationUrlComponent",(()=>u.jsxs(Qe,{children:[u.jsx(et,{md:11,children:u.jsx(this.DefaultComponent,{})}),u.jsx(et,{md:1,children:u.jsx(Vt,{children:u.jsx(Y,{children:u.jsx(O,{icon:je,onClick:()=>{this.setState({isLoadMap:!0})}})})})})]}))),c(this,"MultiSelectComponent",(e=>u.jsx("div",{className:"chips-input-container",children:u.jsx("div",{className:"chips-input-box",children:u.jsx("div",{className:"multi-select-custom multi-select-required",children:u.jsx(ut,{disabled:!!this.props.rulename.includes("select"),required:!0,placeholder:"-- Select --",data:fe(this.props.data,G(this.props.selectValues.value)),value:G(this.props.selectValues.value),allowCustom:!0,onChange:e=>{const t=e.target.value.reduce(((e,t)=>e.find((e=>e===t))?e:e.concat([t])),[]);t.length<=15&&(this.props.selectValues.value=t.toString(),this.props.onChanged(t),this.props.onChanged(t))},filterable:!0,onFilterChange:e=>{e.filter.value.length>10&&(e.filter.value="Rajaram")}})})})}))),c(this,"DefaultComponent",(e=>u.jsx(ht,{disabled:!0,required:!0,placeholder:"Enter value",val:this.props.selectValues.value,max:kt,cb:e=>{this.props.selectValues.value=e,this.props.onChanged(e)}})))}render(){return u.jsxs(u.Fragment,{children:[!0===this.state.isLoadMap&&u.jsx(u.Fragment,{children:u.jsx(Ze,{fullscreen:!0,show:this.state.isLoadMap,children:u.jsx(Ze.Body,{children:u.jsx("div",{children:u.jsx(Da,{cancelBtnClicked:()=>{this.setState({isLoadMap:!1})},generateLink:e=>{this.setState({isLoadMap:!1}),this.props.selectValues.value=e}})})})})}),this.state.treeUpdate>1?u.jsxs(u.Fragment,{children:[this.props.rulename.toLowerCase().includes("select")?u.jsx(this.DefaultComponent,{}):null,"location url"===this.props.rulename.toLowerCase()?u.jsx(this.LoadLocationUrlComponent,{}):null,"latitude & longitude - radius"===this.props.rulename.toLowerCase()?u.jsx(La,{...this.props}):null,"beacon"===this.props.rulename.toLowerCase()?u.jsx(this.loadbeaconComponent,{}):null,"city/area"===this.props.rulename.toLowerCase()||"city"===this.props.rulename.toLowerCase()?u.jsx(this.loadCityComponent,{}):null]}):u.jsx(this.DefaultComponent,{})]})}}c(Aa,"contextType",k);const Ma=e=>{var t,a,s,l,i,r;m.useContext(k);const[n,o]=m.useState([]),[d,c]=m.useState([]),[p,h]=m.useState(0),[v,g]=m.useState({name:(null==(t=e.selectValues)?void 0:t.name)||"",value:(null==(a=e.selectValues)?void 0:a.value)||"",formId:(null==(s=e.selectValues)?void 0:s.formId)||0,attributeType:(null==(l=e.selectValues)?void 0:l.attributeType)||"",compareValue:(null==(i=e.selectValues)?void 0:i.compareValue)||"",attributesData:(null==(r=e.selectValues)?void 0:r.attributesData)||[]});m.useEffect((()=>{e.selectValues&&Object.assign(e.selectValues,v)}),[v,e.selectValues]);const x=m.useCallback((e=>{g((t=>({...t,...e})))}),[]),y=m.useCallback((()=>{D({path:Ce,params:{userId:F().userId},ok:e=>{e.status&&o(e.data)},fail:e=>{}})}),[]),b=m.useCallback((e=>{D({path:Le,params:{formId:e},ok:e=>{var t,a;if(e.status&&(null==(a=null==(t=null==e?void 0:e.data)?void 0:t.attributesData)?void 0:a.length)>0){let t=e.data.attributesData.map(((e,t)=>({id:t+1,attributteName:e.attributteName,type:"t"})));c(t),x({attributesData:t})}},fail:e=>{}})}),[x]);m.useEffect((()=>{y()}),[y]);const j=()=>{var e,t;const a={formName:(null==(e=v.name)?void 0:e.length)>0?v.name:"-- Select form --",formId:v.formId||0},s=(null==(t=v.value)?void 0:t.length)>0?v.value:"-- Select status --";return u.jsxs(Qe,{children:[u.jsx(et,{children:u.jsx(mt,{required:!0,label:"Form",data:n,value:a,textField:"formName",dataItemKey:"formId",onChange:e=>{const t=e.target.value.formId;x({name:e.target.value.formName,formId:t}),h(t),b(t)}})}),u.jsx(et,{children:u.jsx(mt,{required:!0,label:"Form action",data:["Submitted","Not Submitted","Partially Submitted"],value:s,onChange:e=>{x({value:e.target.value})}})})]})},f=()=>{var t,a,s,l,i,r;const n={id:0,attributteName:(null==(t=v.name)?void 0:t.length)>0?v.name:"-- Select attribute --"};return u.jsxs(Qe,{children:[u.jsx(et,{children:u.jsx(mt,{required:!0,label:"Attribute",data:(null==(s=null==(a=null==e?void 0:e.data)?void 0:a[0])?void 0:s.attributesData)||[],value:n,textField:"attributteName",dataItemKey:"id",onChange:e=>{x({name:e.target.value.attributteName,value:"",attributeType:e.target.value.type})}})}),(null==(l=v.name)?void 0:l.length)>0&&u.jsxs(et,{children:["t"===(null==(i=v.attributeType)?void 0:i.toLowerCase())&&u.jsx(ht,{required:!0,placeholder:`${v.name.toLowerCase()}`,val:v.value,cb:e=>{x({value:e})}}),"d"===(null==(r=v.attributeType)?void 0:r.toLowerCase())&&u.jsx(mt,{required:!0,label:"Type",data:["Male","Female"],value:v.value.length>0?v.value:`-- Select ${v.name} --`,onChange:e=>{x({value:e.target.value})}})]})]})},C=()=>u.jsx(Qe,{children:u.jsxs(et,{md:12,className:"d-flex",children:[u.jsx(Gt,{data:["icon-rs-plus-mini icon-sm","icon-rs-minus-mini icon-sm","icon-rs-arrow-left-mini icon-sm","icon-rs-arrow-right-mini icon-sm"],defaultItem:"icon-rs-plus-mini icon-sm",customAlignRight:!0,className:"symbol-dropdown",onSelect:e=>{x({compareValue:e})}}),u.jsx(ht,{required:!0,placeholder:"Enter the no. of days",val:v.value,keyboardType:"number",max:Dt,cb:e=>{(""===e||/^[0-9]{1,9}$/.test(e))&&e<=9&&x({value:e})}})]})}),L=()=>u.jsx(ht,{required:!0,placeholder:"Enter page url",val:v.value,max:100,cb:e=>{x({value:e})}}),S=()=>u.jsx(ht,{disabled:!0,required:!0,ph:"Enter type",val:v.value,max:kt,cb:t=>{var a;x({value:t}),null==(a=e.onChanged)||a.call(e,t)}});return(()=>{switch(e.rulename.toLowerCase()){case"forms":return u.jsx(j,{});case"attributes":return u.jsx(f,{});case"form submission date":return u.jsx(C,{});case"page url":return u.jsx(L,{});default:return u.jsx(S,{})}})()},Ta=e=>{var t;const a=m.useContext(k),[s,l]=m.useState([]),[i,r]=m.useState(null),[n,o]=m.useState(null),[d,c]=m.useState([]),[p,h]=m.useState([]),[v,g]=m.useState(null);m.useEffect((()=>{x()}),[]),m.useEffect((()=>{var t,a;if((null==s?void 0:s.length)>0&&(null==(a=null==(t=null==e?void 0:e.selectValues)?void 0:t.name)?void 0:a.length)>0){let t=s.filter((t=>{var a;return t.identifier===(null==(a=null==e?void 0:e.selectValues)?void 0:a.name)}));t.length>0&&(r(t[0]),y(t[0].geoFenceId,!1))}}),[s]),m.useEffect((()=>{var t,a,s;(null==(a=null==(t=null==e?void 0:e.selectValues)?void 0:t.value)?void 0:a.length)>0&&o(null==(s=null==e?void 0:e.selectValues)?void 0:s.value)}),[null==(t=null==e?void 0:e.selectValues)?void 0:t.value]);const x=()=>{D({path:Se,params:{userId:F().userId},ok:e=>{var t,a;if(e.status&&(null==(t=e.data)?void 0:t.length)>0){let t=null==(a=null==e?void 0:e.data)?void 0:a.filter((e=>1===(null==e?void 0:e.statusID)));l(t)}},fail:e=>{}})},y=(t,s)=>{D({path:Ne,params:{geoFenceId:t},loading:a.globalStateData.setIsLoadingData,sessionOut:a.globalStateData.setSessionOutData,ok:t=>{var a,l,i,r,n,o,d;if(t.status&&(null==t?void 0:t.status)&&(null==(l=null==(a=null==t?void 0:t.data)?void 0:a.cluster)?void 0:l.length)>0){let a=null==(r=null==(i=null==t?void 0:t.data)?void 0:i.cluster)?void 0:r.map((e=>({regionId:e.regionId,placeName:null==e?void 0:e.placeName,latitude:e.latitude,longitude:e.longitude,radius:null==e?void 0:e.radius,radiusType:null==e?void 0:e.radiusType})));c(a),s?(e.selectValues.geoFenceData=a,e.selectValues.originalGeoFenceData=a,h(a)):(e.selectValues.geoFenceData=null==(n=null==e?void 0:e.selectValues)?void 0:n.customAttributtes,e.selectValues.originalGeoFenceData=null==(o=null==e?void 0:e.selectValues)?void 0:o.customAttributtes,h(null==(d=null==e?void 0:e.selectValues)?void 0:d.customAttributtes)),null==e||e.onChange()}},fail:e=>{}})},b=()=>u.jsx(ht,{disabled:!0,required:!0,ph:"Enter type",val:e.selectValues.value,max:kt,cb:t=>{e.selectValues.value=t,e.onChanged(t)}});return"geofence"===e.rulename.toLowerCase()?((null==(f=null==(j=e.selectValues)?void 0:j.name)?void 0:f.length)>0&&(e.selectValues.name,e.selectValues.formId),(null==(L=null==(C=e.selectValues)?void 0:C.value)?void 0:L.length)>0&&(null==(S=e.selectValues)||S.value),u.jsxs(Qe,{children:[u.jsx(et,{md:6,children:u.jsx(mt,{disabled:!((null==s?void 0:s.length)>0),required:!0,label:"Cluster list",data:s,value:i,textField:"identifier",dataItemKey:"geoFenceId",errorMessage:v,onChange:t=>{if(!1===t.target.value.isAllTime){const a=new Date(t.target.value.endDate),s=new Date;s.setHours(0,0,0,0),a>=s?(g(null),e.selectValues.name=t.target.value.identifier,e.selectValues.geoFenceId=t.target.value.geoFenceId,e.selectValues.isSelectAll=!0,r(t.target.value),y(t.target.value.geoFenceId,!0),null==e||e.onChange()):g("Please select a valid cluster with future date")}else e.selectValues.name=t.target.value.identifier,e.selectValues.geoFenceId=t.target.value.geoFenceId,e.selectValues.isSelectAll=!0,r(t.target.value),y(t.target.value.geoFenceId,!0),null==e||e.onChange()}})}),u.jsx(et,{md:6,children:u.jsx(ut,{required:!0,label:"Action",disabled:!!e.rulename.includes("select"),placeholder:"-- Select --",data:["In","Out"],value:G(n),allowCustom:!1,onChange:t=>{e.selectValues.value=t.target.value.toString(),o(t.target.value.toString())},filterable:!0})})]})):u.jsx(b,{});var j,f,C,L,S},Ra=e=>{var t,a,s;const l=m.useContext(k);e.selectValues.latitude,e.selectValues.longitude,m.useRef(null);const[i,r]=m.useState({tagError:null,recency:!1,isMaxCountReached:!1}),n=()=>{let t=["Is equal to","Is not equal to","Contains","Does not contains"],a=e.compareData.map((t=>{if(t.rulename.toLowerCase()===e.rulename.toLowerCase())return t.compareValue}));const s=t.filter((e=>!a.includes(e)));return 0===s.length?t:s},o=({callback:t})=>{var a,s,l;return u.jsx(mt,{label:"Compare",id:"dl_compare",required:!0,disabled:!!e.rulename.includes("select"),data:n(),errorMessage:null==(a=e.selectValues)?void 0:a.error.errCompare,value:""!==(null==(s=e.selectValues)?void 0:s.compareValue)?null==(l=e.selectValues)?void 0:l.compareValue:"-- Select--",onChange:a=>{e.selectValues.error.errCompare=null,t(a.target.value)}})},d=()=>u.jsxs(Qe,{children:[u.jsx(et,{md:5,children:u.jsx(o,{callback:t=>{e.selectValues.compareValue=t,e.onChanged(t)}})}),u.jsx(et,{md:7,children:u.jsx(c,{contains:!1})})]}),c=t=>{var a,s;return u.jsx(mt,{required:!0,id:"dl_rule_value",label:"Value",disabled:!!e.rulename.includes("select"),data:(null==e?void 0:e.data)||[],value:""!==e.selectValues.value?e.selectValues.value:"-- Select type --",errorMessage:null==(s=null==(a=e.selectValues)?void 0:a.error)?void 0:s.errValue,onChange:a=>{e.selectValues.error.errValue=null,e.selectValues.value=a.target.value,e.onChanged(a.target.value),!0===t.contains&&p()}})},p=()=>{let t={};e.trigger.toLowerCase().includes("mobile")?(t.appId=e.source.appGuid,t.eventName=e.selectValues.value):"website"===e.trigger.toLowerCase()&&(e.source.domainId,t.eventName=e.selectValues.value,t.domainName=e.source.domainUrl),Sa(l,t,(t=>{var a;if((null==(a=null==t?void 0:t.data)?void 0:a.length)>0){let a={attributteKeyObject:null,attributeName:"",attributteValue:"",attributeCompare:"",attributeFrom:"",attributeTo:"",errAttributeCompare:null,errAttributteName:null,errAttributteValue:null,errAttributeFrom:null,errAttributeTo:null};e.selectValues.customAttributtes.push(a);let s=t.data.map(((e,t)=>(e.id=t+1,e)));e.selectValues.customAttributtesData=s,e.onChanged(),j()}else e.selectValues.customAttributtes=[],e.selectValues.customAttributtesData=[],e.onChanged(),j()}))},h=()=>{var t,a;let s=e.rulename.toLowerCase().includes("custom")&&e.selectValues.compareValue.toLowerCase().includes("contains")&&e.selectValues.value.length>0,l=void 0===e.selectValues.customAttributtesData||null===e.selectValues.customAttributtesData||0===(null==(t=e.selectValues.customAttributtesData)?void 0:t.length)?"click-off":(null==(a=e.selectValues.customAttributtesData)?void 0:a.length)>e.customAttributtes.length?"click-on":"click-off";return u.jsxs(u.Fragment,{children:[u.jsx(et,{md:7,children:u.jsx(c,{contains:!0})}),s&&u.jsx(et,{md:1,className:l,children:u.jsx(Vt,{className:"ml-15",children:u.jsx(Y,{children:u.jsx(O,{icon:"icon-rs-circle-plus-fill-edge-medium",iconClass:"",iconColor:"blue",size:"md",tooltip:"Add attributte",onClick:()=>{var t;0===(null==(t=e.selectValues.customAttributtesData)?void 0:t.length)?p():(e.onChanged("","attributte"),j())}})})})})]})},v=()=>u.jsx(et,{md:7,children:u.jsx("div",{className:"chips-input-container",children:u.jsx("div",{className:"chips-input-box",children:u.jsxs("div",{className:"multi-select-custom multi-select-required position-relative",children:[i.tagError&&u.jsx("div",{className:"validation-message align-end left10",children:i.tagError}),u.jsx(ut,{required:!0,id:"dl_rule_value",label:"Value",disabled:!!e.rulename.includes("select"),placeholder:"-- Select --",data:fe((null==e?void 0:e.data)||[],G(e.selectValues.value)),value:G(e.selectValues.value),errorMessage:i.isMaxCountReached?Ie:null,allowCustom:!0,onChange:t=>{e.selectValues.error.errValue=null,(t=>{if(null!==i.tagError)return;const a=t.reduce(((e,t)=>e.find((e=>e===t))?e:e.concat([t])),[]);if(a.length<=15){let t=[];a.map((e=>{!1===ue(we(e))&&we(e).length<=75&&t.push(e)})),e.selectValues.value=t.toString(),e.onChanged(t)}})(t.target.value)},onFilterChange:e=>(""===e.target._input.value&&r((e=>({...e,isMaxCountReached:!1}))),null===i.tagError&&e.filter.value.length>75?(r((e=>({...e,isMaxCountReached:!0}))),e.target._input.disabled=!0,e.target._input.value=e.filter.value.substring(0,74),e.filter.value=e.filter.value.substring(0,74),void setTimeout((()=>{e.target._input.disabled=!1}),3e3)):e.filter.value.length<=75?(r((e=>({...e,tagError:null}))),!1):void 0)})]})})})}),g=()=>{var t,a,s,l;return u.jsxs(Qe,{children:[u.jsx(et,{md:5,children:u.jsx(o,{callback:t=>{e.selectValues.compareValue=t,e.onChanged(t),e.rulename.toLowerCase().includes("custom")&&(e.selectValues.value="",e.onChanged(""),j())}})}),(null==(a=null==(t=null==e?void 0:e.rulename)?void 0:t.toLowerCase())?void 0:a.includes("custom"))&&"contains"===(null==(l=null==(s=e.selectValues)?void 0:s.compareValue)?void 0:l.toLowerCase())?u.jsx(h,{}):u.jsx(v,{})]})},x=m.useCallback((()=>{if("forms"===e.rulename.toLowerCase())return u.jsx(Ma,{index:e.index,data:e.formData,rulename:e.rulename,value:e.value,selectValues:e.selectValues},`forms-${e.index}`);if(["city","city/area","location url","latitude & longitude - radius","beacon"].includes(e.rulename.toLowerCase()))return u.jsx(Aa,{trigger:e.trigger,rulename:e.rulename,type:e.type,value:e.value,data:e.data,selectValues:e.selectValues,onChanged:t=>{e.onChanged("value"),j()}},`location-${e.index}`);if("geofence"===e.rulename.toLowerCase())return u.jsx(Ta,{...e,index:e.index,data:e.formData,rulename:e.rulename,value:e.value,selectValues:e.selectValues,onChange:()=>{}},`geofence-${e.index}`);switch(e.type.toLowerCase()){case"d":return u.jsx(d,{},`dropdown-${e.index}`);case"an":return u.jsx("loadCompareComponent",{},`compare-${e.index}`);case"t":return u.jsx(g,{},`multiselect-${e.index}`);default:return u.jsx(ht,{disabled:!0,required:!0,placeholder:"Enter type",val:e.selectValues.value,max:kt,cb:t=>{e.selectValues.value=t,e.onChanged(t)}},`input-${e.index}`)}}),[e.index,e.rulename,e.type,e.selectValues,e.value,e.formData]),y=()=>u.jsx(Vt,{children:u.jsx(Y,{children:u.jsx(O,{id:"dl_recency",tooltip:"Recency",icon:"icon-rs-circle-time-medium",onClick:()=>{r((e=>({...e,recency:!0})))}})})}),b=t=>{e.selectValues.recencyValue=t,j()},j=()=>{r((e=>({...e})))};return u.jsxs(Qe,{md:12,children:[!0===i.recency&&u.jsx(Ia,{data:null==(t=null==e?void 0:e.selectValues)?void 0:t.recencyValue,cancelBtnClicked:e=>{r((e=>({...e,recency:!1}))),b(e)},selectBtnClicked:e=>{r((e=>({...e,recency:!1}))),b(e)}}),u.jsx(et,{md:!0===(null==(a=null==e?void 0:e.ruleData)?void 0:a.isRecency)?11:12,children:u.jsx(x,{})}),!0===(null==(s=null==e?void 0:e.ruleData)?void 0:s.isRecency)&&u.jsx(et,{md:1,children:u.jsx(y,{})})]})};class Va extends m.Component{constructor(){super(...arguments),c(this,"state",{attributtedItem:null,attributtedTagError:null,cattrList:"",cattrKey:"",cattrCompareKey:"",attributeFrom:"",attributeTo:"",errAttributeCompare:null,errAttributteName:null,errAttributteValue:null,errAttributteFrom:null,errAttributteTo:null}),c(this,"getData",(()=>{let e=this.props.keyData,t=[];return e.map((e=>{0===this.props.list.filter((t=>e===t.attributeName)).length&&t.push(e)})),t})),c(this,"DefaultComponent",(e=>u.jsx(et,{md:6,className:"pr5",children:u.jsx(ht,{required:!0,disabled:!0,placeholder:"Attribute value"})}))),c(this,"MultiSelectComponent",(e=>u.jsx("div",{className:"chips-input-container",children:u.jsx("div",{className:"chips-input-box",children:u.jsx("div",{className:"multi-select-custom multi-select-required position-relative",children:u.jsx(ut,{required:!0,label:"Attribute value",disabled:!!this.props.rulename.includes("select"),placeholder:"Type and enter value",data:fe([],G(this.state.cattrList)),value:G(this.state.cattrList),allowCustom:!0,errorMessage:this.state.errAttributteValue,onChange:e=>{if(null!==this.state.attributtedTagError)return;const t=e.target.value.reduce(((e,t)=>e.find((e=>e===t))?e:e.concat([t])),[]);if(t.length<=15){let e=[];t.map((t=>{!1===ue(we(t))&&we(t).length<=75&&e.push(t)})),this.props.selectValues.customAttributtes[this.props.index].attributteValue=e.toString(),this.props.selectValues.customAttributtes[this.props.index].arrributteValue=e.toString(),this.props.data.errAttributteValue=null,this.setState({cattrList:e.toString(),errAttributteValue:null}),this.props.onChanged(e)}},filterable:!0,onFilterChange:e=>null===this.state.attributtedTagError&&e.filter.value.length>75?(this.setState({attributtedTagError:Ie}),e.target._input.disabled=!0,e.target._input.value=e.filter.value.substring(0,74),e.filter.value=e.filter.value.substring(0,74),void setTimeout((()=>{e.target._input.disabled=!1}),3e3)):e.filter.value.length<=75?(this.setState({attributtedTagError:null}),!1):void 0})})})}))),c(this,"getContainsData",(()=>{var e;return(null==(e=this.props.selectValues.customAttributtes[this.props.index].attributteKeyObject)?void 0:e.type.toLowerCase().includes("int"))?["Is equal to","Is not equal to","Is greater than","Is less than","Between"]:["Is equal to","Is not equal to","Contains","Does not contains"]})),c(this,"LoadContainsComponent",(({callback:e})=>u.jsx(mt,{label:"Compare",required:!0,disabled:!!this.props.rulename.includes("select"),data:this.getContainsData(),value:this.state.cattrCompareKey,errorMessage:this.state.errAttributeCompare,onChange:t=>{this.props.data.errAttributeCompare=null,this.setState({cattrCompareKey:t.target.value,errAttributeCompare:null}),e(t.target.value)}}))),c(this,"NewCustomEventAttributte",(e=>{var t,a,s,l,i,r,n,o,d;return u.jsx(yt,{className:this.props.className,style:{width:"90%"},children:u.jsx(Qe,{className:"columnAttribute",children:u.jsx(et,{md:12,className:this.props.className,children:u.jsxs(Qe,{children:[u.jsx(et,{md:4,children:u.jsx(mt,{required:!0,label:"Attribute name",data:this.getData(),textField:"name",dataItemKey:"id",errorMessage:this.state.errAttributteName,value:""!==this.state.cattrKey?this.state.cattrKey:"-- Select--",onChange:e=>{this.props.selectValues.customAttributtes[this.props.index].attributteKeyObject=e.target.value,this.props.selectValues.customAttributtes[this.props.index].attributeName=e.target.value.name,this.props.selectValues.custAttrKey=e.target.value,this.props.selectValues.customeCompareValue="Is equal to",this.props.data.errAttributteName=null,this.setState({cattrKey:e.target.value,errAttributteName:null}),this.props.onChanged(e.target.value)}})}),""===this.props.selectValues.customAttributtes[this.props.index].attributeName&&u.jsx(this.DefaultComponent,{}),""!==this.props.selectValues.customAttributtes[this.props.index].attributeName&&u.jsxs(u.Fragment,{children:[(null==(l=null==(s=null==(a=null==(t=this.props)?void 0:t.selectValues)?void 0:a.custAttrKey)?void 0:s.type)?void 0:l.toLowerCase().includes("date"))?u.jsx(et,{md:3,className:"containsDropdown",children:u.jsx(Gt,{data:["icon-rs-plus-medium icon-md","icon-rs-minus-medium icon-md","icon-rs-arrow-left-mini icon-sm","icon-rs-arrow-right-mini icon-sm"],defaultItem:"icon-rs-plus-mini icon-sm",customAlignRight:!0,className:"ml50",onSelect:e=>{this.props.selectValues.customAttributtes[this.props.index].attributeCompare=e,this.forceUpdate()}})}):u.jsx(et,{md:3,className:"containsDropdown",children:u.jsx(this.LoadContainsComponent,{callback:e=>{this.props.selectValues.customAttributtes[this.props.index].attributeCompare=e,this.forceUpdate()}})}),(null==(d=null==(o=null==(n=null==(r=null==(i=this.props)?void 0:i.selectValues)?void 0:r.customAttributtes[this.props.index])?void 0:n.attributeCompare)?void 0:o.toLowerCase())?void 0:d.includes("between"))?u.jsxs(u.Fragment,{children:[u.jsx(et,{md:2,children:u.jsx(ht,{required:!0,placeholder:"From",val:this.state.attributeFrom,errorMessage:this.state.errAttributteFrom,max:20,onChange:e=>{let t=e.target.value.length>0?null:"Enter from";this.props.data.errAttributeFrom=t,this.props.selectValues.customAttributtes[this.props.index].attributeFrom=e.target.value,this.setState({attributeFrom:e.target.value,errAttributteFrom:t})},onBlur:e=>{let t=e.target.value.length>0?null:"Enter from";this.props.selectValues.customAttributtes[this.props.index].attributeFrom=e.target.value,this.props.selectValues.customAttributtes[this.props.index].attributteValue=this.props.selectValues.customAttributtes[this.props.index].attributeFrom+"-"+this.props.selectValues.customAttributtes[this.props.index].attributeTo,this.props.selectValues.customAttributtes[this.props.index].arrributteValue=this.props.selectValues.customAttributtes[this.props.index].attributeFrom+"-"+this.props.selectValues.customAttributtes[this.props.index].attributeTo,this.setState({attributeFrom:e.target.value,errAttributteFrom:t})}})}),u.jsx(et,{md:2,children:u.jsx(ht,{required:!0,placeholder:"To",val:this.state.attributeTo,errorMessage:this.state.errAttributteTo,max:20,onChange:e=>{let t=e.target.value.length>0?null:"Enter to";this.props.data.errAttributeTo=t,this.props.selectValues.customAttributtes[this.props.index].attributeTo=e.target.value,this.setState({attributeTo:e.target.value,errAttributteTo:t})},onBlur:e=>{let t=e.target.value.length>0?null:"Enter to";this.props.selectValues.customAttributtes[this.props.index].attributeTo=e.target.value,this.props.selectValues.customAttributtes[this.props.index].attributteValue=this.props.selectValues.customAttributtes[this.props.index].attributeFrom+"-"+this.props.selectValues.customAttributtes[this.props.index].attributeTo,this.props.selectValues.customAttributtes[this.props.index].arrributteValue=this.props.selectValues.customAttributtes[this.props.index].attributeFrom+"-"+this.props.selectValues.customAttributtes[this.props.index].attributeTo,this.setState({attributeTo:e.target.value,errAttributteTo:t})}})})]}):u.jsx(et,{md:4,className:"containsValue",children:u.jsx(this.MultiSelectComponent,{})})]}),u.jsx(et,{md:1,className:""!==this.props.selectValues.customAttributtes[this.props.index].attributeName?"ml-15":"ml-5",children:u.jsx(Vt,{children:u.jsx(Y,{children:u.jsx(O,{tooltip:"Remove",icon:ke,color:"red",onClick:()=>{var e=this.props.selectValues.customAttributtes.indexOf(this.props.selectValues.customAttributtes[this.props.index]),t=[...this.props.selectValues.customAttributtes];t.splice(e,1),this.props.selectValues.customAttributtes=t,this.props.onChanged(t)}})})})})]})})})})}))}componentDidMount(){}componentDidUpdate(e){var t,a,s,l,i,r,n,o,d,c,u,m,p,h,v,g,x,y,b,j;this.props!==e&&(this.setState({cattrList:(null==(a=null==(t=this.props)?void 0:t.data)?void 0:a.arrributteValue)||"",cattrKey:(null==(l=null==(s=this.props)?void 0:s.data)?void 0:l.attributteKeyObject)||"",cattrCompareKey:(null==(r=null==(i=this.props)?void 0:i.data)?void 0:r.attributeCompare)||"-- Select --"}),this.setState({errAttributeCompare:(null==(o=null==(n=this.props)?void 0:n.data)?void 0:o.errAttributeCompare)||null,errAttributteName:(null==(c=null==(d=this.props)?void 0:d.data)?void 0:c.errAttributteName)||null,errAttributteValue:(null==(m=null==(u=this.props)?void 0:u.data)?void 0:m.errAttributteValue)||null}),this.setState({attributeFrom:(null==(h=null==(p=this.props)?void 0:p.data)?void 0:h.attributeFrom)||"",attributeTo:(null==(g=null==(v=this.props)?void 0:v.data)?void 0:g.attributeTo)||""}),this.setState({errAttributteFrom:(null==(y=null==(x=this.props)?void 0:x.data)?void 0:y.errAttributeFrom)||null,errAttributteTo:(null==(j=null==(b=this.props)?void 0:b.data)?void 0:j.errAttributeTo)||null}))}render(){return u.jsx(this.NewCustomEventAttributte,{})}}const Ea={trigger:["Website","Mobile app","Forms"]},_a=e=>{var t,a,s,l,i;const r=m.useContext(k),[n,o]=m.useState({matchType:"",anyvalue:"",disabled:e.disabled,errorMessage:null,showPopUp:!0,treeUpdate:1,isRuleRemoveBtnClicked:!1,isConfirmPop:!1,mobileAppList:[],domainsList:[],attributtesList:[],noMobileApps:!1,noWebsite:!1,isLocation:!1,formUpdate:0,triggerSourceLoading:!1,isReset:!1,resetMsg:null}),{data:d,index:c}=e;let{trigger:p,rule:h,source:v,matchType:g,matchCount:x}=d;m.useEffect((()=>{var t;if(o((t=>({...t,rule:e.data.rule}))),""!==p&&!(null==(t=null==p?void 0:p.toLowerCase())?void 0:t.includes("select"))){o((e=>({...e,triggerSourceLoading:!1})));const e=sessionStorage.getItem("dl_live_top_screen");if(e){const t=xe(e).trigger.toLowerCase().includes("mobile")?"mobile":"web";return void L(t)}ja(p,r,(e=>{if(e.status){let t=e.data;"location"===p.toLowerCase()&&(t=t.filter((e=>!["beacon","location url"].includes(e.name.toLowerCase())))),t=t.map((e=>({...e,rulename:e.name,type:e.fieldType,value:e.value&&JSON.parse(e.value)?Object.values(JSON.parse(e.value)):""}))),y(t,p,(e=>{o((e=>({...e,attributtesList:t,triggerSourceLoading:!1})))}))}}),(()=>{}))}}),[p]),m.useEffect((()=>()=>{window.scrollTo(0,0)}),[]);const y=m.useCallback(((e,t,a)=>{let s=[];e.forEach((l=>{const i=h.filter((e=>l.rulename===e.rulename));i.length>0&&(l.value.length>0?(i[0].inputArray=l.value,s.push(i[0]),h.length===s.length&&a(s)):("location"===t.toLowerCase()&&a(e),w(i[0].rulename,(e=>{var t;(null==e?void 0:e.status)&&(null==(t=null==e?void 0:e.data)?void 0:t.appdataList)&&(i[0].inputstringvalue=e.data.appdataList,i[0].inputArray=e.data.appdataList),s.push(i[0]),h.length===s.length&&a(s)}),(()=>{s.push(i[0]),h.length===s.length&&a(s)}))))}))}),[h]);m.useEffect((()=>{e.disabled!==n.disabled&&o((t=>({...t,disabled:e.disabled})))}),[e.disabled]);const b=()=>{o((e=>({...e,errorMessage:null,showPopUp:!1})))},j=m.useCallback((e=>p.toLowerCase().includes("form")&&0===e?[{fieldType:"2D",id:94,name:"Forms",rulename:"Forms",type:"2D",value:["--Select--","Submitted","Not submitted","Partially filled"]}]:n.attributtesList),[p,n.attributtesList]),f=m.useCallback((()=>Ea.trigger.filter((t=>!e.array.some((e=>e.trigger===t))))),[e.array]),C=m.useCallback(((e,t,a)=>{ja(e,r,t,a)}),[r]),L=m.useCallback((async t=>{n.attributtesList.length>0||C(t,(a=>{var s;if(a.status){let l=a.data;"location"===t.toLowerCase()&&(l=l.filter((e=>!["beacon","location url"].includes(e.name.toLowerCase())))),l=l.map((e=>({...e,rulename:e.name,type:e.fieldType,value:e.value&&JSON.parse(e.value)?Object.values(JSON.parse(e.value)):""}))),o((e=>({...e,attributtesList:l}))),e.data.rule=[];const i={rulename:"-- Select rule --",id:0,mandatory:!1,type:"",value:"",customAttributtes:[],customAttributtesData:[],compareValue:"-- Select --",hourItem:"Days",error:{errRulename:null,errCompare:null,errValue:null}},r=sessionStorage.getItem("dl_live_top_screen");if(r){const t=xe(r);i.rulename=t.ruleName,i.value=t.ruleValue,i.inputstringvalue=t.ruleValue,i.type="t",i.compareValue="Is equal to",w(t.ruleName,(t=>{var a,s;(null==t?void 0:t.status)&&(null==(a=null==t?void 0:t.data)?void 0:a.appdataList)&&(i.inputstringvalue=t.data.appdataList,i.inputArray=t.data.appdataList),e.data.rule.push(i),null==(s=e.rulesAdded)||s.call(e)}))}else e.data.rule.push(i);null==(s=e.triggerChanged)||s.call(e,!0)}}),(()=>{}))}),[n.attributtesList,C,e]),S=m.useCallback((()=>{e.data.source="",e.data.trigger="",e.data.rule=[],o((e=>({...e,attributtesList:[],noWebsite:!1,noMobileApps:!1,isLocation:!1})))}),[e]),N=m.useCallback((()=>{const e=Q();o((t=>({...t,mobileAppList:e.mobileAppsList})))}),[]),I=m.useCallback((()=>{const e=Q();o((t=>({...t,domainsList:e.domainsList})))}),[]),w=m.useCallback(((e,t,a)=>{if(p.toLowerCase().includes("location")||p.toLowerCase().includes("form"))return;const s={};let l="";p.toLowerCase().includes("website")?(l=Ae,s.domainName=v.domainUrl,s.listType=A(e)):p.toLowerCase().includes("mobile app")&&(l=Me,s.appId=v.appGuid,s.listType=A(e)),s.listType?D({path:l,isServiceWorker:!1,params:s,sessionOut:r.globalStateData.setSessionOutData,ok:t,fail:a}):t({status:!1})}),[p,v,r]),A=m.useCallback((e=>{const t=e.toLowerCase();return t.includes("screen")||t.includes("page")||t.includes("when user view spefic screen")?"MobileScreens":"custom events"===t?"CustomEvents":t.includes("language")?"Languages":t.includes("app version code")?"AppVersionCode":t.includes("app version name")?"AppVersionName":""}),[]),M=m.useCallback(((t,a,s)=>{var l;const i=t.target.value;a.type=i.type,a.rulename=i.rulename,a.text=i.text,a.id=i.id,a.compareValue="an"===i.type.toLowerCase()?"+":"-- Select --",a.inputstringvalue=[],a.inputArray=[],a.customAttributtes=[],a.customAttributtesData=[],a.isRecency=!1;const r=null==(l=n.attributtesList)?void 0:l.filter((e=>e.name===i.rulename));(null==r?void 0:r.length)>0&&(a.isRecency=r[0].isRecency),i.value&&!ue(i.value)||"an"===i.type.toLowerCase()?(a.value="",a.inputstringvalue=i.value,a.inputArray=i.value,e.data.rule[s]=a):(a.value="",e.data.rule[s]=a,w(a.rulename,(t=>{var l;(null==t?void 0:t.status)&&(null==(l=null==t?void 0:t.data)?void 0:l.appdataList)&&(a.inputstringvalue=t.data.appdataList,a.inputArray=t.data.appdataList,e.data.rule[s]=a)}),(()=>{a.inputstringvalue="",a.inputArray=[],e.data.rule[s]=a})))}),[n.attributtesList,w,e.data.rule]),T=m.useCallback((({index:t,item:a})=>{var s,l;const i=(null==(s=h[t])?void 0:s.auidenceCount)||0,r=(null==(l=h[t])?void 0:l.isLoading)||!1;return u.jsx(et,{md:1,children:u.jsx(Qe,{md:12,children:u.jsx(et,{md:6,children:u.jsxs(Vt,{children:[u.jsxs(Y,{children:[u.jsx(O,{id:0===t?"dl_rule_add":"dl_rule_remove",tooltip:0===t?"Add":"Remove",icon:0===t?h.length<5?"icon-rs-circle-plus-fill-edge-medium":"icon-rs-circle-plus-fill-edge-medium click-off":"icon-rs-circle-minus-fill-edge-medium red",onClick:()=>{var s,l;if(0===t&&h.length<5)if(da(p,h)){null==(s=e.rulesAdded)||s.call(e,1);const t={rulename:"-- Select rule --",id:0,mandatory:!1,type:"",value:"",customAttributtes:[],customAttributtesData:[],compareValue:"-- Select --",hourItem:"Days",error:{errRulename:null,errCompare:null,errValue:null}};0===n.attributtesList.length&&C(p.toLowerCase(),(e=>{if(e.status){let t=e.data;"location"===p.toLowerCase()&&(t=t.filter((e=>!["beacon","location url"].includes(e.name.toLowerCase())))),t=t.map((e=>({...e,rulename:e.name,type:e.fieldType,value:e.value&&JSON.parse(e.value)?Object.values(JSON.parse(e.value)):""}))),o((e=>({...e,attributtesList:t})))}}),(()=>{})),h.push(t)}else o((e=>({...e,errorMessage:"Please fill all mandatory fields",showPopUp:!0})));else{h.forEach((e=>{e.mandatory=!1}));const t=h.indexOf(a);h.splice(t,1),null==(l=e.rulesAdded)||l.call(e,0)}}}),(d=x,c=h.length,1!==d&&c>d&&"all"!==g.toLowerCase()&&u.jsx(O,{tooltip:"Set mandatory",icon:De,size:"sm mt4",color:`${fa(a,0,h)}${a.mandatory?" color-primary-red":"color-primary-grey"}`,onClick:()=>{if(a.mandatory)a.mandatory=!a.mandatory,h[t].mandatory=a.mandatory;else if(h.length>x){const e=h.filter((e=>e.mandatory)).length;if(e>1&&e===x)return;e<h.length-2&&(a.mandatory=!a.mandatory,h[t].mandatory=a.mandatory)}}}))]}),u.jsx("div",{style:{paddingLeft:10},children:r?u.jsx("div",{className:"rs-inputIcon-wrapper top3 pr10",children:u.jsx("div",{className:"segment_loader"})}):u.jsx("label",{className:"green",children:i})})]})})})});var d,c}),[p,h,x,g,n.attributtesList,e.rulesAdded]),R=m.useCallback((({index:t,item:a,className:s})=>{var l,i,r;return"geofence"===(null==(l=h[t].rulename)?void 0:l.toLowerCase())?null:null==(r=null==(i=h[t])?void 0:i.customAttributtes)?void 0:r.map(((l,i)=>{var r;return u.jsx("div",{className:`${0===i&&"marginT40"}`,children:u.jsx(Va,{className:s,list:null==(r=h[t])?void 0:r.customAttributtes,index:i,trigger:p,rulename:a.rulename,type:a.type,keyData:h[t].customAttributtesData||[],value:a.inputstringvalue,data:l,selectValues:h[t],onChanged:(a,s)=>{var l,i;if("delete"===a){const a=h[t];h=[],h[t]=a,h[t].customAttributtes=s,null==(l=e.rulesAdded)||l.call(e,0)}null==(i=e.ruleNameChange)||i.call(e,t)}},"Product Id")})}))}),[p,h,e.ruleNameChange,e.rulesAdded]),V=m.useCallback((()=>{var e,t,a,s;const l=h.filter((e=>{var t;return"geofence"===(null==(t=e.rulename)?void 0:t.toLowerCase())})),i=(null==l?void 0:l.length)>0&&(null==(t=null==(e=l[0])?void 0:e.geoFenceData)?void 0:t.length)>0?null==(a=l[0])?void 0:a.geoFenceData:[];return u.jsx("div",{className:"offset-md-2 geofence-rule-grid",children:u.jsxs("div",{className:"d-flex",children:[u.jsx("div",{className:"bg-blue-50 col-md-8",children:u.jsx("div",{className:"chips-container bg-transparent com-set campaign-tag",children:u.jsx("div",{className:"chips-box position-relative",children:u.jsx(ut,{required:!0,disabled:null==(s=null==l?void 0:l.rulename)?void 0:s.includes("select"),label:"Region",placeholder:"-- Select --",textField:"placeName",identifier:"clusterId",data:i,value:i,allowCustom:!1,onChange:e=>{l[0].geoFenceData=e.target.value},filterable:!0})})})}),u.jsx("div",{className:"ml15 mt15",children:u.jsx(Vt,{children:u.jsx(Y,{children:u.jsx(O,{id:"reset_geofence",tooltip:"Refresh",icon:"icon-rs-refresh-medium icons-md color-primary-blue cursor-pointer",onClick:()=>{l[0].geoFenceData=l[0].originalGeoFenceData}})})})})]})})}),[h]),E="box-design rs-box-min-height border-dashed dynamic-list-creation "+(n.disabled?"click-off":"");return u.jsx(u.Fragment,{children:!n.triggerSourceLoading&&u.jsxs(st,{className:E,children:[n.isRuleRemoveBtnClicked&&u.jsx(Ct,{size:"md",headerTitle:"Dynamic List",para:"Are you sure you want to delete?",secondaryButtonText:"Cancel",primaryButtonText:"OK",buttonClicked:t=>{var a;t?null==(a=e.closeBtnClicked)||a.call(e):o((e=>({...e,isRuleRemoveBtnClicked:!1})))}}),n.isReset&&u.jsx(Ct,{size:"md",headerTitle:"Dynamic List",para:"Are you sure want to reset the data?",secondaryButtonText:"Cancel",primaryButtonText:"OK",buttonClicked:e=>{e?(d.trigger="",d.rule=[],"all"===n.resetMsg.toLowerCase()?(d.matchType=n.resetMsg,d.matchCount="",d.rule.forEach((e=>{e.mandatory=!1}))):"any"===n.resetMsg.toLowerCase()&&(d.matchType=n.resetMsg,d.matchCount=1,d.rule.forEach((e=>{e.mandatory=!1})))):"all"===n.resetMsg.toLowerCase()?d.matchType="Any":"any"===n.resetMsg.toLowerCase()&&(d.matchType="All"),o((e=>({...e,isReset:!1,attributtesList:[]})))}}),n.errorMessage&&u.jsxs(Ze,{show:n.showPopUp,centered:!0,onHide:b,children:[u.jsxs(Ze.Header,{children:[u.jsx("h2",{children:"Alert"}),u.jsx(lt,{mainClass:"close",size:"md",handleClose:b})]}),u.jsx(Ze.Body,{children:u.jsx("p",{className:"text-center",children:n.errorMessage})})]}),u.jsx(yt,{children:u.jsxs(Qe,{children:[u.jsx(et,{children:u.jsx(bt,{label:`Rule group ${c+1}`})}),u.jsx(et,{className:"text-end d-flex justify-content-end",children:0!==c&&u.jsx(O,{icon:K,size:"sm",mainClass:"position-relative top-10 right-10 rs-close",tooltip:"Remove",onClick:()=>{o((e=>({...e,isRuleRemoveBtnClicked:!0})))}})})]})}),u.jsx(yt,{children:u.jsxs(Qe,{children:[u.jsx(et,{md:{span:2,offset:0},children:u.jsx(bt,{label:"Match type"})}),u.jsx(et,{md:6,children:u.jsxs(Et,{children:[u.jsx("li",{children:u.jsx(pt,{id:"dl_matchtype_all",lbl:"All",name:"matchtype"+c,labelId:"dl_matchtype_all"+c,checked:"all"===g.toLowerCase(),handleChange:t=>{d.matchType=t.target.value,d.matchCount="",d.rule.forEach((e=>{e.mandatory=!1})),null==e||e.onChange()}})}),u.jsx("li",{className:"pl15",children:u.jsx(pt,{lbl:"Any",id:"dl_matchtype_any",name:"matchtype"+c,labelId:"dl_matchtype_any"+c,checked:"any"===g.toLowerCase(),handleChange:t=>{d.matchType=t.target.value,d.matchCount=1,d.rule.forEach((e=>{e.mandatory=!1})),null==e||e.onChange()}})}),"any"===g.toLowerCase()&&u.jsx("li",{className:"pl15 col-sm-3",children:u.jsx(mt,{id:"dl_matchcount",required:!0,label:"Any count",data:[1,2,3,4],value:x,customAlignRight:!0,onChange:t=>{d.matchCount=t.target.value,d.rule.forEach((e=>{e.mandatory=!1})),o((e=>({...e,treeUpdate:e.treeUpdate+1}))),null==e||e.onChange()}})})]})})]})}),u.jsx(yt,{children:u.jsxs(Qe,{children:[u.jsx(et,{md:{span:2,offset:0},children:u.jsx(bt,{label:"Select trigger source"})}),u.jsx(et,{md:3,children:u.jsx(mt,{required:!0,id:"dl_trigger_source",label:"Trigger",disabled:!!p,data:f(),errorMessage:null==(t=null==d?void 0:d.error)?void 0:t.errTrigger,value:p||"-- Source --",onChange:e=>{var t,a;if(d.trigger=e.target.value,d.error.errTrigger=null,e.target.value.toLowerCase().includes("website")){d.source={domainUrl:"-- Select source --",sdkDomain:"-- Select --"};const e=Q();(null==(t=null==e?void 0:e.domainsList)?void 0:t.length)>0?I():o((e=>({...e,noWebsite:!0,noMobileApps:!0})))}else if(e.target.value.toLowerCase().includes("mobile app")){d.source={appName:"-- Select source --",appGuid:"-- Select --"};const e=Q();(null==(a=null==e?void 0:e.mobileAppsList)?void 0:a.length)>0?N():o((e=>({...e,noMobileApps:!0,noWebsite:!1})))}else e.target.value.toLowerCase().includes("location")?(o((e=>({...e,isLocation:!0}))),L("location")):e.target.value.toLowerCase().includes("form")&&(o((e=>({...e,isLocation:!0}))),L("forms"))}})}),(p.toLowerCase().includes("form")||p.toLowerCase().includes("location"))&&u.jsx(et,{md:2,children:u.jsx(Vt,{children:u.jsx(Y,{children:p?u.jsx(O,{id:"dl_reset",tooltip:"Reset",icon:"icon-rs-refresh-medium",onClick:S}):(n.noMobileApps||n.noWebsite)&&u.jsx(O,{tooltip:n.noMobileApps&&"mobile app"===p.toLowerCase()?"Add mobile app":"Add website",icon:"icon-rs-circle-plus-fill-edge-medium",id:"dl_source_addbtn",onClick:()=>{const t=(p.toLowerCase(),"/preferences/communication-settings"),a="website"===p.toLowerCase()?{selectIndex:0}:{mobileOnBoarding:!0};e.history.push(t,a)}})})})}),p.toLowerCase().includes("website")&&!n.noWebsite&&u.jsxs(u.Fragment,{children:[u.jsx(et,{md:5,children:u.jsx(mt,{required:!0,label:"Source",id:"dl_source_value",disabled:!(null==(a=null==v?void 0:v.domainUrl)?void 0:a.toLowerCase().includes("select")),data:n.domainsList,errorMessage:null==(s=null==d?void 0:d.error)?void 0:s.errSource,textField:"domainUrl",dataItemKey:"sdkDomain",value:(null==v?void 0:v.domainUrl)?v:{domainUrl:"-- select",sdkDomain:"-- select --"},onChange:e=>{d.error.errSource=null,d.source=e.target.value;const t={appId:"",domainUrl:e.target.value.domainUrl};Na(1,t,(e=>{e.auidence=e.token})),L("web")}})}),p&&u.jsx(et,{md:1,children:u.jsx(Vt,{children:u.jsx(Y,{children:u.jsx(O,{tooltip:"Reset",id:"dl_reset",icon:"icon-rs-refresh-medium",onClick:S})})})})]}),(n.noMobileApps||n.noWebsite)&&p&&u.jsx(et,{md:1,children:u.jsx(Vt,{children:u.jsxs(Y,{children:[u.jsx(O,{tooltip:"Reset",id:"dl_reset",icon:"icon-rs-refresh-medium",onClick:S}),(n.noMobileApps||n.noWebsite)&&u.jsx(O,{tooltip:"website"===p.toLowerCase()?"No web domain configured for this account":"No apps configured for this account",icon:"icon-rs-circle-plus-fill-edge-medium",onClick:()=>{const t=(p.toLowerCase(),"/preferences/communication-settings"),a="website"===p.toLowerCase()?{selectIndex:0}:{mobileOnBoarding:!0};e.history.push(t,a)}})]})})}),p.toLowerCase().includes("mobile app")&&!n.noMobileApps&&u.jsxs(u.Fragment,{children:[u.jsx(et,{md:5,children:u.jsx(mt,{required:!0,label:"Source",id:"dl_source_value",disabled:!(null==(l=null==v?void 0:v.appName)?void 0:l.toLowerCase().includes("select")),data:n.mobileAppList,errorMessage:null==(i=null==d?void 0:d.error)?void 0:i.errSource,textField:"appName",dataItemKey:"appGuid",value:(null==v?void 0:v.appName)?v:{appName:"-- Select --",appGuid:"0000"},onChange:e=>{const t={appId:e.target.value.appGuid,domainUrl:""};d.error.errSource=null,Na(5,t,(e=>{e.auidence=e.token})),L("mobile"),d.source=e.target.value}})}),p&&u.jsx(et,{md:1,children:u.jsx(Vt,{children:u.jsxs(Y,{children:[u.jsx(O,{tooltip:"Reset",id:"dl_reset",icon:"icon-rs-refresh-medium",onClick:S}),(n.noMobileApps||n.noWebsite)&&u.jsx(O,{tooltip:"No apps available",icon:"icon-rs-circle-plus-fill-edge-medium",onClick:()=>{const t=(p.toLowerCase(),"/preferences/communication-settings"),a="website"===p.toLowerCase()?{selectIndex:0}:{mobileOnBoarding:!0};e.history.push(t,a)}})]})})})]})]})}),p&&u.jsx(u.Fragment,{children:h.map(((t,a)=>{var s,l,i,r,n,d,c,m;let g=(null==(l=null==(s=h[a])?void 0:s.customAttributtes)?void 0:l.length)>0;"geofence"===(null==(i=null==t?void 0:t.rulename)?void 0:i.toLowerCase())&&(null==(r=null==t?void 0:t.geoFenceData)?void 0:r.length)>0&&(g=!0);const x=g?"bg-blue-50":"";return u.jsxs(yt,{children:[u.jsxs(Qe,{children:[u.jsx(et,{md:2}),u.jsx(et,{md:2,className:"mb15",children:"Latitude & Longitude - Radius"==(null==t?void 0:t.rulename)&&"website"==p.toLowerCase()&&u.jsx("span",{className:"forgot-txt warning-text font-sm padding0 mb15",txtc:"#fc6a00",children:"low accuracy"})})]}),u.jsxs(Qe,{md:12,children:[u.jsx(et,{md:2}),u.jsx(et,{md:3,className:x,children:u.jsx(mt,{className:g?"mt20":"",label:"Rule",id:"dl_rulename",required:!0,data:j(a),value:t,textField:"rulename",dataItemKey:"id",errorMessage:null==(n=null==t?void 0:t.error)?void 0:n.errRulename,onChange:s=>{h[a].error.errRulename=null,p.toLowerCase().includes("mobile")||p.toLowerCase().includes("web")?(t.compareValue="-- Select --",M(s,t,a)):(t.rulename=s.target.value.rulename,o((e=>({...e,formUpdate:e.formUpdate+1})))),null==e||e.onChange()}})}),u.jsx(et,{md:5,className:x,children:u.jsxs("div",{className:g?"mt20":"",children:[p.toLowerCase().includes("form")&&u.jsx(Ma,{index:a,data:h,rulename:t.rulename,value:t.stringValue,selectValues:h[a]}),(p.toLowerCase().includes("mobile")||p.toLowerCase().includes("web"))&&u.jsx(u.Fragment,{children:u.jsx(Ra,{index:a,source:v,trigger:p,ruleData:t,rulename:t.rulename,customAttributtes:(null==(d=h[a])?void 0:d.customAttributtes)||[],type:t.type,value:t.inputstringvalue,data:(null==t?void 0:t.inputArray)||[],formData:h,compareData:h,selectValues:h[a],onChanged:(s,l)=>{var i,r;if("attributte"===l)if(null==(i=h[a].customAttributtes)?void 0:i.length){if(!Ca(h[a].customAttributtes)){const e={attributteKeyObject:null,attributeName:"",attributteValue:"",attributeCompare:"",attributeFrom:"",attributeTo:"",errAttributeCompare:null,errAttributteName:null,errAttributteValue:null,errAttributeFrom:null,errAttributeTo:null};h[a].customAttributtes.push(e)}}else{const e={attributteKeyObject:null,attributeName:"",attributteValue:"",attributeCompare:"",attributeFrom:"",attributeTo:"",errAttributeCompare:null,errAttributteName:null,errAttributteValue:null,errAttributeFrom:null,errAttributeTo:null};h[a].customAttributtes.push(e)}t.inputstringvalue=s,null==(r=e.ruleNameChange)||r.call(e,a)}})}),p.toLowerCase().includes("location")&&u.jsx(Aa,{trigger:p,rulename:t.rulename,type:t.type,value:t.inputstringvalue,data:t.inputArray,selectValues:h[a],onChanged:e=>{t.inputstringvalue=e}})]})}),u.jsx(T,{index:a,item:t}),"geofence"===t.rulename.toLowerCase()&&(null==(m=null==(c=h[a])?void 0:c.name)?void 0:m.length)>0&&u.jsx(V,{}),g&&u.jsx(u.Fragment,{children:"geofence"!==t.rulename.toLowerCase()&&u.jsx("div",{className:x,style:{borderRadius:"0px 0px 5px 5px",marginLeft:"16.6%",width:"75%"},children:u.jsx(R,{className:x,index:a,item:t,rulename:t.rulename,type:t.type})})})]})]},a)}))})]})})},Fa=v((e=>{var t,a,s,l,i,r,n,o,d;const c=m.useContext(k),[p,h]=m.useState(1);m.useState(889774);const[v,g]=m.useState(0),[x,y]=m.useState(!1);m.useState(!1);const[b,j]=m.useState(""),[f,C]=m.useState(null),[L,S]=m.useState(!1),[w,A]=m.useState(!1),[M,T]=m.useState([]),[R,V]=m.useState(0),[_,B]=m.useState(!1),[q,$]=m.useState(!1),[G,P]=m.useState(null),[H,K]=m.useState(null),[W,Y]=m.useState(!0);m.useState(!1);const[J,Z]=m.useState(!1),[X,ee]=m.useState(!1),[te,ae]=m.useState([{dynamicListApprovalID:0,dynamicListId:0,dynamicListListName:"",departmentId:0,userid:0,roleID:0,firstName:"",lastName:null,email:"-- Select approver --",accessToken:null,errorMessage:""}]),[ie,re]=m.useState({approvalMatchType:"All",approvalMatchCount:0,isFollowHierarchyEnabled:!1}),[de,me]=m.useState("And"),[pe,he]=m.useState([]),[ve,ge]=m.useState(!1),[be,je]=m.useState("false"),[fe,Ce]=m.useState(0),[Le,Se]=m.useState(null),[Ne,Ie]=m.useState(null),[we,ke]=m.useState([]),[De,Ae]=m.useState(!1),[Me,Pe]=m.useState(null),[Ue,ze]=m.useState(null),[He,Ke]=m.useState(!1);m.useEffect((()=>{var t,a,s,l,i;const r=rt.parse(null==(a=null==(t=e.history)?void 0:t.location)?void 0:a.search);let n=void 0!==(null==r?void 0:r.lId)?parseInt(null==r?void 0:r.lId):null==(i=null==(l=null==(s=e.history)?void 0:s.location)?void 0:l.state)?void 0:i.listId,o=parseInt(null==r?void 0:r.bc)||0,d=window.location.hostname;V(n),je((null==r?void 0:r.ar)||"false"),Pe(window.location.href),ze(d),Ce(o);let c=void 0!==(null==r?void 0:r.view)?null==r?void 0:r.view:"false";(0!==o||"true"===c.toLowerCase())&&ge(!0),Xe(),0!==n?Ye(n):(Je(),T([We(p)]))}),[]);const We=e=>{var t={ruleGroupName:e.toString(),disabled:!0,matchType:"All",trigger:"",source:{},condtion:!0,matchCount:"",values:[],rule:[],error:{errMatchType:null,errTrigger:null,errSource:null,errRules:null}};let a=sessionStorage.getItem("dl_live_top_screen");if(null!=a){let e=xe(a);t.trigger=e.trigger,t.source=e.source,t.disabled=!1,j(e.listName)}return t},Ye=t=>{let a={id:t};c.globalStateData.setIsLoadingData(!0),D({path:Te,isServiceWorker:!1,params:a,sessionOut:e.context.globalStateData.setSessionOutData,ok:e=>{var t,a,s,l,i;if(e.status&&(null==(t=null==e?void 0:e.data)?void 0:t.dynamicList)){let t=Re(e.data.dynamicList);if($(!0),ue(t))c.globalStateData.setIsLoadingData(!1),K("Unknow error occurred");else if(Se(e.data.dynamicList),S(!0),A(!0),me(t.ruleCondition),j(t.listName),T(t.ruleGroup),Je(),null==(s=null==(a=null==e?void 0:e.data)?void 0:a.dynamicListRFAList)?void 0:s.length){let t={approvalMatchType:"All",approvalMatchCount:0,isFollowHierarchyEnabled:!1};e.data.dynamicListRFAList.map((e=>(t.approvalMatchCount=e.noOfApprover,t.approvalMatchType=e.approvalCondition,t.isFollowHierarchyEnabled=e.isHierarchy,e.firstName=e.approverName,e.email=e.approverEmail,e.userid=e.dynamicListApprovalID,e.isMandatory=e.isMandatory,e))),B(null==(i=null==(l=null==e?void 0:e.data)?void 0:l.dynamicList)?void 0:i.isRequestApproval),ae(e.data.dynamicListRFAList),re(t)}else c.globalStateData.setIsLoadingData(!1)}else c.globalStateData.setIsLoadingData(!1),K("Problem with response")},fail:e=>{c.globalStateData.setIsLoadingData(!1),K((null==e?void 0:e.message)||"Something went wrong")}})},Je=()=>{let t={dbName:"cust_c4363a53_4d19_4eb9_b83e_d3ba1f1f9f1e",departmentId:0,clientId:E()};D({path:se,isServiceWorker:!1,params:t,sessionOut:e.context.globalStateData.setSessionOutData,ok:e=>{c.globalStateData.setIsLoadingData(!1),e.status&&e.data.length&&ke(e.data)},fail:e=>{c.globalStateData.setIsLoadingData(!1)}})},Xe=()=>{Ve(e.context,(e=>{}))},tt=(e,t)=>pa(e,t),at=()=>{P(null),Y(!1)},it=t=>{let a={listId:t,listName:b.trim(),ruleList:M,ruleCondition:de,approverList:te,approverSetting:ie,context:e.context,isRequestApproval:0!==we.length&&_,domainName:Ue,isReqApprAny:v,ishierarchy:x};return va(a)},nt=(e,t,a)=>{let s=[...M],l=s[t].rule[a];l.isLoading=!0,T(s),D({path:Ee,isServiceWorker:!1,isCache:!1,params:e,ok:e=>{var a,i;if(l.isLoading=!1,null==e?void 0:e.status){l.isLoading=!1;let r=0;0===t?r=(null==(a=null==e?void 0:e.data)?void 0:a.grp1Count)||0:1===t&&(r=(null==(i=null==e?void 0:e.data)?void 0:i.grp2Count)||0),l.auidenceCount=r,T(s)}},fail:e=>{l.isLoading=!1,T(s)}})},ot=()=>{if(null===f){var t=tt(b,M);t[0]?(()=>{let t=0,a=$e;0!==R&&(t=R,a=Ge);let s=it(t);D({path:a,params:s,isServiceWorker:!1,loading:c.globalStateData.setIsLoadingData,sessionOut:c.globalStateData.setSessionOutData,ok:t=>{var a,s,l,i;if(!0===t.status||"true"===t.status){if(0!==R){let a=Q(),s={dynamicListId:t.data,dynamicListName:b};return a.dynamicList.length>0&&(a.dynamicList.map((e=>{e.dynamicListId===t.data&&(e.dynamicListId=s.dynamicListId,e.dynamicListName=b)})),qe(a)),e.context.globalStateData.setIsLoadingData(!1),void e.history.push("/audience")}if(0===we.length){let e=Q(),a={dynamicListId:t.data,dynamicListName:b};e.dynamicList=[a].concat(e.dynamicList),qe(e)}const r=rt.parse(null==(s=null==(a=e.history)?void 0:a.location)?void 0:s.search);if("true"===((null==r?void 0:r.isCampaign)||!1)){if((null==(l=null==window?void 0:window.sdxDetails)?void 0:l.campaignDetails)&&0===we.length){let e={dynamicListId:t.data,dynamicListName:b};(null==(i=null==window?void 0:window.sdxDetails)?void 0:i.campaignDetails).dynamicList=e}return void e.history.push({pathname:"/campaign/planning",search:"cId=0&sl=false&cs=0"})}e.history.push("/audience")}else Y(!0),P((null==t?void 0:t.message)||"Please try again")},fail:e=>{}})})():(P(t[1]),Y(!0))}},dt=()=>{var t,a;const s=rt.parse(null==(a=null==(t=e.history)?void 0:t.location)?void 0:a.search);if(0!==Number(s.bc))return!1;let l=!1;for(const e of te)if("All"===e.approvalCondition&&!0===e.isHierarchy){if(e.approverEmail===F().emailId&&0===e.approvalStatus){l=!0;break}if(1!==e.approvalStatus)break;if(e.approverEmail===F().emailId&&0===e.approvalStatus){l=!0;break}if(e.approverEmail===F().emailId&&1===e.approvalStatus){l=!1;break}if(e.approverEmail===F().emailId&&2===e.approvalStatus){l=!1;break}}else{if(e.approverEmail===F().emailId&&0===e.approvalStatus){l=!0;break}if(e.approverEmail===F().emailId&&1===e.approvalStatus){l=!1;break}if(e.approverEmail===F().emailId&&2===e.approvalStatus){l=!1;break}}return l},ct=()=>{if(_){let e=[...te];e.map(((t,a)=>{"-- Select approver --"===e[a].email?e[a].errorMessage=ce:e[a].errorMessage=""})),ae(e),e.some((e=>""!==e.errorMessage))||ot()}else ot()},ut=()=>{var t,a,s;const l=rt.parse(null==(a=null==(t=e.history)?void 0:t.location)?void 0:a.search);let i=void 0!==(null==l?void 0:l.view)?null==l?void 0:l.view:"false",r=void 0!==(null==l?void 0:l.ar)?null==l?void 0:l.ar:"false";return"true"===i.toLowerCase()||"true"===r.toLowerCase()?u.jsx(u.Fragment,{}):u.jsxs(z,{id:0!==R?"dl_update_btn":"dl_create_btn",className:`${(null==(s=M[0])?void 0:s.rule.length)>0?null:"click-off"}${!0===oe()&&" click-off"}`,onClick:()=>{if(""!==b){var e=tt(b,M);if(e[0]){let e=F(),t=e.userTypeId;if(4===t)return void ct();if(3===t)if("1"===e.roleId)ct();else{if(we.length>0&&!_)return void Ie(Oe);ct()}else{if(we.length>0&&!_)return void Ie(Oe);ct()}}else{let t=[...M];T(t),P(e[1]),Y(!0)}}else C("Enter dynamic list name")},children:[0!==R?"Update":"Create"," rule"]})},mt=()=>{var t,a;const s=rt.parse(null==(a=null==(t=e.history)?void 0:t.location)?void 0:a.search);return u.jsxs("div",{className:"btn-container d-flex justify-content-end w-100 box-bottom-space ",children:["true"===(null==s?void 0:s.view)?u.jsx(z,{id:"dl_backtolist",onClick:()=>{e.history.push("/audience")},children:"Back to list"}):u.jsx(U,{id:"dl_cancel_button",onClick:()=>{e.history.push("/audience")},children:"Cancel"}),"true"===be&&dt()?u.jsxs(u.Fragment,{children:[u.jsx(_e,{id:"dl_reject_button",onClick:()=>{Ae(!0),Xe()},children:"Reject"}),u.jsx(z,{id:"dl_approve_button",onClick:()=>{D({path:Be,isServiceWorker:!1,isCache:!1,params:{dynamicListId:R},loading:c.globalStateData.setIsLoadingData,sessionOut:c.globalStateData.setSessionOutData,ok:t=>{e.history.push("/audience")},fail:e=>{alert(e)}}),Xe()},children:"Approve"})]}):null,null!==Le&&(null==Le?void 0:Le.createdBy)===F().userId?u.jsx(ut,{}):(null==Le?void 0:Le.createdBy)!==F().userId?u.jsx(u.Fragment,{children:"false"===be&&0===fe&&u.jsx(ut,{})}):u.jsx(u.Fragment,{})]})},pt=()=>u.jsx(Lt,{primaryButtonText:"Reject",callback:t=>{Ae(!1),D({path:Fe,isServiceWorker:!1,isCache:!1,params:{dynamicListId:R,comment:t},loading:c.globalStateData.setIsLoadingData,sessionOut:c.globalStateData.setSessionOutData,ok:t=>{e.history.push("/audience")},fail:e=>{alert(e)}})}});return u.jsxs("div",{id:"sdx_dl_creation",children:[G&&u.jsxs(Ze,{show:W,centered:!0,onHide:()=>at(),children:[u.jsxs(Ze.Header,{children:[u.jsx("h2",{children:"Alert"}),u.jsx(lt,{mainClass:"close",size:"md",handleClose:()=>{at()}})]}),u.jsx(Ze.Body,{children:u.jsx("p",{children:G})})]}),De&&u.jsx(pt,{}),u.jsx(Ze,{show:!!H||null,centered:!0,onHide:()=>K(null),children:u.jsxs(Ze.Body,{children:[u.jsx(lt,{mainClass:"close position-absolute right-10 top-10",size:"md",handleClose:()=>{K(null),e.history.push("/audience")}}),u.jsx("p",{children:H})]})}),J&&u.jsx(Ct,{headerTitle:"Dynamic List",title:`The dynamic rule is ${0===R?"created":"updated"}. Do you want to create a communication?`,secondaryButtonText:"Later",primaryButtonText:"Proceed",buttonClicked:t=>{Z(!1),!0===t?e.history.push({pathname:"/campaign/planning",search:"?cId=0&sl=false",state:{isSmartlinkCampaign:!1,campaignId:-1,status:"Draft"}}):e.history.push("/audience")}}),u.jsx(st,{fluid:!0,className:"main-heading-wrapper mb0",children:u.jsxs(st,{className:"mhw-container",children:[u.jsx("div",{className:"mhwc-left",children:u.jsx("h1",{children:u.jsx("div",{className:"mh-wrapper",children:u.jsxs("span",{className:"mh-text",children:[0!==R&&"view"!==(null==(s=null==(a=null==(t=null==e?void 0:e.history)?void 0:t.location)?void 0:a.state)?void 0:s.type)?"Update":"view"===(null==(r=null==(i=null==(l=null==e?void 0:e.history)?void 0:l.location)?void 0:i.state)?void 0:r.type)?"":"New"," ","view"===(null==(d=null==(o=null==(n=null==e?void 0:e.history)?void 0:n.location)?void 0:o.state)?void 0:d.type)?"Dynamic list":"dynamic list"]})})})}),u.jsx("div",{className:"mhwc-right",children:u.jsxs("div",{className:"back-text",id:"dl_back_button",onClick:()=>e.history.push("/audience"),children:[u.jsx(O,{icon:ye,size:"sm"}),"Back"]})})]})}),u.jsxs(st,{className:"page-header",children:[u.jsxs("div",{className:(()=>{var t,a;const s=rt.parse(null==(a=null==(t=e.history)?void 0:t.location)?void 0:a.search);if("true"===s.ar)return 0===Number(s.lId)&&dt();if(0===Number(s.lId))return!0;if(0!==Number(s.lId)&&0===Number(s.bc)){if("false"===s.ar)return null!==Le&&Le.createdBy===F().userId;(null==te?void 0:te.length)&&te.map((e=>{if(e.approverEmail===F().emailId&&1===e.approvalStatus||e.approverEmail===F().emailId&&2===e.approvalStatus)return!1}))}else if(0!==Number(s.lId)&&1===Number(s.bc))return!1})()?"click-on":"click-off",children:[u.jsx(yt,{className:"mb20 mt43",children:u.jsxs(Qe,{children:[u.jsx(et,{md:2,children:u.jsx(bt,{label:"List name"})}),u.jsx(et,{md:3,className:"pl30 pr0 list-name",children:u.jsx(ht,{id:"dl_listname_text",isLoading:He,iconPlaceholder:null===f&&!He,iconName:b.length>0&&!0===w?"icon-rs-circle-tick-medium icons-md green":"",required:!0,placeholder:"List name",val:b,max:At,errorMessage:f,handleOnchange:e=>{if(e.length>=51)C("Dynamic list name exceeded the limit");else if(ee(!0),!e.includes("'")&&(""===e||/^[' 'A-Za-z0-9_-]*$/.test(e))){let t=e.replace(/\s+/g," "),a=e.length>0?null:"Enter dynamic list name";C(a),j(t.trimStart()),S(!1),A(!1)}},handleOnBlur:e=>{var t;e.length>50?C("Dynamic list name exceeded the limit"):(C(null),e.length>0&&X&&(Ke(!0),t=e=>{Ke(!1)},D({path:le,isServiceWorker:!1,isCache:!1,params:{dynamicListName:e},sessionOut:c.globalStateData.setSessionOutData,ok:e=>{!0===e.status?(C("Dynamic list name already exists"),S(!1),A(!1),t()):(t(),C(null),S(!0),A(!0))},fail:e=>{}}),ee(!X)))}})})]})}),M.map(((t,a)=>u.jsxs("div",{children:[u.jsx(_a,{data:t,listId:R,history:e.history,context:e.context,array:M,attributtesList:pe,index:a,disabled:ue(b),statustest:be,errorMessage:G,rulesAdded:()=>{let e=[...M];T(e)},ruleNameChange:e=>{let t=it(R);1===M.length&&(t.dynamicListRule.RuleCondition="Or"),nt(t.dynamicListRule,a,e)},closeBtnClicked:()=>{var e=[...M],a=e.indexOf(t);e.splice(a,1),T(e),h(p-1)},triggerChanged:e=>{$(e)},onChange:e=>{let t=[...M];T(t)}}),M.length>1&&0===a?u.jsx(Qe,{children:u.jsx(et,{children:u.jsx("div",{className:"w-100 d-flex justify-content-center marginB25 switch-divider mt12",children:u.jsx(N,{className:"sw-and mt5",onLabel:"And",offLabel:"Or",onChange:e=>{t.condtion=e.target.value,t.condtion?me("And"):me("Or");let a=it(R);1===M.length?a.dynamicListRule.RuleCondition="Or":a.dynamicListRule.RuleCondition=!0===t.condtion?"And":"Or",nt(a.dynamicListRule,0,0)},checked:"And"===de})})})}):null]},a))),M.length<=1&&b.length>0&&!0===w?u.jsx("div",{className:"dynamicListAddIcon",children:u.jsx(I,{className:"gallery-dropdown-button",align:"start",popupSettings:{animate:!0,popupClass:"ic-dropdown"},text:u.jsx(ne,{text:"Add rule group",position:"top",show:!1,children:u.jsx("i",{className:"icon-rs-circle-plus-fill-edge-medium color-primary-blue icons-lg"})}),dir:"rtl",onItemClick:e=>{if(null===f){var t=tt(b,M);if(!0===t[0]){h(p+1);var a=[...M];a.push(We(p+1)),T(a)}else{let e=document.getElementById("sdx_dl_creation");window.scrollTo({top:e.offsetTop,behavior:"smooth"});let a=[...M];T(a),P(t[1]),Y(!0)}}},items:[{text:"Rule - Group 2"}]})}):null,u.jsxs("p",{className:"marginT10",children:[u.jsx("strong",{children:"Note : "}),"Probabilistic audience size prediction is derived from last 90 days"]}),q&&u.jsx("div",{className:`${null===Ne?"mt10":"mt0"} ${0===we.length&&"d-none"}`,children:u.jsx(yt,{children:u.jsx(Et,{children:u.jsx("li",{children:u.jsx(vt,{lbl:"Request for approval",checked:_,errorMessage:Ne,iconPlaceholder:!0,iconName:"icon-rs-circle-question-mark-medium",iconPopover:"Get the list approved by the concerned person",handleChange:e=>{!0===e.target.checked&&(ae([{email:"-- Select approver --",errorMessage:""}]),Ie(null),re({approvalMatchType:"All",approvalMatchCount:0,isFollowHierarchyEnabled:!1})),B(e.target.checked)}})})})})}),_&&we.length>0&&u.jsx("div",{className:"click-on theme-space-mt",children:u.jsx(oa,{approverList:we||[],approvalList:te||[],approvalSettings:ie,context:e.context,onApprovalListChange:e=>{ae(e)},onApprovalSettingsChange:e=>{re(e)},clickModelShow:e=>{B(e)},isReqApprSettings:e=>{g(e)},isRFAhierarchy:e=>{y(e)}})})]}),0===R||b.length?u.jsx(mt,{}):null]})]})}));let Ba=new class{constructor(){c(this,"listName",""),c(this,"listNameLoader",!1),c(this,"listNameErrMessage",null),c(this,"enableRuleGroup",!1),c(this,"ruleGroup",[]),c(this,"error",null),c(this,"getData",(()=>{0!==za.getListId()||(this.ruleGroup=[$a()])})),c(this,"handleOnChange",((e,t)=>{za.dlNameOnChange(e,(t=>{this.enableRuleGroup=!1,this.listNameErrMessage=t.message,t.status&&(this.listName=e)}))})),c(this,"dynamicListNameExists",(e=>{this.listNameLoader=!0,za.dynamicListNameExists(e,(e=>{this.listNameLoader=!1,!1===e.status?this.listNameErrMessage=e.message:(this.listNameErrMessage=null,this.enableRuleGroup=!0)}))})),c(this,"ruleGroupChanges",((e,t,a)=>{this.ruleGroup[e][t]=a})),c(this,"ruleChanges",((e,t,a,s)=>{this.ruleGroup[e].rules[t][a]=s})),c(this,"ruleErrorChanges",((e,t,a,s)=>{this.ruleGroup[e].rules[t].error[a]=s})),c(this,"sourceTypeReset",(e=>{this.ruleGroup[e].sourceType=null,this.ruleGroup[e].sourceValue=null,this.ruleGroup[e].rules=[]})),c(this,"selectSourceType",((e,t)=>{this.ruleGroup[e].sourceType=t,za.selectSource(t,e,(t=>{t.status&&(this.ruleGroup[e].isAppisAvailable=!0)}))})),c(this,"selectSourceValue",((e,t)=>{this.ruleGroup[e].sourceValue=t,za.selectSourceValue(t,e,(t=>{var a;!0===t.status&&(null==(a=null==t?void 0:t.data)?void 0:a.length)>0&&(this.ruleGroup[e].rules=[Pa()])}))})),c(this,"selectRule",((e,t,a)=>{this.ruleGroup[t].rules[a].rulename=e.name,this.ruleGroup[t].rules[a].name=e.name,this.ruleGroup[t].rules[a].type=e.fieldType,this.ruleGroup[t].rules[a].value="",this.ruleGroup[t].rules[a].defaultValue=e.value,this.ruleGroup[t].rules[a].compareValue="an"===e.fieldType.toLowerCase()?"+":"Is equal to"})),c(this,"getdefaultData",((e,t,a)=>{za.getDefaultData(this.ruleGroup[e],a,t,(e=>{}))})),c(this,"setErrTag",((e,t,a)=>{this.ruleGroup[e].rules[t].error.errTag=a})),Pt(this,{listName:Ut,enableRuleGroup:Ut,listNameLoader:Ut,listNameErrMessage:Ut,ruleGroup:Ut,error:Ut,getData:zt,handleOnChange:zt,dynamicListNameExists:zt,ruleChanges:zt,ruleErrorChanges:zt})}};class Oa extends p.Component{getContext(){return this.context}}c(Oa,"contextType",k),v(Oa);const qa=["Website","Mobile app","Forms","Location"],$a=()=>({matchType:"All",matchCount:1,sourceType:null,sourceValue:null,isAppisAvailable:!1,rules:[],error:Ga()}),Ga=()=>({errMatchType:null,errSourceType:null,errSourceValue:null}),Pa=()=>({rulename:"-- Select rule --",id:0,mandatory:!1,type:"",compareValue:"Contains",defaultValue:[],value:"",customAttributtes:[],customAttributtesData:[],error:{errRulename:null,errValue:null,errTag:null}});let Ua=new class{constructor(){c(this,"data",{isDLNameChanged:!1,sourceValueList:[],ruleList:[],context:null,dlcontext:null}),c(this,"getListId",(()=>{var e,t,a,s;const l=rt.parse(null==(e=window.location)?void 0:e.search);let i=void 0!==(null==l?void 0:l.lId)?parseInt(null==l?void 0:l.lId):null==(s=null==(a=null==(t=this.props.history)?void 0:t.location)?void 0:a.state)?void 0:s.listId;return parseInt(i)})),c(this,"dlNameOnChange",((e,t)=>{e.length>=50?t({status:!1,message:"Dynamic list name exceeded the limit"}):e.includes("'")||(""===e?t({status:!1,message:"Enter dynamic list name"}):e.length>0&&!1===/^[' 'A-Za-z0-9_-]*$/.test(e)?t({status:!1,message:"Special character not acceptable"}):t({status:!0,message:null}))})),c(this,"dynamicListNameExists",((e,t)=>{D({path:le,params:{dynamicListName:e},sessionOut:this.data.context.globalStateData.setSessionOutData,ok:e=>{!0===e.status?t({status:!1,message:"Dynamic list name already exists"}):t({status:!0,message:"Success"})},fail:e=>{t({status:!1,message:"Something went wrong"})}})})),c(this,"dlNameOnBlur",((e,t)=>{e.length>0&&!1===this.data.isDLNameChanged&&(this.data.isDLNameChanged=!this.data.isDLNameChanged,this.dynamicListNameExists(e,(e=>{t(e)})))})),c(this,"dlNameMatchTypeChanges",((e,t)=>{"all"===e.toLowerCase()&&this.matchCountSelect(1,t),Ba.state.ruleGroup[t].matchType=e})),c(this,"matchCountSelect",((e,t)=>{Ba.state.ruleGroup[t].matchCount=e})),c(this,"getTriggerSource",(e=>qa)),c(this,"selectSource",((e,t,a)=>{var s,l;if(!0===e.toLowerCase().includes("website")){let e=Q();(null==(s=null==e?void 0:e.domainsList)?void 0:s.length)>0?(Ua.data.sourceValueList=e.domainsList,a({status:!0,list:e.domainsList})):a({status:!1,list:[]})}else if(!0===e.toLowerCase().includes("mobile")){let e=Q();(null==(l=null==e?void 0:e.mobileAppsList)?void 0:l.length)>0?(Ua.data.sourceValueList=e.mobileAppsList,a({status:!0,list:e.mobileAppsList})):a({status:!1,list:[]})}else!0===e.toLowerCase().includes("form")||e.toLowerCase().includes("location")})),c(this,"selectSourceValue",((e,t,a)=>{ja(Ba.ruleGroup[t].sourceType,this.data.context,(e=>{if(!0===e.status){let t=e.data;t.map((e=>{if(e.rulename=e.name,e.type=e.fieldType,null!==e.value&&e.value.length>0&&"string"==typeof e.value){let t=null!==e.value&&e.value.length>0&&JSON.parse(e.value),a=[];for(let e in t)a.push(t[e]);e.value=a.length>0?a:""}return e})),this.data.ruleList=t,a({status:!0,message:"",data:null==e?void 0:e.data})}else a({status:!1,message:"",data:[]})}),(e=>{a({stats:!1,data:[]})}))})),c(this,"selectRule",((e,t,a)=>{Ba.ruleGroup[t].rules[a].rulename=e.name,Ba.ruleGroup[t].rules[a].name=e.name,Ba.ruleGroup[t].rules[a].type=e.fieldType})),c(this,"resetSorce",(e=>{Ba.state.ruleGroup[e].sourceType=null,Ba.state.ruleGroup[e].sourceValue=null,Ba.state.ruleGroup[e].rules=[]})),c(this,"getListType",(e=>e.toLowerCase().includes("screen")||e.toLowerCase().includes("page")||e.toLowerCase().includes("when user view spefic screen")?"MobileScreens":"custom events"===e.toLowerCase()?"CustomEvents":e.toLowerCase().includes("languages")?"Languages":e.toLowerCase().includes("code")?"AppVersionCode":e.toLowerCase().includes("versionname")?"AppVersionName":"")),c(this,"getDefaultData",((e,t,a,s)=>{if(!0===e.sourceType.toLowerCase().includes("location")||!0===e.sourceType.toLowerCase().includes("form"))return void s([]);let l=Ae,i={};!0===e.sourceType.toLowerCase().includes("web")&&(i={domainName:e.sourceValue.domainUrl,listType:this.getListType(a)}),!0===e.sourceType.toLowerCase().includes("mobile")&&(i={appId:e.sourceValue.appGuid,listType:this.getListType(a)}),D({path:l,params:i,sessionOut:this.data.context.globalStateData.setSessionOutData,ok:e=>{},fail:e=>{}})})),c(this,"validateRule",(()=>{let e=!0;return Ba.ruleGroup.forEach(((t,a)=>{!1!==e&&(null===t.sourceType||""===t.sourceType?(t.error.errSourceType="Select source type",e=!1):t.error.errSourceType=null,null===t.sourceValue||""===t.sourceValue?(t.error.errSourceValue="Please select source value",e=!1):t.error.errSourceValue=null,0===t.rules.length&&(t.error.errRuleGroup.errRulename="Please add rule",e=!1),t.rules.forEach(((t,a)=>{!1!==e&&(null===t.rulename||""===t.rulename||"-- Select rule --"===t.rulename?(t.error.errRulename="Please select rule",e=!1):t.error.errRulename=null,null===t.value||""===t.value?(t.error.errValue="Please enter value",e=!1):t.error.errValue=null)})))})),e}))}};const za=Ua;p.createContext({});const Ha=Ht((e=>(m.useEffect((()=>{}),[]),u.jsx(yt,{className:"mt43",children:u.jsxs(Qe,{children:[u.jsx(et,{md:2,children:u.jsx(bt,{label:"List name"})}),u.jsx(et,{md:6,className:"pl30 pr0",children:u.jsx(ht,{isLoading:Ba.listNameLoader,iconPlaceholder:!Ba.listNameLoader,iconName:!0===(null==Ba?void 0:Ba.enableRuleGroup)?"icon-rs-circle-tick-medium icons-md green":"",required:!0,placeholder:"List name",val:null==Ba?void 0:Ba.listName,max:At,errorMessage:null==Ba?void 0:Ba.listNameErrMessage,handleOnchange:e=>{Ba.handleOnChange(e)},handleOnBlur:e=>{Ba.dynamicListNameExists(e,(e=>{}))}})})]})})))),Ka=Ht((e=>{var t,a,s,l,i,r,n;const o=e.index,d=Ba.ruleGroup[o].sourceType,c=Ba.ruleGroup[o].sourceValue,p=Ba.ruleGroup[o].isAppisAvailable,h=Ba.ruleGroup[o].error;m.useEffect((()=>{}),[]);const v=()=>u.jsx(O,{tooltip:"Reset",icon:"icon-rs-refresh-medium",onClick:()=>{Ba.sourceTypeReset(o)}}),g=()=>u.jsx(et,{md:2,children:u.jsx(Vt,{children:u.jsx(Y,{children:d.length>0&&u.jsx(v,{})})})}),x=()=>u.jsx(et,{md:1,children:u.jsx(Vt,{children:u.jsxs(Y,{children:[u.jsx(v,{}),!1===p&&u.jsx(O,{tooltip:"No apps available",icon:"icon-rs-circle-plus-fill-edge-medium",onClick:()=>{"website"===(null==d?void 0:d.toLowerCase())?history.push("/preferences/communication-settings",{selectIndex:0}):"mobile app"===(null==d?void 0:d.toLowerCase())&&history.push("/preferences/communication-settings",{mobileOnBoarding:!0})}})]})})});return u.jsx(yt,{children:u.jsxs(Qe,{children:[u.jsx(et,{md:{span:2,offset:0},children:u.jsx(bt,{label:"Select trigger source"})}),u.jsx(et,{md:3,children:u.jsx(mt,{required:!0,label:"Trigger",disabled:(null==d?void 0:d.length)>0,data:za.getTriggerSource(o),errorMessage:(null==h?void 0:h.errSourceType)||null,value:""!==d?d:"-- Source -- ",onChange:e=>{Ba.selectSourceType(o,e.target.value)}})}),null!==d&&u.jsx(u.Fragment,{children:(null==(t=null==d?void 0:d.toLowerCase())?void 0:t.includes("form"))||(null==(a=null==d?void 0:d.toLowerCase())?void 0:a.includes("location"))?u.jsx(g,{}):u.jsx(u.Fragment,{children:(null==(s=null==d?void 0:d.toLowerCase())?void 0:s.includes("website"))||(null==(l=null==d?void 0:d.toLowerCase())?void 0:l.includes("mobile"))&&p?u.jsxs(u.Fragment,{children:[u.jsx(et,{md:5,children:u.jsx(mt,{required:!0,label:"Source",disabled:null!==c,data:za.data.sourceValueList,textField:(null==(i=null==d?void 0:d.toLowerCase())?void 0:i.includes("web"))?"domainUrl":"appName",dataItemKey:(null==(r=null==d?void 0:d.toLowerCase())?void 0:r.includes("web"))?"sdkDomain":"appGuid",value:null!==c?c:(null==(n=null==d?void 0:d.toLowerCase())?void 0:n.includes("web"))?{domainUrl:"Select domain",sdkDomain:"Select domain"}:{appName:"Select mobile app",appGuid:"Select mobile app"},onChange:e=>{Ba.selectSourceValue(o,e.target.value)}})}),u.jsx(et,{md:2,children:u.jsx(v,{})})]}):u.jsx(x,{})})})]})})}));let Wa=["icon-rs-plus-medium icon-md","icon-rs-minus-medium icon-md","icon-rs-arrow-left-mini icon-sm","icon-rs-arrow-right-mini icon-sm"];const Ya=Ht((e=>{var t,a,s,l,i,r,n,o;const d=m.useContext(k),c=(null==(t=null==Ba?void 0:Ba.ruleGroup[null==e?void 0:e.parentIndex].rules[null==e?void 0:e.childIndex])?void 0:t.type)||"",p=(null==(a=null==Ba?void 0:Ba.ruleGroup[null==e?void 0:e.parentIndex].rules[null==e?void 0:e.childIndex])?void 0:a.rulename)||"",h=(null==(s=null==Ba?void 0:Ba.ruleGroup[null==e?void 0:e.parentIndex].rules[null==e?void 0:e.childIndex])?void 0:s.errTag)||null,v=(null==(l=null==Ba?void 0:Ba.ruleGroup[null==e?void 0:e.parentIndex].rules[null==e?void 0:e.childIndex])?void 0:l.defaultData)||[],g=(null==(i=null==Ba?void 0:Ba.ruleGroup[null==e?void 0:e.parentIndex].rules[null==e?void 0:e.childIndex])?void 0:i.value)||"",x=(null==(r=null==Ba?void 0:Ba.ruleGroup[null==e?void 0:e.parentIndex].rules[null==e?void 0:e.childIndex])?void 0:r.compareValue)||"",y=(null==(o=null==(n=null==Ba?void 0:Ba.ruleGroup[null==e?void 0:e.parentIndex].rules[null==e?void 0:e.childIndex])?void 0:n.error)?void 0:o.errValue)||null,b=t=>u.jsxs(Qe,{style:{width:"100%"},children:[u.jsx(et,{md:3,children:u.jsx(Gt,{data:Wa,defaultItem:"icon-rs-plus-mini icon-sm",customAlignRight:!0,className:"mr20",onSelect:t=>{let a=Wa.indexOf(t),s="";0===a?s="plus":1===a?s="minus":2===a?s="less than":3===a&&(s="greater than"),Ba.ruleChanges(e.parentIndex,e.childIndex,"compareValue",s)}})}),u.jsx(et,{md:9,children:u.jsx(ht,{required:!0,id:"dl_rule_value",placeholder:"Enter the no. of days",val:g,keyboardType:"number",max:Dt,cb:t=>{(""===t||/^[0-9]{1,9}$/.test(t))&&t<=9&&(Ba.ruleChanges(e.parentIndex,e.childIndex,"value",t),Ba.ruleErrorChanges(e.parentIndex,e.childIndex,"errValue"))}})})]}),j=({callback:e})=>u.jsx(mt,{label:"Compare",id:"dl_compare",required:!0,disabled:!!p.includes("select"),data:["Is equal to","Is not equal to","Contains","Does not contains"],value:""!==x?x:"-- Select--",onChange:t=>{e(t.target.value)}}),f=t=>u.jsxs(Qe,{style:{width:"100%"},children:[u.jsx(et,{md:6,children:u.jsx(j,{callback:t=>{Ba.ruleGroup[e.parentIndex].rules[e.childIndex].compareValue=t}})}),u.jsx(et,{md:6,children:u.jsx(C,{contains:!1})})]}),C=t=>u.jsx(mt,{required:!0,id:"dl_rule_value",label:"Value",disabled:!!p.includes("select"),data:v||[],value:""!==g?g:"-- Select type --",errorMessage:y||null,onChange:a=>{Ba.ruleChanges(e.parentIndex,e.childIndex,"value",a.target.value),Ba.ruleErrorChanges(e.parentIndex,e.childIndex,"errValue",null),!0===t.contains&&L(a.target.value)}}),L=t=>{let a={};(!0===Ba.ruleGroup[null==e?void 0:e.parentIndex].sourceType.toLowerCase().includes("website")||!0===Ba.ruleGroup[null==e?void 0:e.parentIndex].sourceType.toLowerCase().includes("mobile app"))&&(a.appId=Ba.ruleGroup[null==e?void 0:e.parentIndex].sourceValue.appGuid,a.eventName=t),Sa(d,a,(t=>{var a;if((null==(a=null==t?void 0:t.data)?void 0:a.length)>0){let a={attributteKeyObject:null,attributeName:"",attributteValue:"",attributeCompare:"",attributeFrom:"",attributeTo:"",errAttributeCompare:null,errAttributteName:null,errAttributteValue:null,errAttributeFrom:null,errAttributeTo:null};Ba.ruleChanges(e.parentIndex,e.childIndex,"customAttributtes",[a]),Ba.ruleChanges(e.parentIndex,e.childIndex,"customAttributtesData",(null==t?void 0:t.data)||[])}else Ba.ruleChanges(e.parentIndex,e.childIndex,"customAttributtes",[]),Ba.ruleChanges(e.parentIndex,e.childIndex,"customAttributtesData",[])}))},S=()=>{var t,a,s;let l=p.toLowerCase().includes("custom")&&x.toLowerCase().includes("contains")&&g.length>0,i=(null==(s=null==(a=null==(t=null==Ba?void 0:Ba.ruleGroup[e.parentIndex])?void 0:t.rules[e.childIndex])?void 0:a.customAttributtesData)?void 0:s.length)>0?"click-on":"click-off";return u.jsxs(u.Fragment,{children:[u.jsx(et,{md:l?7:8,children:u.jsx(C,{contains:!0})}),l&&u.jsx(et,{md:1,className:i,children:u.jsx(Vt,{children:u.jsx(Y,{children:u.jsx(O,{icon:"icon-rs-circle-plus-fill-edge-medium",iconClass:"",iconColor:"blue",size:"md",tooltip:"Add",onClick:()=>{var t,a;if((null==(a=null==(t=null==Ba?void 0:Ba.ruleGroup[null==e?void 0:e.parentIndex].rules[null==e?void 0:e.childIndex])?void 0:t.customAttributtesData)?void 0:a.length)>0)(void 0).getCustomEventAttributtesData();else{let t={attributteKeyObject:null,attributeName:"",attributteValue:"",attributeCompare:"",attributeFrom:"",attributeTo:"",errAttributeCompare:null,errAttributteName:null,errAttributteValue:null,errAttributeFrom:null,errAttributeTo:null};Ba.ruleChanges(e.parentIndex,e.childIndex,"customAttributtes",[t])}}})})})})]})},N=()=>u.jsx("div",{className:"chips-input-container",children:u.jsx("div",{className:"chips-input-box",children:u.jsxs("div",{className:"multi-select-custom multi-select-required position-relative",children:[h&&u.jsx("div",{className:"validation-message align-end left10",children:h}),u.jsx(ut,{required:!0,id:"dl_rule_value",label:"Value",disabled:!!p.includes("select"),placeholder:"-- Select --",data:fe(v||[],G(g)),value:G(g),allowCustom:!0,onChange:t=>{(t=>{const a=t.reduce(((e,t)=>e.find((e=>e===t))?e:e.concat([t])),[]);if(a.length<=15){let t=[];a.map((e=>{!1===ue(we(e))&&we(e).length<=75&&t.push(e)})),Ba.ruleChanges(e.parentIndex,e.childIndex,"value",t.toString()),Ba.ruleErrorChanges(e.parentIndex,e.childIndex,"errValue",null)}})(t.target.value)},onFilterChange:t=>{var a;return null===(null==(a=null==Ba?void 0:Ba.ruleGroup[null==e?void 0:e.parentIndex].rules[null==e?void 0:e.childIndex])?void 0:a.errTag)&&t.filter.value.length>75?(Ba.setErrTag(null==e?void 0:e.parentIndex,null==e?void 0:e.childIndex,err.REACHED_MAX_COUNT),t.target._input.disabled=!0,t.target._input.value=t.filter.value.substring(0,74),t.filter.value=t.filter.value.substring(0,74),void setTimeout((()=>{t.target._input.disabled=!1}),3e3)):t.filter.value.length<=75?(Ba.setErrTag(null==e?void 0:e.parentIndex,null==e?void 0:e.childIndex,null),!1):void 0}})]})})}),I=t=>{var a;return u.jsxs(Qe,{style:{width:"100%"},children:[u.jsx(et,{md:6,children:u.jsx(j,{callback:t=>{Ba.ruleChanges(e.parentIndex,e.childIndex,"compareValue",t),Ba.ruleChanges(e.parentIndex,e.childIndex,"value",""),Ba.ruleErrorChanges(e.parentIndex,e.childIndex,"errValue",null)}})}),u.jsx(et,{md:6,children:(null==(a=null==p?void 0:p.toLowerCase())?void 0:a.includes("custom"))&&"contains"===(null==x?void 0:x.toLowerCase())?u.jsx(S,{}):u.jsx(N,{})})]})};return u.jsx(u.Fragment,{children:null==c||""===c?u.jsx(ht,{disabled:!0,required:!0,placeholder:"Enter type",val:"",max:kt,cb:e=>{}}):u.jsxs(u.Fragment,{children:["d"===(null==c?void 0:c.toLowerCase())&&u.jsx(f,{}),"an"===(null==c?void 0:c.toLowerCase())&&u.jsx(b,{}),"t"===(null==c?void 0:c.toLowerCase())&&u.jsx(I,{})]})})})),Ja=Ht((e=>{const t=e.index,a=m.useContext(k);m.useEffect((()=>{}),[]);const s=Ht((s=>{var l,i;let r=Ba.ruleGroup[t].rules[s.index]||{id:0,name:"Select rule",value:""};const n=(null==(i=null==(l=null==Ba?void 0:Ba.ruleGroup[t].rules[s.index])?void 0:l.error)?void 0:i.errRulename)||null,o={screen:"MobileScreens",page:"MobileScreens","when user view spefic screen":"MobileScreens","custom events":"CustomEvents",language:"Languages","app version code":"AppVersionCode","app version name":"AppVersionName"},d=e=>{const t=e.toLowerCase();for(const[a,s]of Object.entries(o))if(t.includes(a))return s;return""};return((e,s)=>{let l={},i="";!0!==Ba.ruleGroup[t].sourceType.toLowerCase().includes("location")&&!0!==Ba.ruleGroup[t].sourceType.toLowerCase().includes("form")&&(!0===Ba.ruleGroup[t].sourceType.toLowerCase().includes("website")?(i=Ae,l={domainName:Ba.ruleGroup[t].sourceValue.domainUrl,listType:d(e)}):!0===Ba.ruleGroup[t].sourceType.toLowerCase().includes("mobile app")&&(i=Me,l={appId:Ba.ruleGroup[t].sourceValue.appGuid,listType:d(e)}),""!==l.listType?D({path:i,isServiceWorker:!1,params:l,sessionOut:a.globalStateData.setSessionOutData,ok:e=>{s(e)},fail:e=>{}}):s({status:!1}))})(r.rulename,(e=>{var a;e.status?Ba.ruleGroup[t].rules[s.index].defaultData=(null==(a=null==e?void 0:e.data)?void 0:a.appdataList)||[]:Ba.ruleGroup[t].rules[s.index].defaultData=[]})),m.useEffect((()=>{}),[]),u.jsx(et,{md:{span:3,offset:2},children:u.jsx(mt,{label:"Rule",required:!0,data:za.data.ruleList,value:r,textField:"name",dataItemKey:"id",errorMessage:n,onChange:a=>{Ba.ruleErrorChanges(t,s.index,"errRulename",null),Ba.selectRule(a.target.value,e.index,s.index)}})})})),l=Ht((e=>u.jsx(yt,{children:u.jsxs(Qe,{children:[u.jsx(s,{index:e.index}),u.jsx(et,{md:5,style:{display:"flex",alignItems:"center"},children:u.jsx(Ya,{parentIndex:t,childIndex:e.index})}),u.jsx(et,{md:1,children:u.jsx(Vt,{children:u.jsx(Y,{children:u.jsx(O,{tooltip:0===e.index?"Add ":"Remove",icon:(0===e.index?"icon-rs-circle-plus-fill-edge-medium "+(5===Ba.ruleGroup[t].rules.length?"click-off":"click-on"):"icon-rs-circle-minus-fill-edge-medium red")+" ",onClick:()=>{0===(null==e?void 0:e.index)?za.validateRule()&&Ba.ruleGroup[t].rules.push(Pa()):Ba.ruleGroup[t].rules.splice(e.index,1)}})})})})]},e.index+"")})));return u.jsx(u.Fragment,{children:Ba.ruleGroup[t].rules.length>0&&Ba.ruleGroup[t].rules.map(((e,t)=>u.jsx(u.Fragment,{children:u.jsx(l,{item:e,index:t})})))})})),Za=Ht((e=>{const t=Ba.ruleGroup;m.useEffect((()=>{}),[]);const a=e=>u.jsx(yt,{children:u.jsxs(Qe,{children:[u.jsx(et,{children:u.jsx(bt,{label:`Rule group ${e.index+1}`})}),u.jsx(et,{className:"text-end d-flex justify-content-between",children:0!==e.index&&u.jsx(u.Fragment,{children:u.jsx(O,{icon:icons.close_mini,size:"sm",mainClass:"position-relative top-10 right-10 rs-close",tooltip:"Remove",onClick:()=>{}})})})]})}),s=Ht((e=>{const t=Ba.ruleGroup[e.index].matchType,a=Ba.ruleGroup[e.index].matchCount,s=e.index;return u.jsx(yt,{children:u.jsxs(Qe,{children:[u.jsx(et,{md:{span:2,offset:0},children:u.jsx(bt,{label:"Match type"})}),u.jsx(et,{md:6,children:u.jsxs(Et,{children:[u.jsx("li",{children:u.jsx(pt,{lbl:"All",name:"matchtype"+e.index,labelId:"all"+e.index,checked:"all"===t.toLowerCase(),handleChange:e=>{Ba.ruleGroup[s].matchType="All"}})}),u.jsx("li",{className:"pl15",children:u.jsx(pt,{lbl:"Any",name:"matchtype"+e.index,labelId:"any"+e.index,checked:"any"===t.toLowerCase(),handleChange:e=>{Ba.ruleGroup[s].matchType="Any"}})}),"any"===t.toLowerCase()?u.jsx("li",{className:"pl15 col-sm-3",children:u.jsx(mt,{required:!0,label:"Any count",data:[1,2,3,4],value:a,customAlignRight:!0,onChange:e=>{Ba.ruleGroup[s].matchCount=e.target.value}})}):null]})})]})})}));return u.jsx(u.Fragment,{children:(null==t?void 0:t.length)>0&&(null==t?void 0:t.map(((e,t)=>u.jsxs(u.Fragment,{children:[u.jsx(a,{index:t}),u.jsx(s,{index:t,item:e}),u.jsx(Ka,{index:t,item:e}),u.jsx(Ja,{index:t,item:e})]}))))})}));Ht((e=>{const t=m.useContext(k);return za.data.context=t,m.useEffect((()=>{Ba.getData()}),[]),u.jsxs(u.Fragment,{children:[u.jsx(Ha,{}),u.jsx(Za,{})]})}));const Xa=e=>{const t=m.useContext(k);return u.jsx(Je,{children:u.jsx(Fa,{mode:"add",context:t,history:e.history})})},Qa=e=>it().add(e,"d").toDate(),es=()=>{const e=ts();if(e){const t=e;return((new Date).getTime()-t.getTime())/864e5>29?Qa(-29):e}return it((new Date).toJSON()).toDate()},ts=()=>{const e=F();return(null==e?void 0:e.createdDate)?it(e.createdDate).toDate():it((new Date).toJSON()).toDate()},as=e=>{const t=F();if(null==t?void 0:t.createdDate){const t=new Date(e);return(new Date-t)/864e5>30?Qa(-29):es()}return it((new Date).toJSON()).toDate()},ss=p.memo((e=>{const t=m.useRef(null),a=m.useRef(null),s=m.useRef(null),l=F();m.useState("All Time"),m.useState("");const[i,r]=m.useState(!1),[n,o]=m.useState(e.isShowDateRangePicker),[d,c]=m.useState({start:as(null==l?void 0:l.createdDate),end:Qa(0)}),[p,h]=m.useState({start:Qa(-29),end:Qa(0)}),[v,g]=m.useState(!1);m.useState(!1);const[x,y]=m.useState(""),[b,j]=m.useState(!1),f={allTime:[ts(),Qa(0)],last7Days:[Qa(-6),Qa(0)],last30Days:[Qa(-29),Qa(0)]};m.useEffect((()=>{var t,a,s,l;if(document.addEventListener("mousedown",C),(null==(t=null==e?void 0:e.data)?void 0:t.from)&&(null==(a=null==e?void 0:e.data)?void 0:a.to)){const t={start:it(null==(s=null==e?void 0:e.data)?void 0:s.from),end:it(null==(l=null==e?void 0:e.data)?void 0:l.to)};c(t)}return k(),()=>{document.removeEventListener("mousedown",C)}}),[]),m.useEffect((()=>{var t,a;if(null==e?void 0:e.starEndDate){let s=it(null==(t=null==e?void 0:e.starEndDate)?void 0:t.start).toDate(),l=it(null==(a=null==e?void 0:e.starEndDate)?void 0:a.end).toDate();c({start:s,end:l})}}),[null==e?void 0:e.starEndDate]),m.useEffect((()=>{if(e.initialDateData)try{const e={start:as(null==l?void 0:l.createdDate),end:Qa(0)};c(e)}catch(t){}n&&!1===e.isShowDateRangePicker&&I()}),[e.initialDateData,e.isShowDateRangePicker]);const C=e=>{var a,s;try{if(t.current&&!t.current.contains(e.target)){if(null==(s=null==(a=null==e?void 0:e.target)?void 0:a.className)?void 0:s.includes("k-"))return;I(),document.removeEventListener("mousedown",C)}}catch(l){}},L=e=>{const t=new Date(e).toDateString().slice(4,15);return t.slice(0,6)+","+t.slice(6,11)},S=(e,t)=>{c({start:e,end:t})},N=t=>{e.closeDateRangePicker&&e.closeDateRangePicker(t,d)},I=()=>{o(!1),r(!1)},k=()=>{const e=new Date,t=new Date(null==l?void 0:l.createdDate),a=Math.abs(e-t),s=Math.ceil(a/864e5);j(s<30)};return u.jsxs("div",{ref:t,className:`date-range-view-container \n                ${e.enable?"":"click-off"}\n                ${e.class||""} \n                ${n?"open":""}`,children:[u.jsxs("div",{className:"date-title",onClick:()=>{N(!0),o(!n)},children:[u.jsx(O,{icon:Pe}),u.jsx("span",{children:`${L(d.start)} - ${L(d.end)}`}),u.jsx(O,{icon:"icon-custon-arrow-down-small"})]}),u.jsxs("div",{ref:s,className:`date-range-dropdown ${n?"open":""} ${i?"calendar-box":""}`,children:[i&&u.jsxs("div",{ref:a,className:"date-range-box dr-right",children:[u.jsx(w,{onChange:e=>{const t={...e};let a=Qa(-150),s=Qa(0);null!==t.value.start&&(a=t.value.start-1),null!==t.value.end&&(s=t.value.end-1),i?h({start:a,end:s}):c({start:a,end:s})},popup:Ke,popupSettings:{appendTo:a.current},max:new Date,show:i,startDateInput:We,endDateInput:Ye}),u.jsx("ul",{className:"d-none",children:u.jsx("li",{children:u.jsx("small",{className:"text-justify",children:"If the default handling of the dropdown menu and toggle aren't to your liking, you can customize them, by using the more basic Component to explicitly specify the Toggle and Menu components"})})})]}),u.jsxs("div",{className:"date-range-box dr-left",children:[u.jsxs("ul",{className:"date-list-view",children:[u.jsx("li",{className:"All time"===x?"highLightClass":"",onMouseEnter:()=>{S(f.allTime[0],f.allTime[1])},onClick:()=>{c({start:f.allTime[0],end:f.allTime[1]}),g(!0),y("All time"),N(!1)},onMouseLeave:()=>{v||c({start:ts(),end:Qa(0)}),g(!1)},children:"All time"}),u.jsx("li",{className:"Last 7 days"===x?"highLightClass":"",onMouseEnter:()=>S(f.last7Days[0],f.last7Days[1]),onClick:()=>{g(!0),y("Last 7 days"),N(!1)},onMouseLeave:()=>{v||c({start:es(),end:Qa(0)}),g(!1)},children:"Last 7 days"}),u.jsx("li",{className:"Last 30 days"===x||!b&&""===x?"highLightClass":"",onMouseEnter:()=>S(f.last30Days[0],f.last30Days[1]),onClick:()=>{g(!0),y("Last 30 days"),N(!1)},onMouseLeave:()=>{v||c({start:es(),end:Qa(0)}),g(!1)},children:"Last 30 days"}),u.jsx("li",{className:"Custom ranges"===x?"highLightClass":"",onClick:()=>{r(!0),y("Custom ranges")},children:"Custom range"})]}),u.jsxs("div",{className:"d-flex justify-content-end btn-small",children:[u.jsx(U,{onClick:()=>{e.cancelBtnClicked()},children:"Cancel"}),u.jsx(z,{onClick:()=>{if(e.closeDateRangePicker){let t;i?(t={...p},c(t)):t={...d};const a={start:it(t.start).add(1,"day"),end:it(t.end).add(1,"day")};e.closeDateRangePicker(!1,a),e.applyBtnClicked(!0)}},children:"Apply"})]})]})]})]})})),ls=e=>it().add(e,"d").toDate(),is=e=>{const t=new Date(e);return[t.getFullYear(),t.getMonth()+1,t.getDate()].join("-")},rs=()=>{const e=m.useContext(Z),t=g(),a=h(),s=m.useContext(k);return u.jsx(ns,{history:a,match:t,context:s,apiContext:e})},ns=({history:e,match:t,context:a,apiContext:s})=>{const[l,i]=m.useState(!1),[r,n]=m.useState(null),[o,d]=m.useState(!1),[c,h]=m.useState({skip:0,take:5,sort:[{field:"orderDate",dir:"desc"}]}),[v,g]=m.useState(""),[x,y]=m.useState(0),[b,j]=m.useState(!1),[f,L]=m.useState(!1),[S,N]=m.useState(!1),[I,w]=m.useState(!1),[k,A]=m.useState(!1),[T,R]=m.useState(!0),[V,_]=m.useState(null),[B,q]=m.useState(!1),[$,G]=m.useState(is(it(ls(-29)).format("DD MMM yyyy"))),[P,H]=m.useState(is(it(new Date).format("DD MMM yyyy"))),[K,W]=m.useState(!1),[Y,Z]=m.useState(1),[te,ae]=m.useState(0),[ce,ue]=m.useState(0),[me,pe]=m.useState(""),[he,ve]=m.useState(0),[ge,xe]=m.useState(!1),[ye,be]=m.useState(0),[je,fe]=m.useState(null),[Ce,Le]=m.useState(""),[Se,Ne]=m.useState(!1),[Ie,we]=m.useState(!1),[ke,De]=m.useState(null),[Ae,Me]=m.useState([]),[Te,Re]=m.useState(!1),[Ve,Ee]=m.useState(0),[_e,Fe]=m.useState(!1),[Be,Oe]=m.useState(null),[qe,$e]=m.useState([]),[Ge,Pe]=m.useState(!1),[ze,He]=m.useState(!1),[Ke,We]=m.useState(!1),[Ye,Xe]=m.useState(!1);m.useState(null);const[et,tt]=m.useState([]),at=m.useRef(null),rt=m.useRef(null),nt=m.useRef(null),ot=m.useRef(null),dt=m.useCallback((()=>({startDate:$,endDate:P,listType:"",userId:ye,isSearchName:null==v?void 0:v.trim(),recordLimit:c.take,pageNumber:Y,isBlastCount:me,filterType:he,approvalStatus:Ce})),[$,P,ye,v,c.take,Y,me,he,Ce]);m.useEffect((()=>{s.apiStateData.getIsReloadData&&(s.apiStateData.setIsReloadData(!1),mt(dt(),!1,(()=>{})))}),[s.apiStateData.getIsReloadData,dt]),m.useEffect((()=>(ut(),ct(),document.body.classList.add("dynamicList"),()=>{document.body.classList.remove("dynamicList")})),[]);const ct=()=>{const e=X("Audience");Pe((null==e?void 0:e.get_AddAccessData)||!1),He((null==e?void 0:e.accessUpdateData)||!1),We((null==e?void 0:e.accessDeleteData)||!1),Xe((null==e?void 0:e.accessViewData)||!1)},ut=()=>{var e,t;const a=F(),s=localStorage.getItem("companyvalue");if(s){const e=JSON.parse(s);Oe(e)}a&&(fe(null==a?void 0:a.userId),$e((null==a?void 0:a.clientLists)||[]));const l=Q();(!l||0===(null==(e=null==l?void 0:l.mobileAppsList)?void 0:e.length)&&0===(null==(t=null==l?void 0:l.domainsList)?void 0:t.length))&&q(!0),gt()},mt=m.useCallback(((e,t,s)=>{w(!1),tt([]),xe(!1),R(!0),((e,t,a)=>{D({path:ee,params:t,sessionOut:e.globalStateData.setSessionOutData,isCache:!1,isServiceWorker:!1,ok:e=>{a(e)},fail:e=>{a({status:!1})}})})(a,e,(e=>{var t,a,l,i,r,o,d,u;if((null==e?void 0:e.status)&&(null==(a=null==(t=null==e?void 0:e.data)?void 0:t.dynamiclists)?void 0:a.length)){const t={skip:0,take:c.take},a=[...null==(l=null==e?void 0:e.data)?void 0:l.dynamiclists],m=C(a,t);R(!1),tt(null==(i=null==e?void 0:e.data)?void 0:i.dynamiclists),ae(null==(r=null==e?void 0:e.data)?void 0:r.totalNoRecord),ue(null==(o=null==e?void 0:e.data)?void 0:o.totalNoOfRecord),n(m),xe(!(null==(u=null==(d=null==e?void 0:e.data)?void 0:d.dynamiclists)?void 0:u.length)),A(!1),s(!0)}else R(!1),tt([]),xe(!0),A(!1),ae(0),s(!1)}))}),[a,c.take]),pt=e=>{const{skip:t,take:a}=e.dataState,s=Math.floor(t/a+1);n(C(et,e.dataState)),h(e.dataState),Z(s)};m.useEffect((()=>{mt(dt(),!1,(()=>{}))}),[c,Y]);const vt=e=>{const{skip:t,take:a}=e.page,s=Math.floor(t/a+1);n(C(et,e.page)),h(e.page),Z(s)},gt=()=>{const e={dbName:"cust_c4363a53_4d19_4eb9_b83e_d3ba1f1f9f1e",departmentId:0,clientId:E()};D({path:se,params:e,sessionOut:a.globalStateData.setSessionOutData,isServiceWorker:!1,ok:e=>{e.status&&e.data.length&&Me(e.data)},fail:e=>{}})},xt=e=>{var t;return((null==(t=F())?void 0:t.userId)||0)===e?"click-on":"click-off"},yt=e=>{var t;return((null==(t=F())?void 0:t.userId)||0)===e?"click-off":"click-on"},bt=(e,t)=>{if(!e){const e=it(t.start).format("DD MMM yyyy"),a=it(t.end).format("DD MMM yyyy"),s={startDate:is(e),endDate:is(a),listType:"",userId:ye,isSearchName:null==v?void 0:v.trim(),recordLimit:c.take,pageNumber:1,isBlastCount:me,filterType:he,approvalStatus:Ce};A(!0),G(is(e)),H(is(a)),W(!0),h(c),Z(1),Fe(!0),mt(s,!1,(()=>{}))}N(e),Fe(!1)},jt=(e,t)=>{const a={startDate:$,endDate:P,listType:"",userId:ye,isSearchName:"",recordLimit:c.take,pageNumber:Y,isBlastCount:me,filterType:he,approvalStatus:Ce};if(void 0===t)(!Ie&&Ie||e)&&(Ie||0!==Object.keys(e).length)&&Ie&&0===Object.keys(e).length&&(we(!1),be(""),g(""),pe(""),ve(0),Le(""),Fe(!1),mt(dt(),!1,(()=>{})));else{De(e),we(t||Ie),g(null==e?void 0:e.isSearchName),be(null==e?void 0:e.userId),Le((null==e?void 0:e.approvalStatus)||"");const s={...a,...e};Fe(!0),mt(s,!1,(()=>{}))}},Ct=p.memo((t=>{var a,s,l;const i=m.useCallback((()=>{var a;const s="click-off"===xt((null==(a=t.dataItem)?void 0:a.createdBy)||0);e.push({pathname:"audience/new-dynamic-list",search:`?lId=${t.dataItem.dynamicListID}&bc=${t.dataItem.recentBlastedCount}&ar=false&view=${s}`,state:{mode:"edit",listId:t.dataItem.dynamicListID,dataItem:t.dataItem,blastCount:t.dataItem.recentBlastedCount}})}),[t.dataItem]),r=m.useCallback((()=>{e.push({pathname:"audience/new-dynamic-list",search:`?lId=${t.dataItem.dynamicListID}&bc=1&ar=false&view=true`,state:{type:"view",mode:"edit",listId:t.dataItem.dynamicListID,dataItem:t.dataItem,blastCount:t.dataItem.recentBlastedCount}})}),[t.dataItem]),n=m.useCallback((()=>{if(!1===ie(te)){const e=re();if(4===(null==e?void 0:e.planId))return void Ee(e.planId);Re(!0)}else L(!0),g(t.dataItem.dynamicListName),y(t.dataItem.dynamicListID)}),[t.dataItem,te]),o=m.useCallback((()=>{_(t.dataItem),j(!b)}),[t.dataItem,b]);return u.jsx("td",{children:u.jsx("div",{className:"camp-icon",children:u.jsxs("ul",{className:"camp-icon-pannel",children:[u.jsx("li",{className:`${xt((null==(a=t.dataItem)?void 0:a.createdBy)||0)} ${0===t.dataItem.recentBlastedCount?"click-on":"click-off"} ${ze?"click-on":"click-off"}`,children:u.jsx(ne,{placement:"top",text:"Edit",children:u.jsx("i",{id:"dl_edit_button",className:"icon-rs-pencil-edit-medium icons-md blue",onClick:i})})}),u.jsx("li",{className:Ye?"click-on":"click-off",children:u.jsx(ne,{placement:"top",text:"View",children:u.jsx("i",{className:"icon-rs-eye-medium icons-md color-primary-blue cursor-pointer",id:"dl_view_button",onClick:r})})}),u.jsx("li",{className:ze?"click-on":"click-off",children:u.jsx(ne,{placement:"top",text:"Duplicate",children:u.jsx("i",{className:`icon-rs-duplicate-medium icons-md blue ${!0===oe()&&"click-off"}`,id:"dl_duplicate_button",onClick:n})})}),u.jsx("li",{children:u.jsx(ne,{placement:"top",text:"Info",children:u.jsx("i",{className:`icon-rs-circle-info-medium icons-md color-primary-blue ${0===t.dataItem.recentBlastedCount&&"click-off"}`,id:"dl_info_button",onClick:o})})}),u.jsx(ne,{placement:"top",text:0===t.dataItem.approverStatus?"Pending for approval":1===t.dataItem.approverStatus?"Approved":2===t.dataItem.approverStatus?"Rejected":3===t.dataItem.approverStatus?"Approval not enabled":"",children:u.jsx("li",{className:!0===(null==(s=t.dataItem)?void 0:s.isRequestApproval)||3===t.dataItem.approverStatus?"click-on":"click-off",children:u.jsx("i",{className:`icons-md ${!1===t.dataItem.isRequestApproval||3===t.dataItem.approverStatus?"icons-md icon-rs-user-tick-medium grey":0===t.dataItem.approverStatus?"icon-rs-user-question-mark-edge-medium orange":1===t.dataItem.approverStatus?"icons-md icon-rs-user-tick-medium green":2===t.dataItem.approverStatus?"icon-rs-user-tick-medium red":3===t.dataItem.approverStatus?"icons-md icon-rs-user-tick-medium grey":"icon-rs-user-tick-medium blue"} ${t.dataItem.isRequestApproval?"":"click-off"} ${yt((null==(l=t.dataItem)?void 0:l.createdBy)||0)}`,id:"dl_approver_status_button",onClick:()=>{e.push({pathname:"audience/new-dynamic-list",search:`?lId=${t.dataItem.dynamicListID}&bc=${t.dataItem.recentBlastedCount}&ar=${t.dataItem.isRequestApproval}`,state:{mode:"edit",listId:t.dataItem.dynamicListID,dataItem:t.dataItem,blastCount:t.dataItem.recentBlastedCount}})}})})})]})})})})),Lt=useMemo((()=>u.jsx(St,{config:c,data:null==r?void 0:r.data,settings:{total:te},pageable:!0,isDataStateRequired:!0,onDataStateChange:pt,pageStateChange:vt,column:[{field:"dynamicListName",filter:"text",title:"List name",cell:e=>{var t,a,s;return u.jsx("td",{children:u.jsx("span",{children:0===(null==(a=null==(t=e.dataItem)?void 0:t.dynamicListName)?void 0:a.length)?Mt:null==(s=e.dataItem)?void 0:s.dynamicListName})})}},{field:"createdByName",filter:"text",title:"Created by",width:200,cell:e=>{var t;return u.jsx("td",{children:u.jsx("span",{children:null==(t=e.dataItem)?void 0:t.createdByName})})}},{field:"createdDate",title:"Created on",width:170,cell:e=>u.jsx("td",{children:M(e.dataItem[e.field])})},{field:"recentBlastedCount",filter:"text",title:"No. of linked communications",cell:e=>{var t;return u.jsx("td",{className:"text-end",children:u.jsx("span",{children:null==(t=e.dataItem)?void 0:t.recentBlastedCount})})}},{field:"action",title:"Actions",cell:Ct}]})),[c,null==r?void 0:r.data,te,pt,vt,Ct]),It=()=>{var a;const s=()=>{if(!1===ie(te)){const e=re();if(4===(null==e?void 0:e.planId))return void Ee(e.planId);Re(!0)}else e.push({pathname:`${t.url}/new-dynamic-list`,search:"?lId=0&bc=0",state:{mode:"add",listId:0,blastCount:0}})};return u.jsxs("div",{className:"my15 p0 sd-dynamiclist-wrapper",children:[u.jsxs("div",{ref:at,className:`rs-ad-search-container marginB15 ${Se?"advanced-search-opened":"advanced-search-closed"} ${!0===T?"click-off":"click-on"} position-relative zIndex3`,children:[u.jsxs("div",{ref:rt,className:"advanceSearchLeft "+(Se?"periya-menu-enabled":"periya-menu-disabled"),children:[4===Ve&&u.jsxs(Ze,{show:!0,centered:!0,onHide:()=>Ee(0),children:[u.jsxs(Ze.Header,{children:[u.jsx("h2",{children:"Alert"}),u.jsx(lt,{mainClass:"close",size:"md",handleClose:()=>Ee(0)})]}),u.jsx(Ze.Body,{children:u.jsx("div",{className:"d-flex align-items-center justify-content-start",children:u.jsx("label",{className:"py10",children:"You have reached the maximum limit"})})})]}),Te&&u.jsx(ft,{size:"md",headerTitle:"Dynamic list",para:"Dynamic list limit exceeded, please upgrade your plan.",primaryButtonText:"Proceed",secondaryButtonText:"Cancel",buttonClicked:t=>{Re(!1),!0===t&&e.push("/subscription")}}),u.jsx(ss,{starEndDate:{start:$,end:P},isShowDateRangePicker:S,enable:!0,closeDateRangePicker:bt,applyBtnClicked:e=>i(e),cancelBtnClicked:()=>N(!1),class:"marginR10"})]}),u.jsx("div",{ref:nt,className:"search-view-container "+(Se?"periya-menu-enabled":"periya-menu-disabled"),children:u.jsx(Wt,{fullWidth:(null==(a=at.current)?void 0:a.clientWidth)||0,onPeriyaMenuChange:e=>Ne(e),onSearchDataReceived:jt})}),u.jsx("div",{ref:ot,className:"advanceSearchRight ml15 "+(Se?"periya-menu-enabled":"periya-menu-disabled"),children:null!==et&&u.jsx(O,{id:"dl_add_button",icon:de,size:"lg",shadow:!0,tooltip:"Create dynamic list",iconClass:`${!0===B&&"click-on"} ${!0===oe()&&"click-off"} ${Ge?"click-on":"click-off"}`,onClick:s})})]}),I?u.jsx(Qe,{children:u.jsx("div",{className:"box-design pb10",children:u.jsx(Ue,{count:5,isError:I,children:u.jsxs("div",{className:"nodata-bar add-func",children:[u.jsx("i",{className:"icon-rs-alert-medium icons-md orange-medium"}),u.jsx("p",{children:"No record matched"})]})})})}):u.jsx(u.Fragment,{children:!o&&(null==et?void 0:et.length)>0?u.jsxs(u.Fragment,{children:["/audience1"===window.location.pathname.toLowerCase()&&u.jsx(GridView,{}),"/audience"===window.location.pathname.toLowerCase()&&Lt]}):0===(null==et?void 0:et.length)?u.jsx("div",{className:"box-design pb10",children:u.jsx(Ue,{isError:ge,count:4,children:u.jsxs("div",{className:"nodata-bar",children:[u.jsx(O,{icon:J,size:"md",color:"orange-medium",mainClass:"mr5"}),u.jsx("p",{children:Ie?"No records available":"No data available"})]})})}):!1===l&&0===(null==et?void 0:et.length)&&0===(null==v?void 0:v.length)?u.jsx("div",{className:"box-design pb10",children:u.jsx(Ue,{count:5,isError:ge,children:u.jsxs("div",{className:`nodata-bar add-func ${oe()&&"click-off"}`,onClick:s,children:[u.jsx("i",{className:"icon-rs-circle-plus-fill-edge-medium icons-md color-primary-blue cursor-pointer px5"}),u.jsx("p",{children:"Create"})]})})}):(l||ge)&&u.jsx("div",{className:"box-design pb10",children:u.jsx(Ue,{isError:ge,children:u.jsxs("div",{className:"nodata-bar",children:[u.jsx(O,{icon:J,size:"md",color:"orange-medium",mainClass:"mr5"}),u.jsx("p",{children:"No data available"})]})})})})]})},wt=p.memo((()=>{const[e,t]=m.useState(!1),[s,l]=m.useState(v+"_Copy"),[i,r]=m.useState(!1),[n,o]=m.useState(!1),[d,c]=m.useState(!1),[p,h]=m.useState(null),g=e=>{((e,t,a)=>{D({path:le,params:{dynamicListName:t},sessionOut:e.globalStateData.setSessionOutData,ok:e=>{a(e)},fail:e=>{a({status:!1})}})})(a,s,(a=>{o(!1),!1===(null==a?void 0:a.status)?(c(!0),L(!0),t(!1),e(a)):(h("Dynamic list name already exists"),r(!0),t(!1),e({status:!0}))}))};return u.jsxs(Ze,{show:f,centered:!0,children:[u.jsxs(Ze.Header,{children:[u.jsx("h2",{children:"Duplicate list"}),u.jsx(lt,{mainClass:"close",size:"md",handleClose:()=>{L(!1),h(null)}})]}),u.jsxs(Ze.Body,{children:[u.jsx(ht,{required:!0,label:"List name",placeholder:0===s.length?"Enter the dynamic list name":"List name",errorMessage:p,val:s,max:Nt,isLoading:n,cb:e=>{if((null==e?void 0:e.length)>0&&t(!0),!e.includes("'")&&(""===e||/^[' 'A-Za-z0-9_-]*$/.test(e))){const t=e.replace(/\s+/g," ");l(t.trimStart()),h(null)}},ob:e=>{if(null!=p)return;const t=0===e.length?"Enter dynamic list name":null;h(t),o(!0),g((e=>{}))},onFocus:e=>{""!=e.target.value&&t(!0)}}),u.jsx("div",{className:"btn-container d-flex justify-content-end w-100 mb0 mt30",children:u.jsxs("div",{className:(e?"click-off":"")+" d-flex",children:[u.jsx(U,{onClick:()=>{L(!1),h(null)},children:"Cancel"}),u.jsx("div",{className:null!==p?"click-off":"",children:u.jsx(z,{onClick:()=>{null!==s?null===p&&(o(!0),g((e=>{!0!==(null==e?void 0:e.status)&&(L(!1),h(null),c(!1),getDuplicateData(x,s))}))):h("Enter dynamic list name")},children:"Save"})})]})})]})]})}));return u.jsxs(Je,{children:[u.jsx(st,{fluid:!0,className:"main-heading-wrapper mb0",children:u.jsxs(st,{className:"mhw-container",children:[u.jsx("div",{className:"mhwc-left",children:u.jsx("h1",{children:u.jsx("div",{className:"mh-wrapper",children:u.jsx("span",{className:"mh-text",children:"Dynamic lists"})})})}),u.jsx("div",{className:"mhwc-right",children:((null==qe?void 0:qe.length)>0||null!=Be)&&u.jsx(Tt,{data:qe,defaultItem:null==Be?void 0:Be.clientName,alignRight:!0,fieldKey:"clientName",onSelect:e=>{G(is(it(ls(-29)).format("DD MMM yyyy"))),H(is(it(new Date).format("DD MMM yyyy"))),be(ye),Z(1),pe(""),ve(0),Le(""),ut()}})})]})}),f&&u.jsx(wt,{}),u.jsxs(st,{className:"page-header box-bottom-space",children:[u.jsx(It,{}),b&&u.jsx(Kt,{isOpen:b,selectItem:V,onChangeIsOpen:e=>{j(!b)}})]})]})};class os extends m.Component{constructor(){super(...arguments),c(this,"currentIndex",1),c(this,"auidenceCount",889774),c(this,"state",{isReqApprAny:0,ishierarchy:!1,showApproveBtn:!1,dynamicListName:"",dynamicListNameErrMessage:null,listError:!1,listNameError:!1,list:[],listId:0,requestForApproval:!1,triggerSelected:!1,errorMessage:null,apiErrMsg:null,showPopUp:!0,showSavePopup:!1,isConfirmPopup:!1,isDlNameChanged:!1,approvalList:[{dynamicListApprovalID:0,dynamicListId:0,dynamicListListName:"",departmentId:0,userid:0,roleID:0,firstName:"",lastName:null,email:"-- Select approver --",accessToken:null,errorMessage:""}],approvalSettings:{approvalMatchType:"All",approvalMatchCount:0,isFollowHierarchyEnabled:!1},ruleCondition:"And",attributtesList:[],clickOffStatus:!1,reStatus:"false",blastCount:0,fullData:null,errRFA:null,approverList:[],isRejectModal:!1}),c(this,"getDataFromServer",(e=>{let t={id:e};this.context.globalStateData.setIsLoadingData(!0),D({path:Te,isServiceWorker:!1,params:t,sessionOut:this.props.context.globalStateData.setSessionOutData,ok:e=>{var t,a,s,l,i;if(e.status&&(null==(t=null==e?void 0:e.data)?void 0:t.dynamicList)){let t=Re(e.data.dynamicList);if(this.setState({triggerSelected:!0}),ue(t))this.context.globalStateData.setIsLoadingData(!1),this.setState(nt((e=>{e.apiErrMsg="Unknow error occurred"})));else if(this.setState({fullData:e.data.dynamicList,listError:!0,listNameError:!0}),this.setState({ruleCondition:t.ruleCondition}),this.setState({dynamicListName:t.listName,list:t.ruleGroup,isLocation:!0}),this.getUserList(),null==(s=null==(a=null==e?void 0:e.data)?void 0:a.dynamicListRFAList)?void 0:s.length){let t={approvalMatchType:"All",approvalMatchCount:0,isFollowHierarchyEnabled:!1};e.data.dynamicListRFAList.map((e=>(t.approvalMatchCount=e.noOfApprover,t.approvalMatchType=e.approvalCondition,t.isFollowHierarchyEnabled=e.isHierarchy,e.firstName=e.approverName,e.email=e.approverEmail,e.userid=e.dynamicListApprovalID,e.isMandatory=e.isMandatory,e))),this.setState({statustest:this.state.reStatus,requestForApproval:null==(i=null==(l=null==e?void 0:e.data)?void 0:l.dynamicList)?void 0:i.isRequestApproval,approvalList:e.data.dynamicListRFAList,approvalSettings:t})}else this.context.globalStateData.setIsLoadingData(!1)}else this.context.globalStateData.setIsLoadingData(!1),this.setState(nt((e=>{e.apiErrMsg="Problem with response"})))},fail:e=>{this.context.globalStateData.setIsLoadingData(!1),this.setState(nt((t=>{t.apiErrMsg=(null==e?void 0:e.message)||"Something went wrong"})))}})})),c(this,"createObject",(e=>{var t={ruleGroupName:e.toString(),disabled:!0,matchType:"All",trigger:"",source:{},condtion:!0,matchCount:"",values:[],rule:[],error:{errMatchType:null,errTrigger:null,errSource:null,errRules:null}};let a=sessionStorage.getItem("dl_live_top_screen");if(null!=a){let e=xe(a);t.trigger=e.trigger,t.source=e.source,t.disabled=!1,this.setState({dynamicListName:e.listName})}return t})),c(this,"getUserList",(()=>{let e={dbName:"cust_c4363a53_4d19_4eb9_b83e_d3ba1f1f9f1e",departmentId:0,clientId:E()};D({path:se,isServiceWorker:!1,params:e,sessionOut:this.props.context.globalStateData.setSessionOutData,ok:e=>{this.context.globalStateData.setIsLoadingData(!1),e.status&&e.data.length&&this.setState({approverList:e.data})},fail:e=>{this.context.globalStateData.setIsLoadingData(!1)}})})),c(this,"campaignPlanAssets1",(()=>{Ve(this.props.context,(e=>{}))})),c(this,"handleClose",(()=>{this.setState({errorMessage:null,showPopUp:!1})})),c(this,"buildParams",(()=>{let e=0,t=$e;0!==this.state.listId&&(e=this.state.listId,t=Ge);let a=this.prepareParams(e);D({path:t,params:a,isServiceWorker:!1,loading:this.context.globalStateData.setIsLoadingData,sessionOut:this.context.globalStateData.setSessionOutData,ok:e=>{var t,a,s,l;if(!0===e.status||"true"===e.status){if(0!==this.state.listId){let t=Q(),a={dynamicListId:e.data,dynamicListName:this.state.dynamicListName};return t.dynamicList.length>0&&(t.dynamicList.map((t=>{t.dynamicListId===e.data&&(t.dynamicListId=a.dynamicListId,t.dynamicListName=this.state.dynamicListName)})),qe(t)),this.props.context.globalStateData.setIsLoadingData(!1),void this.props.history.push("/audience/twin-list")}if(0===this.state.approverList.length){let t=Q(),a={dynamicListId:e.data,dynamicListName:this.state.dynamicListName};t.dynamicList=[a].concat(t.dynamicList),qe(t)}const i=rt.parse(null==(a=null==(t=this.props.history)?void 0:t.location)?void 0:a.search);if("true"===((null==i?void 0:i.isCampaign)||!1)){if((null==(s=null==window?void 0:window.sdxDetails)?void 0:s.campaignDetails)&&0===this.state.approverList.length){let t={dynamicListId:e.data,dynamicListName:this.state.dynamicListName};(null==(l=null==window?void 0:window.sdxDetails)?void 0:l.campaignDetails).dynamicList=t}return void this.props.history.push({pathname:"/campaign/planning",search:"cId=0&sl=false&cs=0"})}this.state.listId,this.props.history.push("/audience/twin-list")}else this.setState({showPopUp:!0,errorMessage:(null==e?void 0:e.message)||"Please try again"})},fail:e=>{}})})),c(this,"prepareParams",(e=>{let t={listId:e,listName:this.state.dynamicListName.trim(),ruleList:this.state.list,ruleCondition:this.state.ruleCondition,approverList:this.state.approvalList,approverSetting:this.state.approvalSettings,context:this.props.context,isRequestApproval:0!==this.state.approverList.length&&this.state.requestForApproval,params:this.state.params,domainName:this.state.domainName,isReqApprAny:this.state.isReqApprAny,ishierarchy:this.state.ishierarchy};return va(t)})),c(this,"getMatchedAuidence",((e,t,a)=>{var s;let l=[...this.state.list],i=l[t].rule[a];i.isLoading=!0,this.setState({list:l});let r=F(),n=`getdynamiclistfilename?T1_s=${null==(s=null==r?void 0:r.clientDetailsLocalization)?void 0:s.tenantShortCode}&B1_s=0`;D({bUrl:"http://10.151.2.2:7505/",path:n,isServiceWorker:!1,isCache:!1,params:e,ok:e=>{var a,s;if(i.isLoading=!1,null==e?void 0:e.status){i.isLoading=!1;let r=0;0===t?r=(null==(a=null==e?void 0:e.data)?void 0:a.grp1Count)||0:1===t&&(r=(null==(s=null==e?void 0:e.data)?void 0:s.grp2Count)||0),i.auidenceCount=r,this.setState({list:l})}},fail:e=>{i.isLoading=!1,this.setState({list:l})}})})),c(this,"dynamicListNameExists",((e,t)=>{D({path:le,isServiceWorker:!1,isCache:!1,params:{dynamicListName:e},sessionOut:this.context.globalStateData.setSessionOutData,ok:e=>{!0===e.status?(this.setState({dynamicListNameErrMessage:"Dynamic list name already exists",listError:!1,listNameError:!1}),t({dynamicListNameErrMessage:"Dynamic list name already exists",listError:!1,listNameError:!1})):(t({dynamicListNameErrMessage:null,listError:!0,listNameError:!0}),this.setState({dynamicListNameErrMessage:null,listError:!0,listNameError:!0}))},fail:e=>{}})})),c(this,"createUpdateHandler",(()=>{if(null===this.state.dynamicListNameErrMessage){var e=this.addBtnClicked(this.state.dynamicListName,this.state.list);e[0]?this.buildParams():this.setState({errorMessage:e[1],showPopUp:!0})}})),c(this,"rejectHandler",(e=>{D({path:Fe,isServiceWorker:!1,isCache:!1,params:{dynamicListId:this.state.listId,comment:e},loading:this.context.globalStateData.setIsLoadingData,sessionOut:this.context.globalStateData.setSessionOutData,ok:e=>{this.props.history.push("/audience/twin-list")},fail:e=>{alert(e)}})})),c(this,"approveHandler",(()=>{D({path:Be,isServiceWorker:!1,isCache:!1,params:{dynamicListId:this.state.listId},loading:this.context.globalStateData.setIsLoadingData,sessionOut:this.context.globalStateData.setSessionOutData,ok:e=>{this.props.history.push("/audience/twin-list")},fail:e=>{alert(e)}})})),c(this,"showButton",(()=>{var e,t;const a=rt.parse(null==(t=null==(e=this.props.history)?void 0:e.location)?void 0:t.search);if(0!==Number(a.bc))return!1;let s=!1;for(const l of this.state.approvalList)if("All"===l.approvalCondition&&!0===l.isHierarchy){if(l.approverEmail===F().emailId&&0===l.approvalStatus){s=!0;break}if(1!==l.approvalStatus)break;if(l.approverEmail===F().emailId&&0===l.approvalStatus){s=!0;break}if(l.approverEmail===F().emailId&&1===l.approvalStatus){s=!1;break}if(l.approverEmail===F().emailId&&2===l.approvalStatus){s=!1;break}}else{if(l.approverEmail===F().emailId&&0===l.approvalStatus){s=!0;break}if(l.approverEmail===F().emailId&&1===l.approvalStatus){s=!1;break}if(l.approverEmail===F().emailId&&2===l.approvalStatus){s=!1;break}}return s})),c(this,"showView",(()=>{var e,t,a,s;const l=rt.parse(null==(t=null==(e=this.props.history)?void 0:e.location)?void 0:t.search);if("true"===l.ar)return 0===Number(l.lId)&&this.showButton();if(0===Number(l.lId))return!0;if(0!==Number(l.lId)&&0===Number(l.bc)){if("false"===l.ar)return null!==this.state.fullData&&this.state.fullData.createdBy===F().userId;(null==(s=null==(a=this.state)?void 0:a.approvalList)?void 0:s.length)&&this.state.approvalList.map((e=>{if(e.approverEmail===F().emailId&&1===e.approvalStatus||e.approverEmail===F().emailId&&2===e.approvalStatus)return!1}))}else if(0!==Number(l.lId)&&1===Number(l.bc))return!1})),c(this,"checkRFAForRoleBased",(()=>{if(this.state.requestForApproval){let e=[...this.state.approvalList];e.map(((t,a)=>{"-- Select approver --"===e[a].email?e[a].errorMessage=ce:e[a].errorMessage=""})),this.setState({approvalList:e}),e.some((e=>""!==e.errorMessage))||this.createUpdateHandler()}else this.createUpdateHandler()})),c(this,"CreateUpdateButton",(()=>{var e,t,a;const s=rt.parse(null==(t=null==(e=this.props.history)?void 0:e.location)?void 0:t.search);let l=void 0!==(null==s?void 0:s.view)?null==s?void 0:s.view:"false",i=void 0!==(null==s?void 0:s.ar)?null==s?void 0:s.ar:"false";return"true"===l.toLowerCase()||"true"===i.toLowerCase()?u.jsx(u.Fragment,{}):u.jsxs(z,{id:0!==this.state.listId?"dl_update_btn":"dl_create_btn",className:(null==(a=this.state.list[0])?void 0:a.rule.length)>0?null:"click-off",onClick:()=>{let e=F(),t=e.userTypeId;if(4!==t)if(3===t)if("1"===e.roleId)this.checkRFAForRoleBased();else{if(this.state.approverList.length>0&&!this.state.requestForApproval)return void this.setState({errRFA:Oe});this.checkRFAForRoleBased()}else{if(this.state.approverList.length>0&&!this.state.requestForApproval)return void this.setState({errRFA:Oe});this.checkRFAForRoleBased()}else this.checkRFAForRoleBased()},children:[0!==this.state.listId?"Update":"Create"," rule"]})})),c(this,"DLNameComponent",(e=>{const[t,a]=m.useState(!1);return u.jsx(yt,{className:"mb20 mt43",children:u.jsxs(Qe,{children:[u.jsx(et,{md:2,children:u.jsx(bt,{label:"List name"})}),u.jsx(et,{md:3,className:"pl30 pr0 list-name",children:u.jsx(ht,{id:"dl_listname_text",isLoading:t,iconPlaceholder:null===this.state.dynamicListNameErrMessage&&!t,iconName:this.state.dynamicListName.length>0&&!0===this.state.listNameError?"icon-rs-circle-tick-medium icons-md green":"",required:!0,placeholder:"List name",val:this.state.dynamicListName,max:At,errorMessage:this.state.dynamicListNameErrMessage,handleOnchange:e=>{if(e.length>=51)this.setState({dynamicListNameErrMessage:"Dynamic list name exceeded the limit"});else if(this.setState({isDlNameChanged:!0}),!e.includes("'")&&(""===e||/^[' 'A-Za-z0-9_-]*$/.test(e))){let t=e.replace(/\s+/g," "),a=e.length>0?null:"Enter dynamic list name";this.setState({dynamicListNameErrMessage:a,dynamicListName:t.trimStart(),listError:!1,listNameError:!1})}},handleOnBlur:e=>{e.length>50?this.setState({dynamicListNameErrMessage:"Dynamic list name exceeded the limit"}):(this.setState({dynamicListNameErrMessage:null}),e.length>0&&this.state.isDlNameChanged&&(a(!0),this.dynamicListNameExists(e,(e=>{a(!1)})),this.setState({isDlNameChanged:!this.state.isDlNameChanged})))}})})]})})})),c(this,"ButtonContainerComponent",(e=>{var t,a,s,l,i,r,n;const o=rt.parse(null==(a=null==(t=this.props.history)?void 0:t.location)?void 0:a.search);return u.jsxs("div",{className:"btn-container d-flex justify-content-end w-100 box-bottom-space ",children:["true"===(null==o?void 0:o.view)?u.jsx(z,{id:"dl_backtolist",onClick:()=>{this.props.history.push("/audience/twin-list")},children:"Back to list"}):u.jsx(U,{id:"dl_cancel_button",onClick:()=>{this.props.history.push("/audience/twin-list")},children:"Cancel"}),"true"===this.state.reStatus&&this.showButton()?u.jsxs(u.Fragment,{children:[u.jsxs(_e,{id:"dl_reject_button",onClick:()=>{this.setState({isRejectModal:!0}),Ve(this.context,(e=>{}))},children:[" ","Reject"," "]}),u.jsxs(z,{id:"dl_approve_button",onClick:()=>{this.approveHandler(),Ve(this.context,(e=>{}))},children:[" ","Approve"," "]})]}):null,null!==(null==(s=this.state)?void 0:s.fullData)&&(null==(i=null==(l=this.state)?void 0:l.fullData)?void 0:i.createdBy)===F().userId?u.jsx(this.CreateUpdateButton,{}):(null==(n=null==(r=this.state)?void 0:r.fullData)?void 0:n.createdBy)!==F().userId?u.jsx(u.Fragment,{children:"false"===this.state.reStatus&&0===this.state.blastCount&&u.jsx(this.CreateUpdateButton,{})}):u.jsx(u.Fragment,{})]})})),c(this,"DLRejectModal",(e=>u.jsx(Lt,{primaryButtonText:"Reject",callback:e=>{this.setState({isRejectModal:!1}),this.rejectHandler(e)}})))}componentDidMount(){var e,t,a,s,l;const i=rt.parse(null==(t=null==(e=this.props.history)?void 0:e.location)?void 0:t.search);let r=void 0!==(null==i?void 0:i.lId)?parseInt(null==i?void 0:i.lId):null==(l=null==(s=null==(a=this.props.history)?void 0:a.location)?void 0:s.state)?void 0:l.listId,n=parseInt(null==i?void 0:i.bc)||0,o=window.location.hostname;this.setState({listId:r,reStatus:(null==i?void 0:i.ar)||"false",params:window.location.href,domainName:o,blastCount:n});let d=void 0!==(null==i?void 0:i.view)?null==i?void 0:i.view:"false";(0!==n||"true"===d.toLowerCase())&&this.setState({clickOffStatus:!0}),this.campaignPlanAssets1(),0!==r?this.getDataFromServer(r):(this.getUserList(),this.setState({list:[this.createObject(this.currentIndex)]}))}addBtnClicked(e,t){return pa(e,t)}render(){var e,t,a,s,l,i,r,n,o,d,c,m;return u.jsxs("div",{id:"sdx_dl_creation",children:[this.state.errorMessage&&u.jsxs(Ze,{show:this.state.showPopUp,centered:!0,onHide:()=>this.handleClose(),children:[u.jsxs(Ze.Header,{children:[u.jsx("h2",{children:"Alert"}),u.jsx(lt,{mainClass:"close",size:"md",handleClose:()=>{this.handleClose()}})]}),u.jsx(Ze.Body,{children:u.jsx("p",{children:this.state.errorMessage})})]}),this.state.isRejectModal&&u.jsx(this.DLRejectModal,{}),u.jsx(Ze,{show:!!this.state.apiErrMsg||null,centered:!0,onHide:()=>this.setState(nt((e=>{e.apiErrMsg=null}))),children:u.jsxs(Ze.Body,{children:[u.jsx(lt,{mainClass:"close position-absolute right-10 top-10",size:"md",handleClose:()=>{this.setState(nt((e=>{e.apiErrMsg=null}))),this.props.history.push("/audience/twin-list")}}),u.jsx("p",{children:this.state.apiErrMsg})]})}),this.state.isConfirmPopup&&u.jsx(Ct,{headerTitle:"Dynamic List",title:`The dynamic rule is ${0===this.state.listId?"created":"updated"}. Do you want to create a communication?`,secondaryButtonText:"Later",primaryButtonText:"Proceed",buttonClicked:e=>{this.setState({isConfirmPopup:!1}),!0===e?this.props.history.push({pathname:"/campaign/planning",search:"?cId=0&sl=false",state:{isSmartlinkCampaign:!1,campaignId:-1,status:"Draft"}}):this.props.history.push("/audience/twin-list")}}),u.jsx(st,{fluid:!0,className:"main-heading-wrapper mb0",children:u.jsxs(st,{className:"mhw-container",children:[u.jsx("div",{className:"mhwc-left",children:u.jsx("h1",{children:u.jsx("div",{className:"mh-wrapper",children:u.jsxs("span",{className:"mh-text",children:[0!==this.state.listId&&"view"!==(null==(s=null==(a=null==(t=null==(e=this.props)?void 0:e.history)?void 0:t.location)?void 0:a.state)?void 0:s.type)?"Update":"view"===(null==(n=null==(r=null==(i=null==(l=this.props)?void 0:l.history)?void 0:i.location)?void 0:r.state)?void 0:n.type)?"":"New"," ","view"===(null==(m=null==(c=null==(d=null==(o=this.props)?void 0:o.history)?void 0:d.location)?void 0:c.state)?void 0:m.type)?"Dynamic list":"dynamic list"]})})})}),u.jsx("div",{className:"mhwc-right",children:u.jsxs("div",{className:"back-text",id:"dl_back_button",onClick:()=>this.props.history.push("/audience/twin-list"),children:[u.jsx(O,{icon:ye,size:"sm"}),"Back"]})})]})}),u.jsxs(st,{className:"page-header",children:[u.jsxs("div",{className:this.showView()?"click-on":"click-off",children:[(this.state.listId,u.jsx(this.DLNameComponent,{})),this.state.list.map(((e,t)=>u.jsxs("div",{children:[u.jsx(_a,{data:e,listId:this.state.listId,history:this.props.history,context:this.props.context,array:this.state.list,attributtesList:this.state.attributtesList,index:t,disabled:ue(this.state.dynamicListName),statustest:this.state.reStatus,errorMessage:this.state.errorMessage,rulesAdded:()=>{let e=[...this.state.list];this.setState({list:e}),this.forceUpdate()},ruleNameChange:e=>{let a=this.prepareParams(this.state.listId);1===this.state.list.length&&(a.dynamicListRule.RuleCondition="Or"),this.getMatchedAuidence(a.dynamicListRule,t,e)},closeBtnClicked:()=>{var t=[...this.state.list],a=t.indexOf(e);t.splice(a,1),this.setState({list:t}),this.currentIndex=this.currentIndex-1},triggerChanged:e=>{this.setState({triggerSelected:e})}}),this.state.list.length>1&&0===t?u.jsx(Qe,{children:u.jsx(et,{children:u.jsx("div",{className:"w-100 d-flex justify-content-center marginB25 switch-divider mt12",children:u.jsx(N,{className:"sw-and mt5",onLabel:"And",offLabel:"Or",onChange:t=>{e.condtion=t.target.value,e.condtion?this.setState({ruleCondition:"And"}):this.setState({ruleCondition:"Or"});let a=this.prepareParams(this.state.listId);1===this.state.list.length?a.dynamicListRule.RuleCondition="Or":a.dynamicListRule.RuleCondition=!0===e.condtion?"And":"Or",this.getMatchedAuidence(a.dynamicListRule,0,0),this.forceUpdate()},checked:"And"===this.state.ruleCondition})})})}):null]},t))),this.state.list.length<=1&&this.state.dynamicListName.length>0&&!0===this.state.listNameError?u.jsx("div",{className:"dynamicListAddIcon",children:u.jsx(I,{className:"gallery-dropdown-button",align:"start",popupSettings:{animate:!0,popupClass:"ic-dropdown"},text:u.jsx(ne,{text:"Add rule group",position:"top",show:!1,children:u.jsx("i",{className:"icon-rs-circle-plus-fill-edge-medium color-primary-blue icons-lg"})}),dir:"rtl",onItemClick:e=>{if(null===this.state.dynamicListNameErrMessage){var t=this.addBtnClicked(this.state.dynamicListName,this.state.list);if(!0===t[0]){this.currentIndex=this.currentIndex+1;var a=[...this.state.list];a.push(this.createObject(this.currentIndex)),this.setState({list:a});let e=document.getElementById("sdx_dl_creation");window.scrollTo({top:e.offsetTop,behavior:"smooth"})}else{let e=[...this.state.list];this.setState({list:e}),this.setState({errorMessage:t[1],showPopUp:!0})}}},items:[{text:"Rule - Group 2"}]})}):null,u.jsxs("p",{className:"marginT10",children:[u.jsx("strong",{children:"Note : "}),"Probabilistic audience size prediction is derived from last 90 days"]}),this.state.triggerSelected&&u.jsx("div",{className:`${null===this.state.errRFA?"mt10":"mt30"} ${0===this.state.approverList.length&&"d-none"}`,children:u.jsx(yt,{children:u.jsx(Et,{children:u.jsx("li",{children:u.jsx(vt,{lbl:"Request for approval",checked:this.state.requestForApproval,errorMessage:this.state.errRFA,iconPlaceholder:!0,iconName:"icon-rs-circle-question-mark-medium",iconPopover:"Get the list approved by the concerned person",handleChange:e=>{!0===e.target.checked&&this.setState({approvalList:[{email:"-- Select approver --",errorMessage:""}],errRFA:null,approvalSettings:{approvalMatchType:"All",approvalMatchCount:0,isFollowHierarchyEnabled:!1}}),this.setState({requestForApproval:e.target.checked})}})})})})}),this.state.requestForApproval&&this.state.approverList.length>0&&u.jsx("div",{className:"click-on theme-space-mt",children:u.jsx(oa,{approverList:this.state.approverList||[],approvalList:this.state.approvalList||[],approvalSettings:this.state.approvalSettings,context:this.props.context,clickModelShow:e=>{this.setState({requestForApproval:e})},isReqApprSettings:e=>{this.setState({isReqApprAny:e})},isRFAhierarchy:e=>{this.setState({ishierarchy:e})}})})]}),0===this.state.listId||this.state.dynamicListName.length?u.jsx(this.ButtonContainerComponent,{}):null]})]})}}c(os,"contextType",k);const ds=v(os),cs=e=>{const t=m.useContext(k);return u.jsx(Je,{children:u.jsx(ds,{mode:"add",context:t,history:e.history})})},us=e=>{let t=g(),a=h();return u.jsxs(x,{children:[u.jsx(y,{exact:!0,path:`${t.url}/`,children:u.jsx(ia,{history:a})}),u.jsx(y,{path:`${t.url}/new-dynamic-list`,children:u.jsx(Xa,{history:a})}),u.jsx(y,{exact:!0,path:`${t.url}/twin-list`,children:u.jsx(rs,{history:a})}),u.jsx(y,{path:`${t.url}/twin-new-dynamic-list`,children:u.jsx(cs,{history:a})})]})};export{us as default};

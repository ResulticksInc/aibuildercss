var e=Object.defineProperty,s=(s,i,t)=>(((s,i,t)=>{i in s?e(s,i,{enumerable:!0,configurable:!0,writable:!0,value:t}):s[i]=t})(s,"symbol"!=typeof i?i+"":i,t),t);import{j as i}from"./pdf-editor-e8cb7a76.js";import{L as t}from"./LayoutPageWrapper-ab434993.js";import{w as l,r as a}from"./react-vendor-379f659a.js";import"./BOFPlatform-59e5f0a4.js";import{z as r,aj as n,CW as c,B as d,E as o,az as m,ar as h,dj as p,U as v,M as u,aS as j,Cu as x}from"./index-23a09c37.js";import{C as f}from"./CustomEvent_FieldTracking-b2f87827.js";import{R as k}from"./RSIcon-d18be5d2.js";import{v as T,s as b}from"./BOFController-d5d49f34.js";import{R as g}from"./RSFormGroup-ffdfb1d7.js";import{R as N}from"./RSKendoDropdown-32d89038.js";import{R as y}from"./RSCheckbox-b4d531b7.js";import"./style-a86a43a5.js";import"./RSDropdowns-e011803c.js";import{F as C}from"./FormLabel-83e0741f.js";import{F as L}from"./FormFieldIcon-3c0298f7.js";import{R as S,M as F,a as A,A as D,c as w,C as M}from"./ui-f7791cf3.js";import{q as B}from"./utils-16c7e021.js";import{F as W}from"./FieldTracking-34b186e0.js";import R from"./RSBanner-097571ac.js";import"./index-566d2b59.js";import"./get-4aa85b1a.js";import"./kendo-5d73125a.js";import"./drag-drop-2020d552.js";import"./RSConfirmAlert-1017f59d.js";import"./Features.styled-606ffe3c.js";import"./index-cbd12d4f.js";import"./mobx-e1586d6a.js";import"./RSSwitch-6df3c521.js";import"./NewAttribute-4c022c71.js";class I extends a.Component{constructor(){super(...arguments),s(this,"state",{platFormTypes:["Android phone","Android Tablet","iPhone","iPad"],isFieldTrack:!1,commonMsg:null,deviceList:[{deviceType:null,mobileApp:null,error:{errDeviceType:null,errMobileApp:null},fieldList:[]}],fieldTrackData:null,deviceType:null,mobileApp:null,mobileAppList:[],activationKey:0,showFormNameComponent:!1,formName:"",errFormName:null,fieldTrack_AppName:null,mobileAppFilterList:null,startDate:null,endDate:null,errStartDate:null,errEndDate:null,endDateMinValue:""}),s(this,"createDeviceList",(()=>({deviceType:null,mobileApp:this.state.mobileApp,error:{errDeviceType:null,errMobileApp:null},fieldList:[]}))),s(this,"createError",(()=>({errPlayStoreUrl:null,errLanguage:null,errWebUrl:null,errDeviceType:null}))),s(this,"getPlatformTypes",(()=>{let e=this.state.platFormTypes,s=[];return e.map((e=>{0===this.state.deviceList.filter((s=>e===s.deviceType)).length&&s.push(e)})),s})),s(this,"addBtnClick",(()=>{let e=T(this.state.deviceList);if(e.error){let s=[...this.state.deviceList];1===e.errType?s[e.errIndex].error.errDeviceType=e.errMsg:2===e.errType?s[e.errIndex].error.errMobileApp=e.errMsg:3===e.errType&&(this.setState({commonMsg:e.errMsg}),setTimeout((()=>{this.setState({commonMsg:null})}),2e3)),this.setState({deviceList:s})}else{let e=[...this.state.deviceList];e.push(this.createDeviceList()),this.accordinChanges(e.length-1),this.setState({deviceList:e})}})),s(this,"removeBtnClick",(e=>{let s=[...this.state.deviceList];s.splice(e,1),this.setState({deviceList:s})})),s(this,"valueChange",((e,s,i,t,l)=>{let a=[...this.state.deviceList];a[e][s]=i,a[e].error[t]=l,this.setState({deviceList:a})})),s(this,"accordinChanges",(e=>{this.state.activationKey===e?this.setState({activationKey:"-1"}):this.setState({activationKey:e})})),s(this,"deleteFieldList",((e,s)=>{let i=this.state.deviceList[0];i.fieldList.splice(s,1),this.setState({deviceList:[i],elementArray:[i]});let t=[...this.state.controlsArray];null==t||t.map((s=>{s.viewId===e.field.viewId&&(s.select=!1,s.click=!1)}));let l=[...this.state.selectControls];null==l||l.map((s=>{s.viewId===e.field.viewId&&(s.select=!1,s.click=!1)})),this.setState({selectControls:l,controlsArray:t})})),s(this,"AddFormEvents",(e=>i.jsxs(S,{children:[i.jsxs("div",{className:"align-items-center d-flex mb10",children:[i.jsx("i",{className:"icon-rs-events-mini icon-sm color-primary-blue padding-R5"}),i.jsx("h4",{className:"mb-0 padding-L5",style:{paddingLeft:5},children:"Form fields"})]}),this.state.deviceList[(null==e?void 0:e.index)||0].fieldList.length>0&&this.state.deviceList[(null==e?void 0:e.index)||0].fieldList.map(((e,s)=>{var t,l;return i.jsxs("div",{className:"event-tracking-list",children:[i.jsxs("div",{className:"event-actions",children:[!0===e.eventTracking.markAsGoal&&i.jsx("span",{children:i.jsx("i",{className:"icon-rs-goal-achieved-medium icons-md blue"})}),i.jsx("span",{children:i.jsx("i",{className:!0===e.eventTracking.mandadory?"icon-rs-asterisk-mini red icons-sm mand-field cursor-pointer":"icon-rs-asterisk-mini icons-sm mand-field cursor-pointer",onClick:()=>{let e=[...this.state.elementArray];e[s].eventTracking.mandadory=!e[s].eventTracking.mandadory,this.setState({elementArray:e})}})}),i.jsx("span",{children:i.jsx("i",{className:"icon-rs-delete-medium icons-md color-primary-blue cursor-pointer",onClick:()=>{this.deleteFieldList(e,s)}})})]}),i.jsxs("div",{className:"event-section",children:[i.jsxs("div",{className:"event-row",children:[i.jsx("span",{className:"label-field",children:"Event name"}),i.jsx("span",{className:"label-value",children:e.eventTracking.eventName})]}),(null==(t=e.eventTracking.trackingType)?void 0:t.displayName)?i.jsxs("div",{className:"event-row",children:[i.jsx("span",{className:"label-field",children:"Tracking action"}),i.jsx("span",{className:"label-value",children:null==(l=e.eventTracking.trackingType)?void 0:l.displayName})]}):null]})]})}))]})))}componentDidMount(){let e=sessionStorage.getItem("AppNameTracking")||null;this.setState({fieldTrack_AppName:e});let s=n();if(null!=e&&null!==s&&null!==s.mobileAppsList){let i=s.mobileAppsList.filter(((s,i)=>s.appName==e)),t=[{deviceType:null,mobileApp:null,error:{errDeviceType:null,errMobileApp:null},fieldList:[]}];t[0].mobileApp=i[0],this.setState({mobileAppFilterList:i,deviceList:t})}null!==s&&null!==s.mobileAppsList&&this.setState({mobileAppList:s.mobileAppsList})}render(){var e,s;return i.jsxs("div",{children:[this.state.showFormNameComponent&&i.jsxs(F,{show:this.state.showFormNameComponent,centered:!0,size:"md",children:[i.jsxs(F.Header,{children:[i.jsx("h2",{children:"Custom Event Form "}),i.jsx(k,{mainClass:"close",size:"md",handleClose:()=>{this.setState({showFormNameComponent:!1})}})]}),i.jsx(F.Body,{children:i.jsx(g,{children:i.jsxs(S,{children:[i.jsxs(A,{md:4,children:[i.jsx(C,{label:"Form name"})," "]}),i.jsx(A,{md:8,children:i.jsx(y,{required:!0,className:"required",placeholder:0===this.state.formName.length?"Enter form name":"Form name",value:this.state.formName,handleOnchange:e=>{let s=0===e.length?c:null;this.setState({formName:e,errFormName:s})},handleOnBlur:e=>{let s=0===e.length?c:null;this.setState({formName:e,errFormName:s})}})})]})})}),i.jsxs("div",{className:"d-flex justify-content-end",children:[i.jsx(d,{onClick:()=>{this.setState({showFormNameComponent:!1})},children:"Cancel"}),i.jsx(o,{className:(null==(e=this.state.formName)?void 0:e.length)>0?"":"click-off",onClick:()=>{let e={formName:this.state.formName,controls:this.state.deviceList};b(e,this.context,(e=>{this.props.history.push("form-generator")}))},children:"Save"})]})]}),1==this.state.isFieldTrack&&null!==this.state.fieldTrackData?i.jsxs(F,{show:this.state.isFieldTrack,fullscreen:!0,className:"modal-top-fixed fluid-container-modal field-track-mobile-modal",children:[i.jsxs(F.Header,{children:[i.jsxs("h2",{children:[null!=this.state.fieldTrack_AppName?"Custom Event":"Brand own form","  "]}),i.jsx(k,{mainClass:"close",size:"md",handleClose:()=>{this.setState({isFieldTrack:!1})}})]}),i.jsx(F.Body,{children:i.jsx(f,{isWebFieldTrack:!1,isForm:!0,fieldTrackData:this.state.fieldTrackData,fieldTrackName:this.state.fieldTrack_AppName,saveBtnClicked:e=>{let s=[...this.state.deviceList];s[this.state.activationKey].fieldList=e,this.setState({deviceList:s}),this.setState({isFieldTrack:!1,fieldTrackData:null})},cancelBtnClicked:()=>{this.setState({isFieldTrack:!1,fieldTrackData:null})}})})]}):null,i.jsx("div",{className:"position-relative",children:i.jsxs("div",{className:"rs-accordin-container",children:[i.jsxs("div",{className:"posr",children:[null==(s=this.state.deviceList)?void 0:s.map(((e,s)=>{var t,l;return i.jsx("div",{className:"",children:i.jsx(D,{className:"rs-accordin mb0",activeKey:this.state.activationKey,children:i.jsxs(w,{children:[i.jsx(w.Header,{children:i.jsxs("div",{className:"rs-accordin-header",onClick:()=>{this.accordinChanges(s)},children:[i.jsxs("div",{className:"d-flex",children:[i.jsx("i",{class:`icon-md ${s!==this.state.activationKey?"icons-md icon-rs-square-plus-fill-medium color-primary-blue marginR8":"icons-md icon-rs-square-minus-fill-medium grey-medium marginR8"} marginR8`}),i.jsxs("h3",{children:[void 0!==(null==e?void 0:e.deviceType)&&""!==(null==e?void 0:e.deviceType)&&null!==e.deviceType?null==e?void 0:e.deviceType:"Device type",""]})]}),0!==s?i.jsx("i",{className:"icon-rs-circle-minus-fill-edge-medium icons-md red cursor-pointer",onClick:()=>{this.removeBtnClick(s)}}):null]})}),i.jsx(D.Collapse,{eventKey:s,children:i.jsx(w.Body,{children:i.jsxs("div",{className:"rs-accordin-panel",children:[i.jsxs(i.Fragment,{children:[i.jsx(g,{children:i.jsxs(S,{children:[i.jsx(A,{md:3,children:i.jsx(C,{label:"Device type"})}),i.jsx(A,{md:5,children:i.jsx(N,{required:!0,label:"Device",data:this.getPlatformTypes(),errorMessage:e.error.errDeviceType,value:null===this.state.deviceList[s].deviceType?"-- Select device --":this.state.deviceList[s].deviceType,onChange:e=>{let i=0===e.target.value.length?"Select device":null;this.valueChange(s,"deviceType",e.target.value,"errDeviceType",i)}})})]})}),""!==(null==(t=null==e?void 0:e.deviceType)?void 0:t.toLowerCase())&&"web"!==(null==(l=null==e?void 0:e.deviceType)?void 0:l.toLowerCase())&&i.jsx(g,{children:i.jsxs(S,{children:[i.jsx(A,{md:3,children:i.jsx(C,{label:"Mobile app"})}),null!=this.state.fieldTrack_AppName?i.jsx(A,{md:5,children:i.jsx(y,{val:this.state.fieldTrack_AppName,disabled:!0})}):i.jsx(A,{md:5,children:i.jsx(N,{required:!0,label:(this.state.deviceList[0].mobileApp,"Mobile app"),data:this.state.mobileAppList,errorMessage:e.error.errMobileApp,textField:"appName",dataItemKey:"appGuid",value:null===this.state.deviceList[0].mobileApp?{appName:"-- Select mobile app --",appGuid:0}:this.state.deviceList[0].mobileApp,onChange:e=>{this.setState({mobileApp:e.target.value});let i=[...this.state.deviceList];i[s].mobileApp=e.target.value,i[s].error.errMobileApp=null,this.setState({deviceList:[i[s]]})}})}),i.jsx(A,{md:1,children:i.jsx(L,{children:i.jsx(m,{children:i.jsx(h,{icon:p,iconColor:"blue",iconSize:"md",tooltip:"Field tracking",color:"blue",onClick:()=>{var e,i;let t=[...this.state.deviceList],l={appName:null==(e=t[s].mobileApp)?void 0:e.appName,appId:null==(i=t[s].mobileApp)?void 0:i.appGuid,deviceType:t[s].deviceType,mode:"add"};if(this.setState({fieldTrackData:l}),null!==this.state.deviceList[0].deviceType&&null!==this.state.deviceList[0].mobileApp)this.setState({isFieldTrack:!0});else{let e=null===this.state.deviceList[0].deviceType?"Select device":null,s=null===this.state.deviceList[0].mobileApp?"Select mobile app":null,i=[...this.state.deviceList];i[0].error.errDeviceType=e,i[0].error.errMobileApp=s,this.setState({deviceList:i})}}})})})})]})})]}),this.state.deviceList[s].fieldList.length>0&&i.jsxs(S,{children:[i.jsx(A,{md:3}),i.jsx(A,{md:6,children:i.jsx(this.AddFormEvents,{index:s})})]})]})})})]})})})})),this.state.deviceList.length<5?i.jsx("div",{className:"pos-icon-2 d-none",children:i.jsx(v,{text:"Add",position:"top",children:i.jsx("i",{className:"icon-rs-circle-plus-fill-edge-medium icons-md color-primary-blue cursor-pointer icon-shadow "+(5===this.state.deviceList?"click-off":""),onClick:()=>{this.addBtnClick()}})})}):null]}),i.jsxs("div",{className:"btn-container d-flex justify-content-end marginT30",children:[i.jsx(d,{onClick:()=>{},children:"Cancel"}),i.jsx(o,{className:this.state.deviceList[0].fieldList.length>0?"":"click-off",onClick:()=>{this.setState({showFormNameComponent:!0})},children:"Save"})]})]})})]})}}s(I,"contextType",r);const K=l(I);var E;class P extends a.Component{constructor(){super(...arguments),s(this,"state",{formName:"",platformName:"",formpageUrl:"",lSocket:null,isSocketConnect:!1,errorMessage:"",fieldTrackClose:null,fieldTrackWait:null,fieldTrackSuccess:null}),s(this,"socketClosed",(()=>{E.on("closed",(e=>{try{e.status}catch(s){}}))})),s(this,"socketInit",(e=>{const s=io("https://mobsoc.resu.io/");this.setState({lSocket:s},(()=>{this.state.lSocket.on("connect",(()=>{E.emit("new_user",{userName:"platform",domainName:e,appId:14441}),this.socketClosed()}))}))})),s(this,"formNameCheck",(e=>{u({path:x,params:{formName:e},ok:e=>{e.status&&this.setState({errorMessage:null==e?void 0:e.message})},fail:e=>{}})})),s(this,"getContentData",(()=>{let e="";return this.state.fieldTrackWait?e="Waiting for event set":this.state.fieldTrackData?e="Client closed unexpected":this.state.fieldTrackSuccess&&(e="Field tracking enabled successfully"),e}))}componentDidMount(){var e,s;const i=B.parse(null==(s=null==(e=this.props.history)?void 0:e.location)?void 0:s.search);"true"===(void 0!==i.webft&&i.webft)&&this.setState({isWebFieldTrack:!0,platformName:"Web"})}render(){return i.jsxs(t,{children:[this.state.isWebFieldTrack&&i.jsx(i.Fragment,{children:i.jsxs(F,{fullscreen:!0,show:this.state.isWebFieldTrack,children:[i.jsxs(F.Header,{children:[i.jsx("h2",{children:"Field tracking"}),i.jsx(k,{mainClass:"close",size:"md",handleClose:()=>{this.setState({isWebFieldTrack:!1})}})]}),i.jsx(F.Body,{children:i.jsx(W,{isForm:!0,isWebFieldTrack:this.state.isWebFieldTrack,fieldTrackData:this.state.fieldTrackData,domainName:e=>{this.socketInit(e)},cancelBtnClicked:()=>{this.setState({isWebFieldTrack:!1})},saveBtnClicked:e=>{this.setState({fieldTrackData:e,isWebFieldTrack:!1})}})})]})}),this.getContentData().length>1&&i.jsx(R,{content:this.getContentData(),isShowBtn:!0,proceedBtnClick:()=>{this.setState({fieldTrackWait:!1,fieldTrackSucess:!1,fieldTrackClose:!1})}}),i.jsx(M,{fluid:!0,className:"main-heading-wrapper mb0",children:i.jsxs(M,{className:"mhw-container",children:[i.jsx("div",{className:"mhwc-left",children:i.jsx("h1",{children:i.jsx("div",{className:"mh-wrapper",children:i.jsx("span",{className:"mh-text",children:"Custom event"})})})}),i.jsx("div",{className:"mhwc-right",children:i.jsxs("div",{className:"back-text",onClick:()=>{sessionStorage.removeItem("AppNameTracking"),this.props.history.push("communication-settings")},children:[i.jsx(h,{icon:j,size:"sm"}),"Back"]})})]})}),i.jsx(M,{className:"page-header",children:i.jsx(M,{children:i.jsx("div",{className:"portlet-box-theme bgWhite padding10",children:i.jsxs(M,{children:[i.jsx(g,{className:"mt20 mb30",children:i.jsxs(S,{children:[i.jsx(A,{md:3,children:i.jsx(C,{label:"Platform",right:!0})}),i.jsx(A,{md:5,children:i.jsx(y,{val:"Mobile",disabled:!0})})]})}),i.jsx(i.Fragment,{children:i.jsx(S,{children:i.jsx(A,{md:{offset:2,span:9},children:i.jsx(K,{})})})})]})})})}),i.jsx(M,{})]})}}const _=l(P);export{_ as default};

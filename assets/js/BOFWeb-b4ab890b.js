var e,t,s,i,a,l,r,n=Object.defineProperty,o=(e,t,s)=>(((e,t,s)=>{t in e?n(e,t,{enumerable:!0,configurable:!0,writable:!0,value:s}):e[t]=s})(e,"symbol"!=typeof t?t+"":t,s),s);import{j as d}from"./pdf-editor-8270ab34.js";import{w as c,r as m}from"./react-vendor-379f659a.js";import{z as h,a0 as p,az as u,ar as j,CW as f,B as x,E as v,dI as k,dL as g,qx as b,dk as C,dj as N}from"./index-74701706.js";import{q as w}from"./utils-16c7e021.js";import{s as F,c as T}from"./BOFController-f105b6f3.js";import{R as y}from"./RSIcon-70da13ba.js";import"./RSKendoDropdown-01650470.js";import{R as S}from"./RSCheckbox-2fef59cb.js";import"./style-a86a43a5.js";import{R as D}from"./RSFormGroup-183a553e.js";import"./RSDropdowns-57ad4a66.js";import{F as U}from"./FormLabel-e5a81960.js";import{F as A}from"./FormFieldIcon-f423e4de.js";import{K as E}from"./index-21f205f2.js";import{R as I,a as W,M as L}from"./ui-e848d714.js";var R,z=null;class B extends m.Component{constructor(){super(...arguments),o(this,"state",{webUrl:(null==(e=this.props)?void 0:e.webUrl)||"https://",initialWebUrl:null,errWebUrl:null,formName:null==(t=this.props)?void 0:t.formName,fieldTrackData:(null==(i=null==(s=this.props)?void 0:s.fullData)?void 0:i.elementArray)||[],fieldTrackClose:null,fieldTrackWait:null,fieldTrackSuccess:null,showFormNameComponent:!1,showFieldTrackError:!1,errFormName:null,validateWebSite:(null==(l=null==(a=this.props)?void 0:a.webUrl)?void 0:l.length)>0,isLoading:!1,isIcon:!1,fieldData:(null==(r=this.props)?void 0:r.fullData)||{elementArray:[],controlArray:[],pageUrl:"",imageData:null}}),o(this,"fieldTrackClicked",(()=>{var e,t;const s=w.parse(null==(t=null==(e=this.props.history)?void 0:e.location)?void 0:t.search);let i=void 0!==s.cId?s.cId:0;(R=window.io.connect("https://mobsoc.resu.io/",{reconnection:!0})).on("connect",(()=>{R.emit("new_user",{userName:"platform",domainName:this.state.webUrl,appId:parseInt(i)})})),R.on("closed",(e=>{try{if(z.close(),e.status){if(this.setState({fieldTrackWait:!1}),localStorage.getItem("ea")){let e=p(localStorage.getItem("ea")),t={elementArray:e.elementArray,controlArray:e.controlsArray,pageUrl:e.currentActivity,imageData:null==e?void 0:e.imageData};this.setState({fieldTrackData:t.elementArray,socketEnabled:!0,fieldData:t}),this.props.socketChange(!1,!0,!1)}}else this.setState({socketEnabled:!1}),this.props.socketChange(!1,!1,!0)}catch(t){}})),this.props.socketChange(!0,!1,!1),localStorage.setItem("fdomain",this.state.webUrl);let a=window.location.pathname+window.location.search+"&webft=true&bofadd=true",l=btoa(i);z=window.open(`${this.state.webUrl}?_sdxFormId=${l}&path=${a}`)})),o(this,"AddFormEvents",(e=>{var t,s;const i=w.parse(null==(s=null==(t=this.props.history)?void 0:t.location)?void 0:s.search);return void 0!==i.isEdit&&i.isEdit,d.jsxs(I,{children:[d.jsx(W,{md:3,children:d.jsxs("div",{className:"align-items-center justify-content-end d-flex mb10 mt40",children:[d.jsx("i",{className:"icon-rs-events-mini icon-sm color-primary-blue padding-R5"}),d.jsx("h4",{className:"mb-0 padding-L5 mr15",style:{paddingLeft:5},children:"Form fields"})]})}),d.jsx(W,{md:5,children:this.state.fieldTrackData.map(((e,t)=>d.jsxs("div",{className:"event-tracking-list",children:[d.jsxs("div",{className:"event-actions mr20",children:[!0===e.eventTracking.markAsGoal&&d.jsx("span",{children:d.jsx("i",{className:"icon-rs-goal-achieved-medium icons-md blue"})}),d.jsx("span",{children:d.jsx("i",{className:!0===e.eventTracking.mandadory?"icon-rs-asterisk-mini red icons-sm mand-field cursor-pointer":"icon-rs-asterisk-mini icons-sm mand-field cursor-pointer",onClick:()=>{}})}),d.jsx("span",{children:d.jsx("i",{className:"icon-rs-delete-medium icons-md color-primary-blue cursor-pointer",onClick:()=>{let t=[...this.state.fieldTrackData];const s=t.indexOf(e);s>-1&&t.splice(s,1);let i={...this.state.fieldData};i.elementArray=t,this.setState({fieldTrackData:t,fieldData:i})}})})]}),d.jsxs("div",{className:"event-section",children:[d.jsxs("div",{className:"event-row",children:[d.jsx("span",{className:"label-field",children:"Friendly name:"}),d.jsx("span",{className:"label-value",children:e.eventTracking.friendlyName})]}),d.jsxs("div",{className:"event-row",children:[d.jsx("span",{className:"label-field",children:"Attribute name:"}),d.jsx("span",{className:"label-value",children:e.eventTracking.trackingType.displayName})]})]})]})))})]})})),o(this,"FriendlyNameCell",(e=>{var t,s;let i=(null==(s=null==(t=null==e?void 0:e.dataItem)?void 0:t.eventTracking)?void 0:s.friendlyName)||"";return d.jsx("td",{children:i})})),o(this,"TrackingActionCell",(e=>{var t,s,i;let a=(null==(i=null==(s=null==(t=null==e?void 0:e.dataItem)?void 0:t.eventTracking)?void 0:s.trackingType)?void 0:i.displayName)||"";return d.jsx("td",{children:a})})),o(this,"ActionCell",(e=>{var t,s,i,a;let l=(null==(s=null==(t=null==e?void 0:e.dataItem)?void 0:t.eventTracking)?void 0:s.markAsGoal)||!1,r=(null==(a=null==(i=null==e?void 0:e.dataItem)?void 0:i.eventTracking)?void 0:a.mandadory)||!1;return d.jsx(d.Fragment,{children:d.jsx("td",{children:d.jsxs(u,{className:"float-end",children:[!0===l&&d.jsx(j,{tooltip:"Marked as submit",icon:"icon-rs-goal-achieved-mini icons-sm blue",size:"sm",iconClass:"",mainClass:"",onClick:()=>{}}),d.jsx(j,{tooltip:"Mandatory",icon:!0===r?"icon-rs-asterisk-mini red icons-sm":"icon-rs-asterisk-mini icons-sm",size:"sm",iconClass:"",mainClass:"",onClick:()=>{}}),d.jsx(j,{tooltip:"Delete",icon:"icon-rs-delete-mini",size:"sm",iconClass:"",mainClass:l||r?"click-off":"click-on",onClick:()=>{let t=[...this.state.fieldTrackData];const s=null==e?void 0:e.dataIndex;s>-1&&t.splice(s,1);let i={...this.state.fieldData};i.elementArray=t,this.setState({fieldTrackData:t,fieldData:i})}})]})})})})),o(this,"AddFormEvents1",(e=>{var t,s,i;const a=w.parse(null==(s=null==(t=this.props.history)?void 0:t.location)?void 0:s.search);return void 0!==a.isEdit&&a.isEdit,d.jsx(I,{children:d.jsx(W,{md:12,children:d.jsx(E,{config:{take:5,skip:0},data:this.state.fieldTrackData,settings:{total:null==(i=this.state.fieldTrackData)?void 0:i.length},isDataStateRequired:!1,pageable:!1,column:[{field:"Friendly name",title:"Friendly name",cell:this.FriendlyNameCell},{field:"userName",title:"Attribute name",cell:this.TrackingActionCell},{field:"Action",title:"Action",cell:this.ActionCell}]})})})})),o(this,"ShowFormNameComponent",(()=>d.jsx(d.Fragment,{children:this.state.showFormNameComponent&&d.jsxs(L,{show:this.state.showFormNameComponent,centered:!0,size:"md",children:[d.jsxs(L.Header,{children:[d.jsx("h2",{children:"Brand owned form"}),d.jsx(y,{mainClass:"close",size:"md",handleClose:()=>{this.setState({showFormNameComponent:!1})}})]}),d.jsx(L.Body,{children:d.jsx(D,{children:d.jsxs(I,{children:[d.jsx(W,{md:4,children:d.jsx(U,{label:"Form name"})}),d.jsx(W,{md:8,children:d.jsx(S,{required:!0,className:"required",placeholder:0===this.state.formName.length?"Enter form name":"Form name",val:this.state.formName,errorMessage:this.state.errFormName,maxLength:30,cb:e=>{let t=0===e.length?f:null;this.setState({formName:e,errFormName:t})},ob:e=>{let t=0===e.length?f:null;this.setState({formName:e,errFormName:t})}})})]})})}),d.jsxs("div",{className:"d-flex justify-content-end",children:[d.jsx(x,{onClick:()=>{this.setState({showFormNameComponent:!1})},children:"Cancel"}),d.jsx(v,{onClick:()=>{let e={formName:this.state.formName,controls:this.state.fieldTrackData,deviceType:"Web",domainName:this.state.webUrl,fullData:this.state.fieldData};F(e,this.context,"web",(e=>{e.status?this.props.history.push("form-generator"):this.setState({errFormName:null==e?void 0:e.message})}))},children:"Save"})]})]})}))),o(this,"FieldTrackDataError",(()=>d.jsx(d.Fragment,{children:this.state.showFieldTrackError&&d.jsxs(L,{show:this.state.showFieldTrackError,centered:!0,size:"md",children:[d.jsxs(L.Header,{children:[d.jsx("h2",{children:"Brand owned form"}),d.jsx(y,{mainClass:"close",size:"md",handleClose:()=>{this.setState({showFieldTrackError:!1})}})]}),d.jsx(L.Body,{children:d.jsx("p",{children:"Add tracked field"})}),d.jsx("div",{className:"d-flex justify-content-end",children:d.jsx(x,{onClick:()=>{this.setState({showFieldTrackError:!1})},children:"Cancel"})})]})}))),o(this,"validateDomain",(e=>{k(e)?(this.setState({isLoading:!0}),T(e,(e=>{e.status?this.setState({validateWebSite:!0,isLoading:!1,isIcon:!0}):this.setState({errWebUrl:e.message,isLoading:!1,isIcon:!1,validateWebSite:!1})}))):this.setState({errWebUrl:g,isLoading:!1,isIcon:!1,validateWebSite:!1})})),o(this,"getOnchangeValue",(e=>{let t=e.trim(),s=t.length>0?null:g;this.setState({webUrl:t,errWebUrl:s})}))}componentDidMount(){}componentDidUpdate(e){var t;this.props!==e&&this.setState({formName:null==(t=this.props)?void 0:t.formName})}render(){return d.jsxs(d.Fragment,{children:[this.state.showFormNameComponent&&d.jsx(this.ShowFormNameComponent,{}),this.state.showFieldTrackError&&d.jsx(this.FieldTrackDataError,{}),d.jsx(D,{children:d.jsxs(I,{children:[d.jsx(W,{md:3,children:d.jsx(U,{label:"Brand form page URL",right:!0})}),d.jsx(W,{md:5,children:d.jsx(S,{required:!0,placeholder:this.state.webUrl.length>0?"Page URL":"Enter form page url",val:this.state.webUrl,errorMessage:this.state.errWebUrl,iconPlaceholder:!0,isLoading:this.state.isLoading,iconName:this.state.isIcon?"icon-rs-circle-tick-medium icons-md green paddingL15":"",handleOnchange:e=>{this.getOnchangeValue(e)},handleOnBlur:e=>{let t=e,s=e.slice(0,8);s.includes("https://")||(t="https://"+e),s.includes("http://")&&(t=e.replace("http://","https://"));let i=t.length>0?null:g;this.setState({webUrl:t,errWebUrl:i,isIcon:!1}),null===i&&this.validateDomain(t)},onFocus:()=>{let e=this.state.webUrl;e.startsWith("https://")&&(e=e.replace("https://","")),this.setState({webUrl:e})}})}),null!==this.state.fieldTrackData&&this.state.fieldTrackData.length>0?d.jsx(W,{md:2,children:d.jsx(A,{children:d.jsxs(u,{children:[!0===window.location.search.includes("isEdit")&&d.jsx(j,{icon:b,iconColor:"blue",iconSize:"md",tooltip:"Edit",color:"blue",onClick:()=>{var e;null==(e=this.props)||e.editBtnClick()}}),d.jsx(j,{icon:C,iconColor:"blue",iconSize:"md",tooltip:"Reset",color:"blue",onClick:()=>{this.setState({fieldTrackData:[]})}})]})})}):d.jsx(d.Fragment,{children:!0===this.state.validateWebSite&&this.state.webUrl.length>0&&d.jsx(W,{md:2,children:d.jsx(A,{children:d.jsx(u,{children:d.jsx(j,{icon:N,iconColor:"blue",iconSize:"md",tooltip:"Field tracking",color:"blue",onClick:()=>{this.fieldTrackClicked()}})})})})})]})}),null!==this.state.fieldTrackData&&this.state.fieldTrackData.length>0&&d.jsx(I,{md:12,children:d.jsx(W,{children:d.jsx(this.AddFormEvents1,{})})}),d.jsxs("div",{className:"btn-container d-flex justify-content-end marginT30",children:[d.jsx(x,{onClick:()=>{this.props.history.push("form-generator")},children:"Cancel"}),d.jsx(v,{onClick:()=>{null!==this.state.fieldTrackData&&0!==this.state.fieldTrackData.length?this.setState({showFormNameComponent:!0}):this.setState({showFieldTrackError:!0})},children:"Save"})]})]})}}o(B,"contextType",h);const O=c(B);export{O as B};

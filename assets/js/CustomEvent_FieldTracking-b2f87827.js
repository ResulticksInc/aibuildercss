var e,t,i,s,a,n,l,r=Object.defineProperty,o=(e,t,i)=>(((e,t,i)=>{t in e?r(e,t,{enumerable:!0,configurable:!0,writable:!0,value:i}):e[t]=i})(e,"symbol"!=typeof t?t+"":t,i),i);import{j as c}from"./pdf-editor-e8cb7a76.js";import{z as d,M as h,BD as m,F as v,BF as p,BB as u,BC as g,BG as k,B as f,E as y,dd as T,aa as N}from"./index-23a09c37.js";import{RSConfirmAlert as w}from"./RSConfirmAlert-1017f59d.js";import{q as S}from"./utils-16c7e021.js";import"./Features.styled-606ffe3c.js";import{w as x,r as b,R as j}from"./react-vendor-379f659a.js";import{c as A,f as D,s as I,S as E,A as C,i as F}from"./FieldTracking-34b186e0.js";import{M as O}from"./index-cbd12d4f.js";import"./RSDropdowns-e011803c.js";import{R as M}from"./RSKendoDropdown-32d89038.js";import{R as G,a as L}from"./RSCheckbox-b4d531b7.js";import"./style-a86a43a5.js";import{R as W}from"./RSFormGroup-ffdfb1d7.js";import{m as B}from"./BOFController-d5d49f34.js";import{R as J,a as P}from"./ui-f7791cf3.js";import"./LayoutPageWrapper-ab434993.js";class R extends b.Component{constructor(){super(...arguments),o(this,"state",{friendlyName:"",eventName:(null==(t=null==(e=this.props)?void 0:e.element)?void 0:t.eventName)?null==(s=null==(i=this.props)?void 0:i.element)?void 0:s.eventName:"",copyEventName:"",eventType:null==(n=null==(a=this.props)?void 0:a.element)?void 0:n.category,eventDescription:"",errEvent:null,errEventType:null,errDescription:null,markAsGoal:!1,markAsGoalClickOff:!1,trackingTypeData:["Value","Length"],trackingType:null,errTrackingType:null,selectInputTypeData:["Text & Number","Number","Date & Time","Yes / No"],selectInputType:"",errInputType:null,attributeNameList:[],mandadory:!0,editModeOn:null==(l=this.props)?void 0:l.editModeOn,eventNameCondition:1==this.props.editModeOn,mobxDataCheck:null,toggleEnterEvent:null}),o(this,"componentDidMount",(e=>{this.getAttributeDataNew()})),o(this,"getAttributeDataNew",(()=>{h({path:m,sessionOut:this.context.globalStateData.setSessionOutData,loading:this.context.globalStateData.setIsLoadingData,ok:e=>{if(e.status){const t=e.data;this.setState({attributeNameList:t.filter((e=>"EmailID"!==e.attributeName))})}},fail:e=>{}})})),o(this,"componentDidUpdate",(e=>{var t,i,s,a,n,l;(null==(i=null==(t=this.props)?void 0:t.element)?void 0:i.eventName)!==(null==(s=null==e?void 0:e.element)?void 0:s.eventName)&&this.setState({eventName:null==(n=null==(a=this.props)?void 0:a.element)?void 0:n.eventName,copyEventName:[null==(l=null==e?void 0:e.element)?void 0:l.eventName,this.state.copyEventName]})})),o(this,"validateAddEvent",(()=>v(this.state.eventName)?(this.setState({errEvent:"Enter Event name"}),!1):!(null==this.props.fieldTrackName&&null===this.state.trackingType||null==this.props.fieldTrackName&&void 0===this.state.trackingType)||(this.setState({errTrackingType:p}),!1))),o(this,"addBtnClick",(()=>{var e,t;if(this.state.trackingType,this.state.eventName.length>0&&this.validateAddEvent()){let i=this.state.trackingType;this.props.callback({eventName:this.state.eventName,eventType:this.state.eventType,eventDescription:this.state.eventDescription,markAsGoal:this.state.markAsGoal,trackingType:i,mandadory:this.state.mandadory,editedValue:this.state.copyEventName}),this.setState({eventName:"",eventType:null==(t=null==(e=this.props)?void 0:e.element)?void 0:t.category,eventDescription:"",markAsGoal:!1,trackingType:null,selectInputType:"",mandatory:!1}),this.props.editedValue({editedValue:this.state.eventName})}})),o(this,"setFrientlyName",(e=>{e.length,this.setState({eventName:e,copyEventName:e,editModeOn:!1,errEvent:null}),null!=this.props.fieldTrackName&&this.setState({markAsGoal:!0})})),o(this,"setDescription",(e=>{let t=e.length>0?null:g;this.setState({eventDescription:e,errDescription:t})}))}render(){var e,t,i,s,a;let n=0;const l=S.parse(window.location.search);return n="true"===((null==l?void 0:l.webft)||!1)?A(null==(t=null==(e=this.props)?void 0:e.element)?void 0:t.tagtype)||0:A(null==(s=null==(i=this.props)?void 0:i.element)?void 0:s.category)||0,c.jsx(c.Fragment,{children:c.jsxs("div",{className:"marginT10",children:[c.jsx(W,{children:c.jsx(J,{children:c.jsx(P,{md:12,children:c.jsxs("div",{className:"d-flex align-items-center",children:[c.jsx("i",{className:"icon-rs-add-events-large icon-lg  color-primary-blue"}),c.jsxs("h4",{className:"mb0 ml10 color-primary-blue",children:[" ",null!=this.props.fieldTrackName?"Add Custom Event":"Add form element"," "]})]})})})}),c.jsxs("div",{className:null===(null==(a=this.props)?void 0:a.element)?"boxed click-off":"boxed",children:[c.jsx(W,{children:c.jsx(J,{children:c.jsx(P,{md:12,className:"mt5",children:c.jsx(G,{required:!0,placeholder:null!=this.props.fieldTrackName?"Enter Event Name":k,val:this.state.eventName,iconPlaceholder:!0,max:50,handleOnchange:e=>{this.setFrientlyName(e)},handleOnBlur:e=>{this.setFrientlyName(e)},errorMessage:this.state.errEvent})})})}),null==this.props.fieldTrackName?c.jsx(W,{children:c.jsx(J,{children:c.jsx(P,{md:12,children:c.jsx(M,{required:!0,label:null!==this.state.trackingType?"Attributte":"Select attributte",data:this.state.attributeNameList,textField:"attributeName",dataItemKey:"dataAttributeID",errorMessage:this.state.errTrackingType,value:null!==this.state.trackingType?this.state.trackingType:{attributeName:p,dataAttributeID:0},onChange:e=>{this.setState({trackingType:e.target.value,errTrackingType:null})}})})})}):null,c.jsx(W,{children:c.jsx(J,{children:c.jsx(P,{md:12,children:c.jsx(G,{required:!0,className:"",disabled:!0,placeholder:"Element type",val:1===n?"Input":"Click"})})})}),c.jsxs(J,{children:[null==this.props.fieldTrackName?c.jsx(P,{sm:3,children:c.jsx("div",{className:!0===this.state.markAsGoalClickOff?"click-off":"click-on d-flex justify-content-between align-items-center marginT15",children:c.jsx(L,{className:"font-sm pad-top",checked:this.state.markAsGoal,lbl:"Mark as submit",cb:e=>{this.setState({markAsGoal:e})}})})}):null,c.jsx(P,{sm:9,children:c.jsxs("div",{className:"d-flex justify-content-end mar-top",children:[c.jsx(f,{onClick:()=>{this.setState({eventName:"",eventDescription:"",markAsGoal:!1,mandadory:!1})},children:"Cancel"}),c.jsx(y,{onClick:()=>this.addBtnClick(),children:!0===this.props.editModeOn?"Update":"Add"})]})})]})]})]})})}}o(R,"contextType",d);const $=x(R);var q;class V extends b.Component{constructor(){super(...arguments),o(this,"state",{formName:"",platformName:"",formpageUrl:"",authCode:"",showAuthCode:!1,currentActivity:"",currentImg:null,imageData:null,clientData:null,controlsArray:[],getControlsArray:[],selectElement:null,elementArray:[],screenTracking:{minDuration:"",screenTrackCond:"And",minLength:""},errScreenTracking:{errMinDuration:null,errMinLength:null},event:{eventName:"",eventType:"",eventDescription:""},errEvent:{errEventName:null,errEventType:null,errEventDescription:null},selectControls:[],markAsGoal:!1,deviceInformation:null,editModeOn:!1,editIndex:null}),o(this,"selfClose",!1),o(this,"socketDisconnect",(()=>{q.off("receiver-handshake-response"),q.off("client-information"),q.off("message-from-client-image"),q.off("message-from-client-data"),q.off("receiver-handshake-response"),q.off("show-auth-code"),q.disconnect()})),o(this,"getFieldTrackData",(()=>{var e,t,i,s,a,n,l="iOS";null==(e=this.props.fieldTrackData)||e.appId;var r="iPhone";(null==(i=null==(t=this.props.fieldTrackData)?void 0:t.deviceType)?void 0:i.toLowerCase().includes("an"))&&(l="Android",r=null==(s=this.props.fieldTrackData)?void 0:s.deviceType);const o=S.parse(null==(n=null==(a=this.props.history)?void 0:a.location)?void 0:n.search);let c=void 0!==o.cId?o.cId:0;h({path:T,params:{campaignId:c,deviceOs:l,deviceType:r,goalType:"P"},ok:e=>{var t,i,s,a;(null==e?void 0:e.status)&&(null==(i=null==(t=null==e?void 0:e.data)?void 0:t.capturedFields)?void 0:i.length)>0&&(null==(a=null==(s=null==e?void 0:e.data)?void 0:s.capturedFields)||a.map((e=>{var t,i;let s=JSON.parse(e.formFieldsToCapture),a=s.imageData;null!=a&&this.setState({currentImg:a.imageData,imageData:a});let n=null==(t=s.fieldsInfo)?void 0:t.pageContent.controls;if(null!=n){this.setState({showAuthCode:!1,clientData:n,controlsArray:n});let e=null==(i=null==s?void 0:s.fieldsInfo)?void 0:i.fieldCaptureList,t=[],a={minDuration:"",screenTrackCond:"And",minLength:""},l={};e.length>0&&e.map((e=>{a.minDuration=e.minDuration,a.screenTrackCond=null==e?void 0:e.screenfilter,a.minLength=e.minLength,l={eventName:e.eventName,eventType:e.captureType,eventDescription:e.description,markAsGoal:e.markAsGoal,trackingType:e.captureType},e.screenName,e.viewType;let i={field:e,screenTracking:a,eventTracking:l};t.push(i)})),!0===(null==l?void 0:l.markAsGoal)&&this.setState({markAsGoal:!0}),this.setState({elementArray:t,screenTracking:a})}})))},fail:e=>{}})})),o(this,"socketInit",(()=>{var e,t,i,s,a={userName:"Browser"},n="iOS",l=null==(e=this.props.fieldTrackData)?void 0:e.appId,r="iPhone";(null==(i=null==(t=this.props.fieldTrackData)?void 0:t.deviceType)?void 0:i.toLowerCase().includes("an"))&&(n="Android",r=null==(s=this.props.fieldTrackData)?void 0:s.deviceType),a.appId=String(n+r+l).replace(/ /g,"");let o=B.setConnectSocket();q=o,JSON.stringify(a),q.on("connect",(()=>{q.emit("receiver-handshake-request",a)})),q.on("receiver-handshake-response",(e=>{})),q.on("client-handshake-response",(e=>{})),q.on("client-handshake-request",(e=>{})),q.on("client-information",(e=>{})),q.on("disconnect",(e=>{})),q.on("message-client-disconnect",(e=>{})),q.on("message-from-client-image",(e=>{if(this.state.elementArray.length>0)return;q.off("show-auth-code"),this.setState({showAuthCode:!1});let t=JSON.parse(e);this.setState({currentActivity:t.screenName,currentImg:t.imageData,imageData:t}),this.state.currentActivity!==t.screenName&&this.setState({currentActivity:t.screenName,currentImg:t.imageData,imageData:t})})),q.on("message-from-client-data",(e=>{q.off("show-auth-code");let t=JSON.parse(e),i=JSON.parse(t.controls);this.state.selectControls.map((e=>{i.map((t=>{e.viewId===t.viewId&&(t.click=!0,t.select=(null==e?void 0:e.select)||!1)}))})),i.map((e=>{var t;let i=[];(null==(t=e.subviews)?void 0:t.length)>0&&JSON.parse(e.subviews).length>0&&(i=JSON.parse(e.subviews)),e.subviews=i})),this.setState({showAuthCode:!1,clientData:t,controlsArray:i})})),q.on("show-auth-code",(e=>{let t=JSON.parse(e);this.setState({authCode:t.oAuthCode,showAuthCode:!1,deviceInformation:t}),q.off("show-auth-code")})),q.on("client-auth-code",(e=>{let t=JSON.parse(e);this.setState({authCode:t.oAuthCode,showAuthCode:!0});var i=new Object;i.appId=String(n+r+l).replace(/ /g,"");var s=JSON.stringify(i);q.emit("marketer-acceptance-message",s),setTimeout((()=>{this.setState({authCode:"",showAuthCode:!1})}),12e4)}))})),o(this,"webSocketInit",(()=>{var e,t;let i=localStorage.getItem("fdomain")||"",s=new URL(i),a=(null==s?void 0:s.origin)||"";const n=S.parse(null==(t=null==(e=this.props.history)?void 0:e.location)?void 0:t.search);let l=void 0!==n.cId?n.cId:0;(q=window.io.connect("https://mobsoc.resu.io/",{reconnection:!0})).on("connect",(()=>{q.emit("new_user",{userName:"fieldtrack",domainName:a,appId:parseInt(l)})})),q.on("closed",(e=>{try{(void 0).close(),e.status}catch(t){}})),q.on("data_post",(e=>{var t,i,s;if(this.context.globalStateData.setIsLoadingData(!1),this.state.controlsArray.length>0)return;let a={imageData:null==(t=null==e?void 0:e.data)?void 0:t.PageScreenShot,width:(null==(i=e.data)?void 0:i.Width)||0,height:(null==(s=e.data)?void 0:s.Height)||0};this.setState({currentActivity:e.domainName,currentImg:a.imageData,imageData:a}),e.data.PageContentJson.map(((e,t)=>{e.id=t+1,e.viewId=t+1,e.isShow=!0,e.category=e.tagname})),this.setState({controlsArray:e.data.PageContentJson})})),q.on("data_receive",(e=>{var t,i,s,a;if(this.state.controlsArray.length>0)return;let n={imageData:(null==(t=null==e?void 0:e.data)?void 0:t.PageScreenShot)||(null==(i=null==e?void 0:e.data)?void 0:i.image),width:(null==(s=e.data)?void 0:s.Width)||0,height:(null==(a=e.data)?void 0:a.Height)||0};this.setState({currentActivity:e.domainName,currentImg:n.imageData,imageData:n}),e.data.PageContentJson.map(((e,t)=>{e.id=t+1,e.viewId=t+1,e.isShow=!0,e.category=e.tagname})),this.setState({controlsArray:e.data.PageContentJson})}))})),o(this,"webSocketClosed",(()=>{var e,t;const i=S.parse(null==(t=null==(e=this.props.history)?void 0:e.location)?void 0:t.search);let s=void 0!==i.cId?i.cId:0,a=localStorage.getItem("fdomain")||"";this.selfClose=!0,q.emit("close",{userName:"fieldtrack",domainName:a,appId:parseInt(s),status:!0}),q.emit("closed",{userName:"fieldtrack",domainName:a,appId:parseInt(s),status:!1}),q.emit("close",{userName:"fieldtrack",domainName:a,appId:parseInt(s),status:!1}),setTimeout((()=>{window.close()}),1e3)})),o(this,"checkLocalStorage",(()=>{let e=F;if(null!==e&&this.setState({currentImg:e.imageData,imageData:e}),null!==D){let e=JSON.parse(D.controls);this.state.selectControls.map((t=>{e.map((e=>{t.viewId===e.viewId&&(e.click=!0,e.select=(null==t?void 0:t.select)||!1)}))})),0===this.state.controlsArray.length&&(e.map((e=>{var t;let i=[];(null==(t=e.subviews)?void 0:t.length)>0&&JSON.parse(e.subviews).length>0&&(i=JSON.parse(e.subviews)),e.subviews=i})),this.setState({showAuthCode:!1,clientData:D,controlsArray:e}))}})),o(this,"createField",(e=>e.map(((e,t)=>this.createSingleWebField(e,t))))),o(this,"createSingleMobileField",((e,t,i=!1)=>{var s,a,n=e.top+e.translationY-e.scrollY,l=e.left+e.translationX-e.scrollX,r=e.width,o=e.height,d="array"+e.id;if(null!==document.getElementById(d)){var h=document.getElementById(d);h.setAttribute("data-viewId",e.viewId),h.setAttribute("data-viewType",e.viewType)}return c.jsx("div",{className:`C ${!0===e.isShow&&"fieldTracking"} ${null==e?void 0:e.viewId} ${!0===(null==e?void 0:e.click)&&"fieldTrackingClick"} ${!0===(null==e?void 0:e.select)&&"fieldTrackingSelect"}`,id:e.id,data:e,style:{position:"absolute",top:n,left:l,width:r,height:o},onClick:t=>{if(!0===e.select)return;let i=[...this.state.controlsArray],s=t.target,a=null;i.map((e=>{e.click=!1}));let n=i.filter((e=>String(e.id)===s.id));if(!1===n[0].isShow)return;n[0].click=!0,a=n[0];let l=[...this.state.selectControls];l=l.filter((e=>!0===e.select)),l.push(n[0]),l=l.filter(((e,t,i)=>t===i.findIndex((t=>t.viewId===e.viewId&&t.viewId===e.viewId)))),this.setState({selectControls:l,controlsArray:i,selectElement:a,event:{eventName:"",eventType:"",eventDescription:""}})},children:!1===e.isShow&&(null==(s=e.subviews)?void 0:s.length)>0&&(null==(a=null==e?void 0:e.subviews)?void 0:a.map((e=>{let t=this.state.controlsArray.filter((t=>t.id.toString()===e.toString()));return t.length>0?t.map(((e,t)=>this.createSingleMobileField(e,t,i))):c.jsx("div",{id:`array${e.toString()}`,viewId:e.toString()})})))})})),o(this,"createSingleWebField",((e,t)=>{var i,s=e.top,a=e.left,n=e.width,l=e.height,r="array"+t;if(null!==document.getElementById(r)){var o=document.getElementById(r);o.setAttribute("data-viewId",e.viewId),o.setAttribute("data-viewType",e.viewType)}return c.jsx("div",{className:`C ${!0===e.isShow&&"fieldTracking"} ${null==e?void 0:e.viewId} ${!0===(null==e?void 0:e.click)&&"fieldTrackingClick"} ${!0===(null==e?void 0:e.select)&&"fieldTrackingSelect"}`,id:e.id,style:{position:"absolute",top:s,left:a,width:n,height:l},onClick:e=>{let t=[...this.state.controlsArray],i=e.target,s=null;t.map((e=>{e.click=!1}));let a=t.filter((e=>String(e.id)===i.id));a[0].click=!0,s=a[0];let n=[...this.state.selectControls];n=n.filter((e=>!0===e.select)),n.push(a[0]),n=n.filter(((e,t,i)=>t===i.findIndex((t=>t.viewId===e.viewId&&t.viewId===e.viewId)))),this.setState({selectControls:n,controlsArray:t,selectElement:s,event:{eventName:"",eventType:"",eventDescription:""}})},children:(null==(i=e.subviews)?void 0:i.length)>0&&JSON.parse(e.subviews).length>0&&JSON.parse(e.subviews).map((e=>{let t=this.state.controlsArray.filter((t=>t.id.toString()===e.toString()));return t.length>0?t.map(((e,t)=>this.createSingleWebField(e,e.id))):c.jsx("div",{id:`array${e.toString()}`,viewId:e.toString()})}))})})),o(this,"createWebField",(e=>e.map(((e,t)=>this.createSingleWebField(e,t))))),o(this,"validateEvents",(()=>{if(v(this.state.event.eventName)){let e={...this.state.errEvent};return e.errEventName="Enter event name",this.setState({errEvent:e}),!1}if(v(this.state.event.eventType)){let e={...this.state.errEvent};return e.eventType="Select Event",this.setState({errEvent:e}),!1}return!0})),o(this,"addBtnClick",(e=>{var t;if(5===this.state.elementArray.length){let e={...this.state.errEvent};return e.errEventName="Cannot add more than 5 elements",this.setState({errEvent:e}),void setTimeout((()=>{let e={...this.state.errEvent};e.errEventName=null,this.setState({errEvent:e})}),2e3)}if(this.validateEvents()){const s=S.parse(null==(t=window.location)?void 0:t.search);let a=(null==s?void 0:s.webft)||!1,n=[],l=[];if(this.state.elementArray.map((e=>{var t,i;let s="true"===a?null==(t=null==e?void 0:e.field)?void 0:t.tagtype:null==(i=null==e?void 0:e.field)?void 0:i.category,r=A(s);2===r?n.push(r):l.push(r)})),"Click"===e){if(n.length>1){let e={...this.state.errEvent};return e.errEventName="Cannot add more than 2 click events",this.setState({errEvent:e}),void setTimeout((()=>{let e={...this.state.errEvent};e.errEventName=null,this.setState({errEvent:e})}),2e3)}}else if(l.length>2){let e={...this.state.errEvent};return e.errEventName="Cannot add more than 3 text field",this.setState({errEvent:e}),void setTimeout((()=>{let e={...this.state.errEvent};e.errEventName=null,this.setState({errEvent:e})}),2e3)}let r=[...this.state.controlsArray],o={};r.map((e=>{e.viewId===this.state.selectElement.viewId&&(e.select=!0,o=e)}));let c=[...this.state.selectControls];c.map((e=>{e.viewId===this.state.selectElement.viewId&&(e.select=!0,e.click=!0,o=e)}));let d=[...this.state.elementArray],h={field:o,screenTracking:this.state.screenTracking,eventTracking:this.state.event};d.push(h);var i=!1;d.map((e=>{!0===e.eventTracking.markAsGoal&&(i=!0)})),this.setState({selectControls:c,elementArray:d,selectElement:null,markAsGoal:i})}})),o(this,"addFormData",(()=>{var e;if(5===this.state.elementArray.length){let e={...this.state.errEvent};return e.errEventName="Cannot add more than 5 elements",this.setState({errEvent:e}),void setTimeout((()=>{let e={...this.state.errEvent};e.errEventName=null,this.setState({errEvent:e})}),2e3)}{const i=S.parse(null==(e=window.location)?void 0:e.search);let s=(null==i?void 0:i.webft)||!1,a=[];if("true"===s?this.state.elementArray.map((e=>{var t;let i=A(null==(t=null==e?void 0:e.field)?void 0:t.tagtype);2===i&&a.push(i)})):this.state.elementArray.map((e=>{var t;let i=A(null==(t=null==e?void 0:e.field)?void 0:t.category);2===i&&a.push(i)})),a.length>1){let e={...this.state.errEvent};return e.errEventName="Cannot add more than 2 click events",this.setState({errEvent:e}),void setTimeout((()=>{let e={...this.state.errEvent};e.errEventName=null,this.setState({errEvent:e})}),2e3)}let n=[...this.state.controlsArray],l={};n.map((e=>{var t;e.viewId===(null==(t=this.state.selectElement)?void 0:t.viewId)&&(e.select=!0,l=e)}));let r=[...this.state.selectControls];r.map((e=>{var t;e.viewId===(null==(t=this.state.selectElement)?void 0:t.viewId)&&(e.select=!0,e.click=!0,l=e)}));let o=[...this.state.elementArray],c={field:l,screenTracking:this.state.screenTracking,eventTracking:this.state.event};o.push(c);var t=!1;o.map((e=>{!0===e.eventTracking.markAsGoal&&(t=!0)})),this.setState({selectControls:r,elementArray:o,selectElement:null,markAsGoal:t})}})),o(this,"updateFormData",(e=>{if(null!=e&&null!=this.state.editIndex){let t=[...this.state.elementArray];t[this.state.editIndex].eventTracking.eventName=e.editedValue,this.setState({elementArray:t})}})),o(this,"editField",(e=>{let t=[...this.state.elementArray];t[this.state.editIndex].eventTracking.eventName=e.eventName,t[this.state.editIndex].eventTracking.eventDescription=e.eventDescription,t[this.state.editIndex].eventTracking.selectInputType=e.selectInputType,t[this.state.editIndex].eventTracking.trackingType=e.trackingType,t[this.state.editIndex].eventTracking.markAsGoal=e.markAsGoal,this.setState({elementArray:t})})),o(this,"getDeviceType",(e=>{switch(e){case"Android phone":return c.jsx("div",{className:"andriod-wrapper",children:c.jsxs("div",{class:"andriod-mobile",children:[c.jsx("div",{class:"inner"}),c.jsx("div",{class:"overflow",children:c.jsx("div",{class:"shadow"})}),c.jsx("div",{class:"speaker"}),c.jsx("div",{class:"sensors"}),c.jsx("div",{class:"more-sensors"}),c.jsx("div",{class:"camera"})]})});case"iPhone":return c.jsxs("div",{class:"iphone-mobile",children:[c.jsx("div",{class:"top-bar"}),c.jsx("div",{class:"camera"}),c.jsx("div",{class:"sensor"}),c.jsx("div",{class:"speaker"}),c.jsx("div",{class:"screen"}),c.jsx("div",{class:"home"}),c.jsx("div",{class:"bottom-bar"})]})}})),o(this,"saveMobileFieldTracking",(()=>{var e,t,i,s;let a=!1,n=!1;if(this.state.elementArray.map((e=>{var t,i;(null==(t=null==e?void 0:e.eventTracking)?void 0:t.mandadory)&&(n=!0),a||(null==(i=null==e?void 0:e.eventTracking)?void 0:i.markAsGoal)&&(a=!0)})),!1===a){let e={...this.state.errEvent};return e.errEventName="Please set the mark as submit any one event",this.setState({errEvent:e}),document.querySelector(".modal-body").scrollTo({top:0,behavior:"smooth"}),void setTimeout((()=>{let e={...this.state.errEvent};e.errEventName=null,this.setState({errEvent:e})}),2e3)}if(!0===(null==(e=this.props)?void 0:e.isForm)&&!1===n){let e={...this.state.errEvent};return e.errEventName="Please set any one field is mandaroy",this.setState({errEvent:e}),void setTimeout((()=>{let e={...this.state.errEvent};e.errEventName=null,this.setState({errEvent:e})}),2e3)}if(!0===(null==(t=this.props)?void 0:t.isForm)){const e=S.parse(null==(s=null==(i=this.props.history)?void 0:i.location)?void 0:s.search);let t=void 0!==e.cId?e.cId:0;var l=window.location.protocol+"//"+window.location.host+window.location.pathname+"?cId="+t;if(window.history.pushState({path:l},"",l),this.props.isWebFieldTrack){let e=localStorage.getItem("fdomain")||"";this.selfClose=!0,q.emit("close",{userName:"fieldtrack",domainName:e,appId:parseInt(t),status:!0}),window.close()}localStorage.setItem("ea",N(this.state.elementArray)),this.props.saveBtnClicked(this.state.elementArray),this.props.getAllData(this.state)}else I(this.props,this.state,q,this.context,(()=>{var e,t,i;const s=S.parse(null==(t=null==(e=this.props.history)?void 0:e.location)?void 0:t.search);let a=void 0!==s.cId?s.cId:0;var n=window.location.protocol+"//"+window.location.host+window.location.pathname+"?cId="+a;if(window.history.pushState({path:n},"",n),this.props.isWebFieldTrack){let e=localStorage.getItem("fdomain")||"";this.selfClose=!0,q.emit("close",{userName:"fieldtrack",domainName:e,appId:parseInt(a),status:!0}),q.emit("closed",{userName:"fieldtrack",domainName:e,appId:parseInt(a),status:!1}),q.emit("close",{userName:"fieldtrack",domainName:e,appId:parseInt(a),status:!1}),setTimeout((()=>{window.close()}),3e3);const t=new CustomEvent("ftracksuccess",{detail:{message:"Hello from custom event!"}});window.dispatchEvent(t)}"add"===(null==(i=this.props.fieldTrackData)?void 0:i.mode)&&this.disconnectSocket(),this.props.saveBtnClicked()}))})),o(this,"AddMobileEvents",(()=>c.jsxs(J,{children:[c.jsxs("div",{className:"align-items-center d-flex mb10",children:[c.jsx("i",{className:"icon-rs-events-medium icons-md color-primary-blue"}),c.jsx("h4",{className:"mb-0 ml10",children:"Events"})]}),this.state.elementArray.length>0&&this.state.elementArray.map(((e,t)=>{var i,s;return c.jsxs("div",{className:"event-tracking-list d-flex",children:[c.jsxs("div",{className:"event-actions",children:[c.jsx("span",{children:c.jsx("i",{className:"icon-rs-pencil-edit-medium icons-md blue",onClick:()=>{var i,s;let a=this.state.controlsArray.filter((t=>t.viewId===e.field.viewId));a.length>0&&(a[0].eventName=e.eventTracking.eventName,a[0].selectInputType=e.eventTracking.selectInputType,a[0].eventDescription=null==(i=e.eventTracking)?void 0:i.eventDescription,a[0].trackingType=e.eventTracking.trackingType,a[0].markAsGoal=e.eventTracking.markAsGoal,(null==(s=null==e?void 0:e.eventTracking)?void 0:s.markAsGoal)&&this.setState({markAsGoal:!0}),this.setState({selectElement:a[0],editModeOn:!0,editIndex:t}))}})}),!0===e.eventTracking.markAsGoal&&c.jsx("span",{children:c.jsx("i",{className:"icon-rs-goal-achieved-medium icons-md blue"})}),c.jsx("span",{children:c.jsx("i",{className:"color-primary-blue cursor-pointer icon-rs-delete-medium icons-md",onClick:()=>{!0===e.eventTracking.markAsGoal&&this.setState({markAsGoal:!1});let t=[...this.state.elementArray];const i=t.indexOf(e);i>-1&&t.splice(i,1);let s=[...this.state.controlsArray];s.map((t=>{t.viewId===e.field.viewId&&(t.select=!1,t.click=!1)}));let a=[...this.state.selectControls];a.map((t=>{t.viewId===e.field.viewId&&(t.select=!1,t.click=!1)})),this.setState({elementArray:t,selectControls:a,controlsArray:s})}})})]}),c.jsxs("div",{className:"event-section",children:[c.jsxs("div",{className:"event-row",children:[c.jsx("span",{className:"label-field",children:"Name:"}),c.jsx("span",{className:"label-value truncate",children:e.eventTracking.eventName})]}),c.jsxs("div",{className:"event-row",children:[c.jsx("span",{className:"label-field",children:"Action:"}),c.jsx("span",{className:"label-value truncate",children:e.eventTracking.trackingType})]}),c.jsxs("div",{className:"event-row",children:[c.jsx("span",{className:"label-field",children:"Input type:"}),c.jsx("span",{className:"label-value truncate",children:"Click"!==e.eventTracking.trackingType?e.eventTracking.selectInputType:"Yes / No"})]}),(null==(s=null==(i=e.eventTracking)?void 0:i.eventDescription)?void 0:s.length)>0&&c.jsxs("div",{className:"event-row",children:[c.jsx("span",{className:"label-field",children:"Description:"}),c.jsx("span",{className:"label-value truncate",children:e.eventTracking.eventDescription})]})]})]})}))]}))),o(this,"AddFormEvents",(()=>c.jsxs(J,{children:[c.jsxs("div",{className:"align-items-center d-flex mb10",children:[c.jsx("i",{className:"icon-rs-events-mini icon-sm color-primary-blue padding-R5",style:{paddingRight:5}}),c.jsx("h4",{className:"mb-0",children:this.props.fieldTrackName?"Event":"Form fields "})]}),this.state.elementArray.length>0&&this.state.elementArray.map(((e,t)=>{var i,s;return c.jsxs("div",{className:"event-tracking-list",children:[c.jsxs("div",{className:"DK-event-actions1",children:[c.jsx("span",{children:c.jsx("i",{className:"icon-rs-pencil-edit-medium icons-md blue",onClick:()=>{var i,s;let a=this.state.controlsArray.filter((t=>t.viewId===e.field.viewId));a.length>0&&(a[0].eventName=e.eventTracking.eventName,a[0].selectInputType=e.eventTracking.selectInputType,a[0].eventDescription=null==(i=e.eventTracking)?void 0:i.eventDescription,a[0].trackingType=e.eventTracking.trackingType,a[0].markAsGoal=e.eventTracking.markAsGoal,(null==(s=null==e?void 0:e.eventTracking)?void 0:s.markAsGoal)&&this.setState({markAsGoal:!0}),this.setState({selectElement:a[0],editModeOn:!0,editIndex:t}))}})}),c.jsx("span",{children:c.jsx("i",{className:"icon-rs-delete-medium icons-md color-primary-blue cursor-pointer",onClick:()=>{let t=[...this.state.elementArray];const i=t.indexOf(e);i>-1&&t.splice(i,1);let s=[...this.state.controlsArray];s.map((t=>{t.viewId===e.field.viewId&&(t.select=!1,t.click=!1)}));let a=[...this.state.selectControls];a.map((t=>{t.viewId===e.field.viewId&&(t.select=!1,t.click=!1)})),this.setState({elementArray:t,selectControls:a,controlsArray:s})}})})]}),c.jsxs("div",{className:"event-section",children:[c.jsxs("div",{className:"event-row",children:[c.jsx("span",{className:"label-field",children:"Event name"}),c.jsx("span",{className:"label-value truncate",children:e.eventTracking.eventName})]}),null!=(null==(i=e.eventTracking.trackingType)?void 0:i.displayName)?c.jsxs("div",{className:"event-row",children:[c.jsx("span",{className:"label-field",children:"Tracking action"}),c.jsx("span",{className:"label-value truncate",children:null!=(null==(s=e.eventTracking.trackingType)?void 0:s.displayName)?e.eventTracking.trackingType.displayName:null})]}):null]})]})}))]}))),o(this,"disconnectSocket",(()=>{var e,t,i,s,a={},n="iOS",l=null==(e=this.props.fieldTrackData)?void 0:e.appId,r="iPhone";(null==(i=null==(t=this.props.fieldTrackData)?void 0:t.deviceType)?void 0:i.toLowerCase().includes("an"))&&(n="Android",r=null==(s=this.props.fieldTrackData)?void 0:s.deviceType),a.appId=String(n+r+l).replace(/ /g,""),q.emit("disconnect-receiver",JSON.stringify(a)),q.off("receiver-handshake-response"),q.off("client-information"),q.off("message-from-client-image"),q.off("message-from-client-data"),q.off("receiver-handshake-response"),q.off("show-auth-code"),q.disconnect()})),o(this,"marketerAcceptance",(()=>{var e,t,i,s;this.setState({deviceInformation:null,showAuthCode:!0});var a=new Object,n="iOS",l=null==(e=this.props.fieldTrackData)?void 0:e.appId,r="iPhone";(null==(i=null==(t=this.props.fieldTrackData)?void 0:t.deviceType)?void 0:i.toLowerCase().includes("an"))&&(n="Android",r=null==(s=this.props.fieldTrackData)?void 0:s.deviceType),a.appId=String(n+r+l).replace(/ /g,"");var o=JSON.stringify(a);q.emit("marketer-acceptance-message",o),setTimeout((()=>{this.setState({authCode:"",showAuthCode:!1})}),12e4)}))}componentDidMount(){var e,t,i,s,a;if(this.contentRef=j.createRef(),this.props.editFieldTrack){let e=this.props.deviceList[0].fieldList,t=this.props.deviceList[0].imageData;this.setState({elementArray:e,imageData:t,controlsArray:this.props.controlsArray})}this.props.editFieldTrack&&this.setState({currentImg:null==(t=null==(e=this.props.deviceList[0])?void 0:e.imageData)?void 0:t.imageData,imageData:null==(i=this.props.deviceList[0])?void 0:i.imageData}),0==this.props.isFieldTrack&&this.socketDisconnect(),!0===this.props.isWebFieldTrack?(this.context.globalStateData.setIsLoadingData(!0),this.webSocketInit()):"add"===(null==(s=this.props.fieldTrackData)?void 0:s.mode)?this.socketInit():"edit"===(null==(a=this.props.fieldTrackData)?void 0:a.mode)&&this.getFieldTrackData(),window.addEventListener("socketClosed",(()=>{this.disconnectSocket()})),window.addEventListener("webclosed",(()=>{this.webSocketClosed()}))}componentWillUnmount(){this.disconnectSocket(),B.setDisconnectSocket(this.props)}render(){var e,t,i,s,a,n,l,r,o,d,h,m,p,u,g,k,T,N,S,x,b,j,A,D,I,F,M,G,L,W,B,R,q,V,H,U;return c.jsxs("div",{ref:this.contentRef,children:[null!==this.state.deviceInformation&&c.jsx(w,{headerTitle:"Confirmation",para:"Device is : "+this.state.deviceInformation.deviceModel,primaryButtonText:"Accept",secondaryButtonText:"Reject",buttonClicked:e=>{!0===e?this.marketerAcceptance():(this.disconnectSocket(),this.socketInit())}}),!0===this.state.showAuthCode&&c.jsx(w,{headerTitle:"One-time password",otp:this.state.authCode,otpClass:"bg-tertiary-blue color-primary-blue",buttonClicked:e=>{this.setState({authCode:"",showAuthCode:!1})}}),c.jsx("div",{className:"",children:c.jsxs(J,{className:"field-tracking-container mobile-field",style:{height:this.props.isWebFieldTrack?"100%":(null==(t=null==(e=this.state)?void 0:e.imageData)?void 0:t.width)>0?580:500},children:[c.jsx(P,{md:(this.props.isWebFieldTrack,8),children:c.jsx("div",{className:"field-tracking-content-wrapper d-flex align-items-center "+(!1===this.props.isWebFieldTrack&&null!==this.state.imageData?"justify-content-center":""),children:null===this.state.imageData&&!1===this.props.isWebFieldTrack?c.jsx("div",{className:"text-center",children:c.jsxs(J,{children:[c.jsxs("h3",{className:"mb15 font-medium blue",children:[this.props.fieldTrackData.deviceType," app event tracking setup"]}),c.jsx("img",{className:"mb15 mobile-flip",src:O}),c.jsx("h3",{className:"mb15 font-medium blue",children:"Establishing connection"}),c.jsxs("h4",{className:"mb15",children:["Open ",c.jsx("span",{children:c.jsx("strong",{children:this.props.fieldTrackData.appName})})," app and flip your mobile phone 6 times as shown above"]}),c.jsx("small",{children:"Note - The connection will not be established if the SDK is missing/broken in the mobile app"})]})}):c.jsx("div",{className:"mb25",children:!0===this.props.isWebFieldTrack?c.jsxs(c.Fragment,{children:[!1===this.props.isWebFieldTrack&&c.jsxs("h3",{className:"mb15 font-medium color-primary-blue text-center",style:{position:"absolute",top:0,width:"100%"},children:[!0===this.props.isWebFieldTrack?"Web":(null==(s=null==(i=this.props)?void 0:i.fieldTrackData)?void 0:s.deviceType)+" app"," event tracking setup"]}),c.jsx("div",{className:"css-scrollbar",style:{height:"calc(100% - 20px)",position:"absolute",width:"100%",top:0,paddingRight:25},children:null!==this.state.imageData&&c.jsx("div",{className:"P mx-auto",style:{width:"100%",height:(null==(n=null==(a=this.state)?void 0:a.imageData)?void 0:n.height)||0,backgroundImage:`url(${null==(r=null==(l=this.state)?void 0:l.imageData)?void 0:r.imageData})`,backgroundSize:"cover",position:"relative",zoom:(this.props.isWebFieldTrack,.7)},children:this.state.controlsArray.length>0&&this.createWebField(this.state.controlsArray)})})]}):c.jsx("div",{className:"device-screen",style:{width:(null==(d=null==(o=this.state)?void 0:o.imageData)?void 0:d.width)+10||380},children:c.jsxs("div",{className:"iPhone"===(null==(h=this.props.fieldTrackData)?void 0:h.deviceType)?"iphone-wrapper":"",children:[this.getDeviceType(null==(m=this.props.fieldTrackData)?void 0:m.deviceType),c.jsx("div",{className:"device-image-render",style:{width:(null==(u=null==(p=this.state)?void 0:p.imageData)?void 0:u.width)+10||380,maxHeight:(null==(k=null==(g=this.state)?void 0:g.imageData)?void 0:k.height)||600},children:c.jsx("div",{className:"device-image-inner css-scrollbar",style:{width:(null==(N=null==(T=this.state)?void 0:T.imageData)?void 0:N.width)||380,maxHeight:(null==(x=null==(S=this.state)?void 0:S.imageData)?void 0:x.height)||600},children:c.jsx("div",{className:"P mx-auto",style:{width:(null==(j=null==(b=this.state)?void 0:b.imageData)?void 0:j.width)||0,height:(null==(D=null==(A=this.state)?void 0:A.imageData)?void 0:D.height)||0,backgroundImage:`url(${null==(F=null==(I=this.state)?void 0:I.imageData)?void 0:F.imageData})`},children:c.jsx("div",{style:{width:(null==(G=null==(M=this.state)?void 0:M.imageData)?void 0:G.width)||0,height:(null==(W=null==(L=this.state)?void 0:L.imageData)?void 0:W.height)||0,position:"relative"},children:this.state.controlsArray.length>0&&this.createSingleMobileField(this.state.controlsArray[0],this.state.controlsArray[0].id)})})})})]})})})})}),c.jsxs(P,{md:(this.props.isWebFieldTrack,4),children:[c.jsxs("div",{className:"field-tracking-cost-wrapper mb30 css-scrollbar",style:{top:0,right:0,height:this.props.isWebFieldTrack?"auto":(null==(R=null==(B=this.state)?void 0:B.imageData)?void 0:R.width)>0?550:570},children:[!0===(null==(q=this.props)?void 0:q.isForm)?null:c.jsx(E,{data:this.state.screenTracking,error:this.state.errScreenTracking,onChange:e=>{this.setState({screenTracking:e});let t={...this.state.errScreenTracking};""!==e.minDuration&&(t.errMinDuration=null),""!==e.minLength&&(t.errMinLength=null),this.setState({errScreenTracking:t})}}),!0===(null==(V=this.props)?void 0:V.isForm)?c.jsx($,{editModeOn:this.state.editModeOn,clickOff:"edit"===(null==(H=this.props.fieldTrackData)?void 0:H.mode)||null===this.state.selectElement?"click-off":"",markAsGoal:this.state.markAsGoal,fieldTrackName:this.props.fieldTrackName,screenTrackData:this.state.screenTracking,error:this.state.errEvent,data:this.state.elementArray,element:this.state.selectElement,errScreen:e=>{let t={...this.state.errScreenTracking};""===e.minDuration?(t.errMinDuration="Select min duration",t.errMinLength=null):""===e.minLength&&(t.errMinDuration=null,t.errMinLength="Select min length"),this.setState({errScreenTracking:t})},callback:e=>{this.setState({event:e},(()=>{this.addFormData()}))},editedValue:e=>{this.updateFormData(e)}}):c.jsx("div",{className:null===this.state.selectElement?"click-off":"",children:c.jsx(C,{editModeOn:this.state.editModeOn,clickOff:"edit"===(null==(U=this.props.fieldTrackData)?void 0:U.mode)||null===this.state.selectElement?"click-off":"",markAsGoal:this.state.markAsGoal,screenTrackData:this.state.screenTracking,error:this.state.errEvent,data:this.state.elementArray,element:this.state.selectElement,errScreen:e=>{let t={...this.state.errScreenTracking};""===e.minDuration?(t.errMinDuration="Select min duration",t.errMinLength=null):""===e.minLength&&(t.errMinDuration=null,t.errMinLength="Select min length"),this.setState({errScreenTracking:t})},callback:e=>{this.state.editModeOn?(this.editField(e),this.setState({selectElement:null,editModeOn:!1})):this.setState({event:e},(()=>{this.addBtnClick(e.trackingType)}))}})}),this.state.elementArray.length>0&&c.jsx(c.Fragment,{children:!0===this.props.isForm?c.jsx(this.AddFormEvents,{}):c.jsx(this.AddMobileEvents,{})})]}),c.jsxs("div",{className:"d-flex justify-content-end mb30 ",children:[c.jsx(f,{onClick:()=>{var e,t;"add"===(null==(e=this.props.fieldTrackData)?void 0:e.mode)&&this.disconnectSocket(),(null==(t=this.props)?void 0:t.isWebFieldTrack)&&this.webSocketClosed(),this.props.cancelBtnClicked()},children:"Cancel"}),c.jsx(y,{onClick:()=>{if(!1===this.props.isForm){if(v(this.state.screenTracking.minDuration)){let e={...this.state.errScreenTracking};return e.errMinDuration="Select min duration",void this.setState({errScreenTracking:e})}if(v(this.state.screenTracking.minLength)){let e={...this.state.errScreenTracking};return e.minLength="Select min length",void this.setState({errScreenTracking:e})}}this.saveMobileFieldTracking()},children:"Save"})]})]})]})})]})}}o(V,"contextType",d);const H=x(V);export{H as C};

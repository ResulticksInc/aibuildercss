var e=Object.defineProperty,l=(l,t,n)=>(((l,t,n)=>{t in l?e(l,t,{enumerable:!0,configurable:!0,writable:!0,value:n}):l[t]=n})(l,"symbol"!=typeof t?t+"":t,n),n);import{M as t,BJ as n,BK as i,Y as a,BL as o}from"./index-7d59e1e4.js";import{h as r,q as d}from"./utils-16c7e021.js";import{c as u,o as s}from"./mobx-e1586d6a.js";const v=new class{constructor(){l(this,"fieldTrackData",[]),l(this,"customEventID",null),l(this,"connectSocket",null),l(this,"disconnectSocket",null),l(this,"socket",null),l(this,"socketDisconnect",!1),u(this,{fieldTrackData:s})}setSocketDisconnect(e){this.socketDisconnect=e}setConnectSocket(){return this.socket=io("https://mobsoc.resu.io/",{reconnection:!0}),this.isConnected=!0,this.socket}setDisconnectSocket(e){var l,t,n,i;if(this.isConnected){this.socket.on("disconnect",(()=>{}));var a={},o="iOS",r=null==(l=e.fieldTrackData)?void 0:l.appId,d="iPhone";(null==(n=null==(t=e.fieldTrackData)?void 0:t.deviceType)?void 0:n.toLowerCase().includes("an"))&&(o="Android",d=null==(i=e.fieldTrackData)?void 0:i.deviceType),a.appId=String(o+d+r).replace(/ /g,""),this.socket.emit("disconnect-receiver",JSON.stringify(a)),this.socket.off("receiver-handshake-response"),this.socket.off("client-information"),this.socket.off("message-from-client-image"),this.socket.off("message-from-client-data"),this.socket.off("receiver-handshake-response"),this.socket.off("show-auth-code"),this.socket.disconnect()}}setFieldTrackData(e){this.fieldTrackData.push(e)}setcustomEventID(e){this.customEventID=e}},c=(e,l,i,a)=>{let o=y(e,i);t({path:n,params:o,loading:l.globalStateData.setIsLoadingData,sessionOut:l.globalStateData.setSessionOutData,ok:e=>{e.status&&(null==e?void 0:e.data)?a(e):a({status:!1,message:null==e?void 0:e.message})},fail:e=>{a({status:!1,message:"Please try again"})}})},m=(e,l,n,a)=>{let o=p(e);JSON.stringify(o),t({path:i,params:o,loading:l.globalStateData.setIsLoadingData,sessionOut:l.globalStateData.setSessionOutData,ok:e=>{e.status&&(null==e?void 0:e.data)?a(e):a({status:!1,message:null==e?void 0:e.message})},fail:e=>{a({status:!1,message:"Please try again"})}})},g=(e,l,n,a,o)=>{let r=f(e);t({path:i,params:r,loading:!!a&&l.globalStateData.setIsLoadingData,sessionOut:l.globalStateData.setSessionOutData,ok:e=>{e.status&&(null==e?void 0:e.data)?o(e):o({status:!1,message:null==e?void 0:e.message})},fail:e=>{o({status:!1,message:"Please try again"})}})},p=(e,l)=>{var t,n,i,o,u,s,c,m,g;let p=null;p="Customrange"==(null==e?void 0:e.customEventPeriod),e&&p&&(e.dateRange={startDate:r(e.dateRange.startDate).format("yyyy-MM-DD hh:mm:ss").toString(),endDate:r(e.dateRange.endDate).format("yyyy-MM-DD hh:mm:ss").toString()}),a();const f=d.parse(null==(t=window.location)?void 0:t.search);void 0!==f.webft&&f.webft,void 0!==f.isEdit&&f.isEdit,void 0!==f.cId&&f.cId;let y,k,T=e;const D=JSON.parse(JSON.stringify(T)),{elementArray:N}=null==(n=null==D?void 0:D.fullData[0])?void 0:n.fieldList,h=N.find((e=>!0===e.PageEngagementValue));if(h){const e=null==(o=null==(i=h.eventTracking)?void 0:i.trackingType)?void 0:o.attributeName,l=null==(s=null==(u=h.eventTracking)?void 0:u.timeLimit)?void 0:s.timeLimitName;y=e,k=l,e&&N.forEach((t=>{t.triggerAction=e,t.timeLimit=l}));const t=N.indexOf(h);-1!==t&&N.splice(t,1)}let I={id:0,customEventName:null==e?void 0:e.formName,customEventPeriod:null==e?void 0:e.customEventPeriod,viewJson:JSON.stringify(e.fullData),appId:null,domainName:"",deviceType:null,startDate:null,endDate:null,fields:null};var b;return null!=e&&(I.startDate=e.dateRange.startDate,I.endDate=e.dateRange.endDate),null!=v.customEventID&&(I.id=v.customEventID),I.appId=null==e?void 0:e.appId,I.deviceType=null==e?void 0:e.deviceType,(null==(c=null==D?void 0:D.fullData[0].fieldList)?void 0:c.elementArray)&&(b=D.fullData[0].fieldList.elementArray.some((e=>null!=e.triggerAction))),I.fields=null==(g=null==(m=null==D?void 0:D.fullData[0].fieldList)?void 0:m.elementArray)?void 0:g.map((l=>{var t,n,i,a,o,r,d,u,s,v,c,m,g,p,f,T,D,N,h,I,E;let S=l.eventTracking.captureType;return Array.isArray(S)&&(S=`[${S.join(", ")}]`),{eventName:null==e?void 0:e.formName,trackingType:null!=(null==(n=null==(t=null==l?void 0:l.eventTracking)?void 0:t.captureElement)?void 0:n.attributeName)?null==(a=null==(i=null==l?void 0:l.eventTracking)?void 0:i.captureElement)?void 0:a.attributeName:null==(o=null==l?void 0:l.eventTracking)?void 0:o.captureElement,identifier:null==(r=null==l?void 0:l.field)?void 0:r.viewId,markAsTrigger:null==(d=null==l?void 0:l.eventTracking)?void 0:d.markAsGoal,captureType:null==(null==(s=null==(u=null==l?void 0:l.eventTracking)?void 0:u.captureElement)?void 0:s.elementID)?"Input"==S?"Value":S:"",trackingKey:null!=(null==(c=null==(v=null==l?void 0:l.eventTracking)?void 0:v.captureElement)?void 0:c.elementID)?S:"",screenName:null!=(null==(g=null==(m=null==l?void 0:l.eventTracking)?void 0:m.captureElement)?void 0:g.elementID)?null==l?void 0:l.screenName:null==(p=null==l?void 0:l.field)?void 0:p.screenName,preferenceKey:null!=(null==(T=null==(f=null==l?void 0:l.eventTracking)?void 0:f.captureElement)?void 0:T.elementID)?null==(D=null==l?void 0:l.eventTracking)?void 0:D.preferenceName:"",attributeName:null!=(null==(h=null==(N=null==l?void 0:l.eventTracking)?void 0:N.trackingType)?void 0:h.attributeName)?null==(E=null==(I=null==l?void 0:l.eventTracking)?void 0:I.trackingType)?void 0:E.attributeName:"",triggerAction:b?y:"",timeLimit:null!=k?k:""}})),I},f=(e,l)=>{var t,n,i,o,u;let s,c,m=null;m="Customrange"==(null==e?void 0:e.customEventPeriod);const g=JSON.parse(JSON.stringify(e)),{controls:p}=g,f=p.find((e=>!0===e.PageEngagementValue));if(f){const e=null==(n=null==(t=f.eventTracking)?void 0:t.trackingType)?void 0:n.attributeName,l=null==(o=null==(i=f.eventTracking)?void 0:i.timeLimit)?void 0:o.timeLimitName;s=e,c=l,s=e,e&&p.every((l=>{var t,n;null!=(null==(n=null==(t=l.eventTracking)?void 0:t.captureElement)?void 0:n.elementID)&&(l.triggerAction=e)}));const a=p.indexOf(f);-1!==a&&p.splice(a,1)}e.controls.concat(e.fullData.controlArray),a();const y=d.parse(null==(u=window.location)?void 0:u.search);e&&m&&(e.dateRange={startDate:r(e.dateRange.startDate).format("yyyy-MM-DD hh:mm:ss").toString(),endDate:r(e.dateRange.endDate).format("yyyy-MM-DD hh:mm:ss").toString()}),void 0!==y.webft&&y.webft,void 0!==y.isEdit&&y.isEdit,void 0!==y.cId&&y.cId;let k={id:0,customEventName:null,viewJson:JSON.stringify(e),appId:null,domainName:"",deviceType:null,startDate:null,endDate:null,fields:null};var T;return(null==g?void 0:g.controls)&&(T=null==g?void 0:g.controls.every((e=>{var l;return null==(null==(l=e.eventTracking.captureElement)?void 0:l.elementID)&&0==e.eventTracking.markAsGoal}))),null!=e&&m&&(k.startDate=r(e.dateRange.startDate).format("yyyy-MM-DD hh:mm:ss").toString(),k.endDate=r(e.dateRange.endDate).format("yyyy-MM-DD hh:mm:ss").toString()),null!=v.customEventID&&(k.id=v.customEventID),k.customEventName=e.formName,k.domainName=e.domainName,k.deviceType=e.deviceType,k.recipientFormID=0,k.fields=null==g?void 0:g.controls.map((l=>{var t,n,i,a,o,d,u,v,g,p,f,y,k,D,N,h,I,b,E,S,A,w,M,L,O,x;let J=null==(t=null==l?void 0:l.eventTracking)?void 0:t.captureType;return null!=(null==(i=null==(n=null==l?void 0:l.eventTracking)?void 0:n.captureElement)?void 0:i.elementID)&&(null==(o=null==(a=null==l?void 0:l.eventTracking)?void 0:a.captureElement)||o.attributeName),Array.isArray(J)&&(J=`[${J.join(", ")}]`),null!=(null==(u=null==(d=null==l?void 0:l.eventTracking)?void 0:d.captureElement)?void 0:u.elementID)&&(J=""),{eventName:null==e?void 0:e.formName,trackingType:null!=(null==(g=null==(v=null==l?void 0:l.eventTracking)?void 0:v.captureElement)?void 0:g.attributeName)?null==(f=null==(p=null==l?void 0:l.eventTracking)?void 0:p.captureElement)?void 0:f.attributeName:null==(y=null==l?void 0:l.eventTracking)?void 0:y.captureElement,identifier:null==(k=null==l?void 0:l.field)?void 0:k.viewId,markAsTrigger:null==(D=null==l?void 0:l.eventTracking)?void 0:D.markAsGoal,captureType:null==(null==(h=null==(N=null==l?void 0:l.eventTracking)?void 0:N.captureElement)?void 0:h.elementID)?J:"",trackingKey:null!=(null==(b=null==(I=null==l?void 0:l.eventTracking)?void 0:I.captureElement)?void 0:b.elementID)?null==(E=null==l?void 0:l.eventTracking)?void 0:E.elementKey:"",screenName:null==(S=l.field)?void 0:S.screenName,attributeName:null!=(null==(w=null==(A=null==l?void 0:l.eventTracking)?void 0:A.trackingType)?void 0:w.attributeName)?null==(L=null==(M=null==l?void 0:l.eventTracking)?void 0:M.trackingType)?void 0:L.attributeName:"",triggerAction:T?s:null!=(null==(x=null==(O=null==l?void 0:l.eventTracking)?void 0:O.captureElement)?void 0:x.elementID)&&null!=(null==l?void 0:l.triggerAction)?l.triggerAction:"",startDate:null!=e&&m?r(e.dateRange.startDate).format("yyyy-MM-DD hh:mm:ss").toString():null,endDate:null!=e&&m?r(e.dateRange.endDate).format("yyyy-MM-DD hh:mm:ss").toString():null,timeLimit:null!=c?c:""}})),k},y=(e,l)=>{var t,n,i,o,r,u;null==(n=null==(t=e.fullData[0])?void 0:t.fieldList)||n.currentImg,null==(i=e.fullData[0])||delete i.fieldList.currentImg,a();const s=d.parse(null==(o=window.location)?void 0:o.search);void 0!==s.webft&&s.webft;let v=void 0!==s.isEdit&&s.isEdit,c=void 0!==s.cId?s.cId:0,m={formType:"Brand",formName:e.formName,viewJson:JSON.stringify(e),appId:"",domainName:"",deviceType:"mobile"===l?null==e?void 0:e.deviceType:l,recipientFormID:0,fields:[]};"true"===v&&(m.recipientFormID=parseInt(c)),"web"===l?m.domainName=null==e?void 0:e.domainName:m.appId=(null==(r=null==e?void 0:e.appName)?void 0:r.appGuid)||"";let g=[];return null==(u=null==e?void 0:e.controls)||u.map(((t,n)=>{var i,a,o,r,d,u,s,v,c,p,f;if("mobile"===l)null==(a=null==(i=null==t?void 0:t.fieldList)?void 0:i.elementArray)||a.map(((t,n)=>{var i,a,o,r,d,u,s,v,c,p,f;let y=t.field,T={columnID:"Textbox"+n+"_"+(null==(a=null==(i=null==t?void 0:t.eventTracking)?void 0:i.trackingType)?void 0:a.attributeName),isMandatory:(null==(o=null==t?void 0:t.eventTracking)?void 0:o.mandadory)||!1,columnName:(null==(d=null==(r=null==t?void 0:t.eventTracking)?void 0:r.trackingType)?void 0:d.attributeName)||"",columntype:"Textbox",dataAttributeID:(null==(s=null==(u=null==t?void 0:t.eventTracking)?void 0:u.trackingType)?void 0:s.dataAttributeID)||"",fieldDetails:(null==(v=null==t?void 0:t.eventTracking)?void 0:v.friendlyName)||""};y.columnID=(null==(c=t.eventTracking)?void 0:c.friendlyName)||"",y.markAsSubmit=(null==(p=null==t?void 0:t.eventTracking)?void 0:p.markAsGoal)||!1,y.isMandatory=(null==(f=null==t?void 0:t.eventTracking)?void 0:f.mandadory)||!1;const D=Object.assign({},T,t.field,t.eventTracking,t.errScreenTracking);let N=k(m.recipientFormID,l,e,D);g.push(N)}));else{t.field;let i={columnID:"Textbox"+n+"_"+(null==(r=null==(o=null==t?void 0:t.eventTracking)?void 0:o.trackingType)?void 0:r.attributeName),isMandatory:(null==(d=null==t?void 0:t.eventTracking)?void 0:d.mandadory)||!1,columnName:(null==(s=null==(u=null==t?void 0:t.eventTracking)?void 0:u.trackingType)?void 0:s.attributeName)||"",columntype:"Textbox",dataAttributeID:(null==(c=null==(v=null==t?void 0:t.eventTracking)?void 0:v.trackingType)?void 0:c.dataAttributeID)||"",fieldDetails:(null==(p=null==t?void 0:t.eventTracking)?void 0:p.friendlyName)||""};null==(f=null==t?void 0:t.eventTracking)||f.friendlyName,"mobile"===l&&(null==e||e.deviceType),"mobile"===l&&(null==e||e.appName),null==t||t.screenTracking,null==t||t.eventTracking;const a=Object.assign({},i,t.field,t.eventTracking,t.errScreenTracking);let y=k(m.recipientFormID,l,e,a);g.push(y)}})),m.fields=g,m},k=(e,l,t,n)=>{var i;let o=a();return{identifier:n.viewid,eventName:(null==n?void 0:n.friendlyName)||"",captureType:"Value",screenName:"web"===l?n.tagurl:null==n?void 0:n.screenName,fieldType:n.columntype,fieldName:n.columnName,requiredfield:n.isMandatory,markAsSubmit:n.markAsGoal,formId:e,apiKey:null==(i=null==o?void 0:o.clientDetailsLocalization)?void 0:i.tenantId}},T=e=>{let l=!1,t={error:!1,errMsg:null,errType:0,errIndex:0};return e.map(((e,n)=>{if(!l)return null===e.deviceType||void 0===e.deviceType||""===e.deviceType?(l=!0,void(t={error:!0,errMsg:"Select device type",errType:1,errIndex:n})):null===e.mobileApp||void 0===e.mobileApp||""===e.mobileApp?(l=!0,void(t={error:!0,errMsg:"Select mobile app",errType:2,errIndex:n})):null===e.fieldList||void 0===e.fieldList||0===e.fieldList.length?(l=!0,void(t={error:!0,errMsg:"Add form data",errType:3,errIndex:n})):void 0})),t},D=(e,l)=>{o(e,(e=>{l(e)}))};export{m as a,D as c,v as m,c as s,T as v,g as w};
